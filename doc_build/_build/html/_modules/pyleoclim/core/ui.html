

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>pyleoclim.core.ui &mdash; Pyleoclim 0.6.2beta documentation</title>
  

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/css/rtd_sphinx_search.min.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/js/rtd_sphinx_search.min.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home" alt="Documentation Home"> Pyleoclim
          

          
            
            <img src="../../../_static/pyleoclim_insigna_full_white.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                0.6.2beta
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Working with Pyleoclim</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../installation.html">Installing Pyleoclim</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../core/ui.html">The Pyleoclim User Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials.html">Tutorials</a></li>
</ul>
<p class="caption"><span class="caption-text">Advanced functionalities</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../utils/introduction.html">Pyleoclim Utilities (pyleoclim.utils)</a></li>
</ul>
<p class="caption"><span class="caption-text">Getting Involved</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../citation.html">Citing Pyleoclim</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Pyleoclim</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
      <li>pyleoclim.core.ui</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for pyleoclim.core.ui</h1><div class="highlight"><pre>
<span></span><span class="sd">&#39;&#39;&#39; The application interface for the users</span>

<span class="sd">@author: fengzhu</span>

<span class="sd">Created on Jan 31, 2020</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="kn">from</span> <span class="nn">..utils</span> <span class="kn">import</span> <span class="n">tsutils</span><span class="p">,</span> <span class="n">plotting</span><span class="p">,</span> <span class="n">mapping</span><span class="p">,</span> <span class="n">lipdutils</span><span class="p">,</span> <span class="n">tsmodel</span>
<span class="kn">from</span> <span class="nn">..utils</span> <span class="kn">import</span> <span class="n">wavelet</span> <span class="k">as</span> <span class="n">waveutils</span>
<span class="kn">from</span> <span class="nn">..utils</span> <span class="kn">import</span> <span class="n">spectral</span> <span class="k">as</span> <span class="n">specutils</span>
<span class="kn">from</span> <span class="nn">..utils</span> <span class="kn">import</span> <span class="n">correlation</span> <span class="k">as</span> <span class="n">corrutils</span>
<span class="kn">from</span> <span class="nn">..utils</span> <span class="kn">import</span> <span class="n">causality</span> <span class="k">as</span> <span class="n">causalutils</span>
<span class="kn">from</span> <span class="nn">..utils</span> <span class="kn">import</span> <span class="n">decomposition</span>
<span class="kn">from</span> <span class="nn">..utils</span> <span class="kn">import</span> <span class="nb">filter</span> <span class="k">as</span> <span class="n">filterutils</span>

<span class="c1">#from textwrap import dedent</span>

<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">tabulate</span> <span class="kn">import</span> <span class="n">tabulate</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">namedtuple</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">deepcopy</span>

<span class="kn">from</span> <span class="nn">matplotlib.ticker</span> <span class="kn">import</span> <span class="n">ScalarFormatter</span><span class="p">,</span> <span class="n">FormatStrFormatter</span><span class="p">,</span> <span class="n">MaxNLocator</span>
<span class="kn">import</span> <span class="nn">matplotlib.transforms</span> <span class="k">as</span> <span class="nn">transforms</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">cm</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">gridspec</span>
<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="c1">#from matplotlib.colors import BoundaryNorm, Normalize</span>

<span class="kn">import</span> <span class="nn">cartopy.crs</span> <span class="k">as</span> <span class="nn">ccrs</span>
<span class="kn">import</span> <span class="nn">cartopy.feature</span> <span class="k">as</span> <span class="nn">cfeature</span>


<span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>
<span class="kn">from</span> <span class="nn">scipy.stats.mstats</span> <span class="kn">import</span> <span class="n">mquantiles</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span><span class="p">,</span> <span class="n">signal</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="kn">import</span> <span class="nn">lipd</span> <span class="k">as</span> <span class="nn">lpd</span>


<span class="k">def</span> <span class="nf">dict2namedtuple</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Convert a dictionary to a namedtuple</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">tupletype</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;tupletype&#39;</span><span class="p">,</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">d</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">tupletype</span><span class="p">(</span><span class="o">**</span><span class="n">d</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">infer_period_unit_from_time_unit</span><span class="p">(</span><span class="n">time_unit</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; infer a period unit based on the given time unit</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">time_unit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">period_unit</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">unit_group</span> <span class="o">=</span> <span class="n">lipdutils</span><span class="o">.</span><span class="n">timeUnitsCheck</span><span class="p">(</span><span class="n">time_unit</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">unit_group</span> <span class="o">!=</span> <span class="s1">&#39;unknown&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">unit_group</span> <span class="o">==</span> <span class="s1">&#39;kage_units&#39;</span><span class="p">:</span>
                <span class="n">period_unit</span> <span class="o">=</span> <span class="s1">&#39;kyrs&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">period_unit</span> <span class="o">=</span> <span class="s1">&#39;yrs&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">time_unit</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;s&#39;</span><span class="p">:</span>
                <span class="n">period_unit</span> <span class="o">=</span> <span class="n">time_unit</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">period_unit</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">time_unit</span><span class="si">}</span><span class="s1">s&#39;</span>

    <span class="k">return</span> <span class="n">period_unit</span>

<div class="viewcode-block" id="gen_ts"><a class="viewcode-back" href="../../../core/ui.html#pyleoclim.core.ui.gen_ts">[docs]</a><span class="k">def</span> <span class="nf">gen_ts</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nt</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Generate pyleoclim.Series with timeseries models</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    model : str, {&#39;colored_noise&#39;, &#39;colored_noise_2regimes&#39;, &#39;ar1&#39;}</span>
<span class="sd">        the timeseries model to use</span>
<span class="sd">        - colored_noise : colored noise with one scaling slope</span>
<span class="sd">        - colored_noise_2regimes : colored noise with two regimes of two different scaling slopes</span>
<span class="sd">        - ar1 : AR(1) series</span>

<span class="sd">    t : array</span>
<span class="sd">        the time axis</span>

<span class="sd">    nt : number of time points</span>
<span class="sd">        only works if &#39;t&#39; is None, and it will use an evenly-spaced vector with nt points </span>

<span class="sd">    kwargs : dict</span>
<span class="sd">        the keyward arguments for the specified timeseries model</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>

<span class="sd">    ts : `pyleoclim.Series`</span>

<span class="sd">    See also</span>
<span class="sd">    --------</span>

<span class="sd">    pyleoclim.utils.tsmodel.colored_noise : generate a colored noise timeseries</span>
<span class="sd">    pyleoclim.utils.tsmodel.colored_noise_2regimes : generate a colored noise timeseries with two regimes</span>
<span class="sd">    pyleoclim.utils.tsmodel.gen_ar1_evenly : generate an AR(1) series</span>


<span class="sd">    Examples</span>
<span class="sd">    --------</span>

<span class="sd">    - AR(1) series</span>

<span class="sd">    .. ipython:: python</span>
<span class="sd">        :okwarning:</span>

<span class="sd">        import pyleoclim as pyleo</span>

<span class="sd">        # default length nt=1000; default persistence parameter g=0.5</span>
<span class="sd">        ts = pyleo.gen_ts(model=&#39;ar1&#39;)</span>
<span class="sd">        g = pyleo.utils.tsmodel.ar1_fit(ts.value)</span>
<span class="sd">        @savefig gen_ar1_t0.png</span>
<span class="sd">        fig, ax = ts.plot(label=f&#39;g={g:.2f}&#39;)</span>
<span class="sd">        pyleo.closefig(fig)</span>

<span class="sd">        # use &#39;nt&#39; to modify the data length</span>
<span class="sd">        ts = pyleo.gen_ts(model=&#39;ar1&#39;, nt=100)</span>
<span class="sd">        g = pyleo.utils.tsmodel.ar1_fit(ts.value)</span>
<span class="sd">        @savefig gen_ar1_t1.png</span>
<span class="sd">        fig, ax = ts.plot(label=f&#39;g={g:.2f}&#39;)</span>
<span class="sd">        pyleo.closefig(fig)</span>

<span class="sd">        # use &#39;settings&#39; to modify the persistence parameter &#39;g&#39;</span>
<span class="sd">        ts = pyleo.gen_ts(model=&#39;ar1&#39;, g=0.9)</span>
<span class="sd">        g = pyleo.utils.tsmodel.ar1_fit(ts.value)</span>
<span class="sd">        @savefig gen_ar1_t2.png</span>
<span class="sd">        fig, ax = ts.plot(label=f&#39;g={g:.2f}&#39;)</span>
<span class="sd">        pyleo.closefig(fig)</span>

<span class="sd">    - Colored noise with 1 regime</span>

<span class="sd">    .. ipython:: python</span>
<span class="sd">        :okwarning:</span>

<span class="sd">        # default scaling slope &#39;alpha&#39; is 1</span>
<span class="sd">        ts = pyleo.gen_ts(model=&#39;colored_noise&#39;)</span>
<span class="sd">        psd = ts.spectral()</span>

<span class="sd">        # estimate the scaling slope</span>
<span class="sd">        beta_info = psd.beta_est(fmin=1/50, fmax=1/2)</span>
<span class="sd">        print(beta_info[&#39;beta&#39;])</span>

<span class="sd">        # visualize</span>
<span class="sd">        @savefig gen_cn_t0.png</span>
<span class="sd">        fig, ax = psd.plot()</span>
<span class="sd">        pyleo.closefig(fig)</span>

<span class="sd">        # modify &#39;alpha&#39; with &#39;settings&#39;</span>
<span class="sd">        ts = pyleo.gen_ts(model=&#39;colored_noise&#39;, alpha=2)</span>
<span class="sd">        psd = ts.spectral()</span>

<span class="sd">        # estimate the scaling slope</span>
<span class="sd">        beta_info = psd.beta_est(fmin=1/50, fmax=1/2)</span>
<span class="sd">        print(beta_info[&#39;beta&#39;])</span>

<span class="sd">        # visualize</span>
<span class="sd">        @savefig gen_cn_t1.png</span>
<span class="sd">        fig, ax = psd.plot()</span>
<span class="sd">        pyleo.closefig(fig)</span>

<span class="sd">    - Colored noise with 2 regimes</span>

<span class="sd">    .. ipython:: python</span>
<span class="sd">        :okwarning</span>

<span class="sd">        # default scaling slopes &#39;alpha1&#39; is 0.5 and &#39;alpha2&#39; is 2, with break at 1/20</span>
<span class="sd">        ts = pyleo.gen_ts(model=&#39;colored_noise_2regimes&#39;)</span>
<span class="sd">        psd = ts.spectral()</span>

<span class="sd">        # estimate the scaling slope</span>
<span class="sd">        beta_info_lf = psd.beta_est(fmin=1/50, fmax=1/20)</span>
<span class="sd">        beta_info_hf = psd.beta_est(fmin=1/20, fmax=1/2)</span>
<span class="sd">        print(beta_info_lf[&#39;beta&#39;])</span>
<span class="sd">        print(beta_info_hf[&#39;beta&#39;])</span>

<span class="sd">        # visualize</span>
<span class="sd">        @savefig gen_cn2_t0.png</span>
<span class="sd">        fig, ax = psd.plot()</span>
<span class="sd">        pyleo.closefig(fig)</span>

<span class="sd">        # modify the scaling slopes and scaling break with &#39;settings&#39;</span>
<span class="sd">        ts = pyleo.gen_ts(model=&#39;colored_noise_2regimes&#39;, alpha1=2, alpha2=1, f_break=1/10)</span>
<span class="sd">        psd = ts.spectral()</span>

<span class="sd">        # estimate the scaling slope</span>
<span class="sd">        beta_info_lf = psd.beta_est(fmin=1/50, fmax=1/10)</span>
<span class="sd">        beta_info_hf = psd.beta_est(fmin=1/10, fmax=1/2)</span>
<span class="sd">        print(beta_info_lf[&#39;beta&#39;])</span>
<span class="sd">        print(beta_info_hf[&#39;beta&#39;])</span>

<span class="sd">        # visualize</span>
<span class="sd">        @savefig gen_cn2_t1.png</span>
<span class="sd">        fig, ax = psd.plot()</span>
<span class="sd">        pyleo.closefig(fig)</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">t</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nt</span><span class="p">)</span>

    <span class="n">tsm</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;colored_noise&#39;</span><span class="p">:</span> <span class="n">tsmodel</span><span class="o">.</span><span class="n">colored_noise</span><span class="p">,</span>
        <span class="s1">&#39;colored_noise_2regimes&#39;</span><span class="p">:</span> <span class="n">tsmodel</span><span class="o">.</span><span class="n">colored_noise_2regimes</span><span class="p">,</span>
        <span class="s1">&#39;ar1&#39;</span><span class="p">:</span> <span class="n">tsmodel</span><span class="o">.</span><span class="n">gen_ar1_evenly</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="n">tsm_args</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">tsm_args</span><span class="p">[</span><span class="s1">&#39;colored_noise&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;alpha&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
    <span class="n">tsm_args</span><span class="p">[</span><span class="s1">&#39;colored_noise_2regimes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;alpha1&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;alpha2&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;f_break&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="o">/</span><span class="mi">20</span><span class="p">}</span>
    <span class="n">tsm_args</span><span class="p">[</span><span class="s1">&#39;ar1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;g&#39;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">}</span>
    <span class="n">tsm_args</span><span class="p">[</span><span class="n">model</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="n">v</span> <span class="o">=</span> <span class="n">tsm</span><span class="p">[</span><span class="n">model</span><span class="p">](</span><span class="n">t</span><span class="o">=</span><span class="n">t</span><span class="p">,</span> <span class="o">**</span><span class="n">tsm_args</span><span class="p">[</span><span class="n">model</span><span class="p">])</span>
    <span class="n">ts</span> <span class="o">=</span> <span class="n">Series</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">t</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">v</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ts</span></div>


<div class="viewcode-block" id="Series"><a class="viewcode-back" href="../../../core/ui.html#pyleoclim.core.ui.Series">[docs]</a><span class="k">class</span> <span class="nc">Series</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39; pyleoSeries object</span>

<span class="sd">    The Series class is, at its heart, a simple structure containing two arrays y and t of equal length, and some</span>
<span class="sd">    metadata allowing to interpret and plot the series. It is similar to a pandas Series, but the concept</span>
<span class="sd">    was extended because pandas does not yet support geologic time.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    time : list or numpy.array</span>
<span class="sd">        independent variable (t)</span>

<span class="sd">    value : list of numpy.array</span>
<span class="sd">        values of the dependent variable (y)</span>

<span class="sd">    time_unit : string</span>
<span class="sd">        Units for the time vector (e.g., &#39;years&#39;).</span>
<span class="sd">        Default is &#39;years&#39;</span>

<span class="sd">    time_name : string</span>
<span class="sd">        Name of the time vector (e.g., &#39;Time&#39;,&#39;Age&#39;).</span>
<span class="sd">        Default is None. This is used to label the time axis on plots</span>

<span class="sd">    value_name : string</span>
<span class="sd">        Name of the value vector (e.g., &#39;temperature&#39;)</span>
<span class="sd">        Default is None</span>

<span class="sd">    value_unit : string</span>
<span class="sd">        Units for the value vector (e.g., &#39;deg C&#39;)</span>
<span class="sd">        Default is None</span>

<span class="sd">    label : string</span>
<span class="sd">        Name of the time series (e.g., &#39;Nino 3.4&#39;)</span>
<span class="sd">        Default is None</span>

<span class="sd">    clean_ts : boolean flag</span>
<span class="sd">        set to True to remove the NaNs and make time axis strictly prograde with duplicated timestamps reduced by averaging the values</span>
<span class="sd">        Default is True</span>

<span class="sd">    verbose : bool</span>
<span class="sd">        If True, will print warning messages if there is any</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>

<span class="sd">    In this example, we import the Southern Oscillation Index (SOI) into a pandas dataframe and create a pyleoSeries object.</span>

<span class="sd">    .. ipython:: python</span>
<span class="sd">        :okwarning:</span>

<span class="sd">        import pyleoclim as pyleo</span>
<span class="sd">        import pandas as pd</span>
<span class="sd">        data=pd.read_csv(</span>
<span class="sd">            &#39;https://raw.githubusercontent.com/LinkedEarth/Pyleoclim_util/Development/example_data/soi_data.csv&#39;,</span>
<span class="sd">            skiprows=0, header=1</span>
<span class="sd">        )</span>
<span class="sd">        time=data.iloc[:,1]</span>
<span class="sd">        value=data.iloc[:,2]</span>
<span class="sd">        ts=pyleo.Series(</span>
<span class="sd">            time=time, value=value,</span>
<span class="sd">            time_name=&#39;Year (CE)&#39;, value_name=&#39;SOI&#39;, label=&#39;Southern Oscillation Index&#39;</span>
<span class="sd">        )</span>
<span class="sd">        ts</span>
<span class="sd">        ts.__dict__.keys()</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">time_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">time_unit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">value_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">value_unit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">clean_ts</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">clean_ts</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>
            <span class="n">value</span><span class="p">,</span> <span class="n">time</span> <span class="o">=</span> <span class="n">tsutils</span><span class="o">.</span><span class="n">clean_ts</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">time</span><span class="p">),</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="n">time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_name</span> <span class="o">=</span> <span class="n">time_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_unit</span> <span class="o">=</span> <span class="n">time_unit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value_name</span> <span class="o">=</span> <span class="n">value_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value_unit</span> <span class="o">=</span> <span class="n">value_unit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">label</span>

<div class="viewcode-block" id="Series.convert_time_unit"><a class="viewcode-back" href="../../../core/ui.html#pyleoclim.core.ui.Series.convert_time_unit">[docs]</a>    <span class="k">def</span> <span class="nf">convert_time_unit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time_unit</span><span class="o">=</span><span class="s1">&#39;years&#39;</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Convert the time unit of the Series object</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        time_unit : str</span>
<span class="sd">            the target time unit, possible input:</span>
<span class="sd">            {</span>
<span class="sd">                &#39;year&#39;, &#39;years&#39;, &#39;yr&#39;, &#39;yrs&#39;,</span>
<span class="sd">                &#39;y BP&#39;, &#39;yr BP&#39;, &#39;yrs BP&#39;, &#39;year BP&#39;, &#39;years BP&#39;,</span>
<span class="sd">                &#39;ky BP&#39;, &#39;kyr BP&#39;, &#39;kyrs BP&#39;, &#39;ka BP&#39;, &#39;ka&#39;,</span>
<span class="sd">                &#39;my BP&#39;, &#39;myr BP&#39;, &#39;myrs BP&#39;, &#39;ma BP&#39;, &#39;ma&#39;,</span>
<span class="sd">            }</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        .. ipython:: python</span>
<span class="sd">            :okwarning:</span>

<span class="sd">            import pyleoclim as pyleo</span>
<span class="sd">            import pandas as pd</span>
<span class="sd">            data = pd.read_csv(</span>
<span class="sd">                &#39;https://raw.githubusercontent.com/LinkedEarth/Pyleoclim_util/Development/example_data/soi_data.csv&#39;,</span>
<span class="sd">                skiprows=0, header=1</span>
<span class="sd">            )</span>
<span class="sd">            time = data.iloc[:,1]</span>
<span class="sd">            value = data.iloc[:,2]</span>
<span class="sd">            ts = pyleo.Series(time=time, value=value, time_unit=&#39;years&#39;)</span>
<span class="sd">            new_ts = ts.convert_time_unit(time_unit=&#39;yrs BP&#39;)</span>
<span class="sd">            print(&#39;Original timeseries:&#39;)</span>
<span class="sd">            print(&#39;time unit:&#39;, ts.time_unit)</span>
<span class="sd">            print(&#39;time:&#39;, ts.time)</span>
<span class="sd">            print()</span>
<span class="sd">            print(&#39;Converted timeseries:&#39;)</span>
<span class="sd">            print(&#39;time unit:&#39;, new_ts.time_unit)</span>
<span class="sd">            print(&#39;time:&#39;, new_ts.time)</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">new_ts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">time_unit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">tu</span> <span class="o">=</span> <span class="n">time_unit</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">tu</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;ky&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span> <span class="ow">or</span> <span class="n">tu</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;ka&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">time_unit_label</span> <span class="o">=</span> <span class="s1">&#39;ky BP&#39;</span>
            <span class="k">elif</span> <span class="n">tu</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;my&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span> <span class="ow">or</span> <span class="n">tu</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;ma&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">time_unit_label</span> <span class="o">=</span> <span class="s1">&#39;my BP&#39;</span>
            <span class="k">elif</span> <span class="n">tu</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;y bp&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span> <span class="ow">or</span> <span class="n">tu</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;yr bp&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span> <span class="ow">or</span> <span class="n">tu</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;yrs bp&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span> <span class="ow">or</span> <span class="n">tu</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;year bp&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span> <span class="ow">or</span> <span class="n">tu</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;years bp&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">time_unit_label</span> <span class="o">=</span> <span class="s1">&#39;yrs BP&#39;</span>
            <span class="k">elif</span> <span class="n">tu</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;yr&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span> <span class="ow">or</span> <span class="n">tu</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;year&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span> <span class="ow">or</span> <span class="n">tu</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;yrs&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span> <span class="ow">or</span> <span class="n">tu</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;years&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">time_unit_label</span> <span class="o">=</span> <span class="s1">&#39;yrs&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Input time_unit=</span><span class="si">{</span><span class="n">time_unit</span><span class="si">}</span><span class="s2"> is not supported. Supported input: &#39;year&#39;, &#39;years&#39;, &#39;yr&#39;, &#39;yrs&#39;, &#39;y BP&#39;, &#39;yr BP&#39;, &#39;yrs BP&#39;, &#39;year BP&#39;, &#39;years BP&#39;, &#39;ky BP&#39;, &#39;kyr BP&#39;, &#39;kyrs BP&#39;, &#39;ka BP&#39;, &#39;my BP&#39;, &#39;myr BP&#39;, &#39;myrs BP&#39;, &#39;ma BP&#39;.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">new_ts</span>

        <span class="k">def</span> <span class="nf">convert_to_years</span><span class="p">():</span>
            <span class="k">def</span> <span class="nf">prograde_time</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">time_datum</span><span class="p">,</span> <span class="n">time_exponent</span><span class="p">):</span>
                <span class="n">new_time</span> <span class="o">=</span> <span class="p">(</span><span class="n">time_datum</span> <span class="o">+</span> <span class="n">time</span><span class="p">)</span><span class="o">*</span><span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">time_exponent</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">new_time</span>

            <span class="k">def</span> <span class="nf">retrograde_time</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">time_datum</span><span class="p">,</span> <span class="n">time_exponent</span><span class="p">):</span>
                <span class="n">new_time</span> <span class="o">=</span> <span class="p">(</span><span class="n">time_datum</span> <span class="o">-</span> <span class="n">time</span><span class="p">)</span><span class="o">*</span><span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">time_exponent</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">new_time</span>

            <span class="n">convert_func</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;prograde&#39;</span><span class="p">:</span> <span class="n">prograde_time</span><span class="p">,</span>
                <span class="s1">&#39;retrograde&#39;</span><span class="p">:</span> <span class="n">retrograde_time</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_unit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">tu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_unit</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">tu</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;ky&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span> <span class="ow">or</span> <span class="n">tu</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;ka&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">time_dir</span> <span class="o">=</span> <span class="s1">&#39;retrograde&#39;</span>
                    <span class="n">time_datum</span> <span class="o">=</span> <span class="mi">1950</span><span class="o">/</span><span class="mf">1e3</span>
                    <span class="n">time_exponent</span> <span class="o">=</span> <span class="mi">3</span>
                    <span class="n">time_unit_label</span> <span class="o">=</span> <span class="s1">&#39;ky BP&#39;</span>
                <span class="k">elif</span> <span class="n">tu</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;my&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span> <span class="ow">or</span> <span class="n">tu</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;ma&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">time_dir</span> <span class="o">=</span> <span class="s1">&#39;retrograde&#39;</span>
                    <span class="n">time_datum</span> <span class="o">=</span> <span class="mi">1950</span><span class="o">/</span><span class="mf">1e6</span>
                    <span class="n">time_exponent</span> <span class="o">=</span> <span class="mi">6</span>
                <span class="k">elif</span> <span class="n">tu</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;y bp&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span> <span class="ow">or</span> <span class="n">tu</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;yr bp&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span> <span class="ow">or</span> <span class="n">tu</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;yrs bp&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span> <span class="ow">or</span> <span class="n">tu</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;year bp&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span> <span class="ow">or</span> <span class="n">tu</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;years bp&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">time_dir</span> <span class="o">=</span><span class="s1">&#39;retrograde&#39;</span>
                    <span class="n">time_datum</span> <span class="o">=</span> <span class="mi">1950</span>
                    <span class="n">time_exponent</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">time_dir</span> <span class="o">=</span><span class="s1">&#39;prograde&#39;</span>
                    <span class="n">time_datum</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">time_exponent</span> <span class="o">=</span> <span class="mi">0</span>

                <span class="n">new_time</span> <span class="o">=</span> <span class="n">convert_func</span><span class="p">[</span><span class="n">time_dir</span><span class="p">](</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">time_datum</span><span class="p">,</span> <span class="n">time_exponent</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">new_time</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="k">return</span> <span class="n">new_time</span>

        <span class="k">def</span> <span class="nf">convert_to_bp</span><span class="p">():</span>
            <span class="n">time_yrs</span> <span class="o">=</span> <span class="n">convert_to_years</span><span class="p">()</span>
            <span class="n">time_bp</span> <span class="o">=</span> <span class="mi">1950</span> <span class="o">-</span> <span class="n">time_yrs</span>
            <span class="k">return</span> <span class="n">time_bp</span>

        <span class="k">def</span> <span class="nf">convert_to_ka</span><span class="p">():</span>
            <span class="n">time_bp</span> <span class="o">=</span> <span class="n">convert_to_bp</span><span class="p">()</span>
            <span class="n">time_ka</span> <span class="o">=</span> <span class="n">time_bp</span> <span class="o">/</span> <span class="mf">1e3</span>
            <span class="k">return</span> <span class="n">time_ka</span>

        <span class="k">def</span> <span class="nf">convert_to_ma</span><span class="p">():</span>
            <span class="n">time_bp</span> <span class="o">=</span> <span class="n">convert_to_bp</span><span class="p">()</span>
            <span class="n">time_ma</span> <span class="o">=</span> <span class="n">time_bp</span> <span class="o">/</span> <span class="mf">1e6</span>
            <span class="k">return</span> <span class="n">time_ma</span>

        <span class="n">convert_to</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;yrs&#39;</span><span class="p">:</span> <span class="n">convert_to_years</span><span class="p">(),</span>
            <span class="s1">&#39;yrs BP&#39;</span><span class="p">:</span> <span class="n">convert_to_bp</span><span class="p">(),</span>
            <span class="s1">&#39;ky BP&#39;</span><span class="p">:</span> <span class="n">convert_to_ka</span><span class="p">(),</span>
            <span class="s1">&#39;my BP&#39;</span><span class="p">:</span> <span class="n">convert_to_ma</span><span class="p">(),</span>
        <span class="p">}</span>

        <span class="n">new_time</span> <span class="o">=</span> <span class="n">convert_to</span><span class="p">[</span><span class="n">time_unit_label</span><span class="p">]</span>

        <span class="n">dt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">new_time</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">dt</span><span class="o">&lt;=</span><span class="mi">0</span><span class="p">):</span>
            <span class="n">new_value</span><span class="p">,</span> <span class="n">new_time</span> <span class="o">=</span> <span class="n">tsutils</span><span class="o">.</span><span class="n">sort_ts</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">new_time</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">new_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">value</span>

        <span class="n">new_ts</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="n">new_time</span>
        <span class="n">new_ts</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">new_value</span>
        <span class="n">new_ts</span><span class="o">.</span><span class="n">time_unit</span> <span class="o">=</span> <span class="n">time_unit</span>

        <span class="k">return</span> <span class="n">new_ts</span></div>

<div class="viewcode-block" id="Series.make_labels"><a class="viewcode-back" href="../../../core/ui.html#pyleoclim.core.ui.Series.make_labels">[docs]</a>    <span class="k">def</span> <span class="nf">make_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Initialization of labels</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        time_header : str</span>
<span class="sd">            Label for the time axis</span>
<span class="sd">        value_header : str</span>
<span class="sd">            Label for the value axis</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">time_name_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_name</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">time_name_str</span> <span class="o">=</span> <span class="s1">&#39;time&#39;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">value_name_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_name</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">value_name_str</span> <span class="o">=</span> <span class="s1">&#39;value&#39;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_unit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">value_header</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">value_name_str</span><span class="si">}</span><span class="s1"> [</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">value_unit</span><span class="si">}</span><span class="s1">]&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">value_header</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">value_name_str</span><span class="si">}</span><span class="s1">&#39;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_unit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">time_header</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">time_name_str</span><span class="si">}</span><span class="s1"> [</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">time_unit</span><span class="si">}</span><span class="s1">]&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">time_header</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">time_name_str</span><span class="si">}</span><span class="s1">&#39;</span>

        <span class="k">return</span> <span class="n">time_header</span><span class="p">,</span> <span class="n">value_header</span></div>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Prints out the series in a table format and length of the series</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>
<span class="sd">            length of the timeseries.</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">time_label</span><span class="p">,</span> <span class="n">value_label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_labels</span><span class="p">()</span>

        <span class="n">table</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">time_label</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
            <span class="n">value_label</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">msg</span> <span class="o">=</span> <span class="nb">print</span><span class="p">(</span><span class="n">tabulate</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="s1">&#39;keys&#39;</span><span class="p">))</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;Length: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span>

<div class="viewcode-block" id="Series.stats"><a class="viewcode-back" href="../../../core/ui.html#pyleoclim.core.ui.Series.stats">[docs]</a>    <span class="k">def</span> <span class="nf">stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Compute basic statistics for the time series</span>

<span class="sd">        Computes the mean, median, min, max, standard deviation, and interquartile range of a numpy array y, ignoring NaNs.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        res : dictionary</span>
<span class="sd">            Contains the mean, median, minimum value, maximum value, standard</span>
<span class="sd">            deviation, and interquartile range for the Series.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        Compute basic statistics for the SOI series</span>

<span class="sd">        .. ipython:: python</span>
<span class="sd">            :okwarning:</span>

<span class="sd">            import pyleoclim as pyleo</span>
<span class="sd">            import pandas as pd</span>
<span class="sd">            data=pd.read_csv(&#39;https://raw.githubusercontent.com/LinkedEarth/Pyleoclim_util/Development/example_data/soi_data.csv&#39;,skiprows=0,header=1)</span>
<span class="sd">            time=data.iloc[:,1]</span>
<span class="sd">            value=data.iloc[:,2]</span>
<span class="sd">            ts=pyleo.Series(time=time,value=value,time_name=&#39;Year C.E&#39;, value_name=&#39;SOI&#39;, label=&#39;SOI&#39;)</span>
<span class="sd">            ts.stats()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mean</span><span class="p">,</span> <span class="n">median</span><span class="p">,</span> <span class="n">min_</span><span class="p">,</span> <span class="n">max_</span><span class="p">,</span> <span class="n">std</span><span class="p">,</span> <span class="n">IQR</span> <span class="o">=</span> <span class="n">tsutils</span><span class="o">.</span><span class="n">simple_stats</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="n">res</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;mean&#39;</span><span class="p">:</span><span class="n">mean</span><span class="p">,</span>
             <span class="s1">&#39;median&#39;</span><span class="p">:</span><span class="n">median</span><span class="p">,</span>
             <span class="s1">&#39;min&#39;</span><span class="p">:</span><span class="n">min_</span><span class="p">,</span>
             <span class="s1">&#39;max&#39;</span><span class="p">:</span><span class="n">max_</span><span class="p">,</span>
             <span class="s1">&#39;std&#39;</span><span class="p">:</span><span class="n">std</span><span class="p">,</span>
             <span class="s1">&#39;IQR&#39;</span><span class="p">:</span> <span class="n">IQR</span><span class="p">}</span>
        <span class="k">return</span> <span class="n">res</span></div>

<div class="viewcode-block" id="Series.plot"><a class="viewcode-back" href="../../../core/ui.html#pyleoclim.core.ui.Series.plot">[docs]</a>    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
             <span class="n">marker</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">linestyle</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">plot_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lgd_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">savefig_settings</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mute</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">invert_xaxis</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Plot the timeseries</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        figsize : list</span>
<span class="sd">            a list of two integers indicating the figure size</span>

<span class="sd">        marker : str</span>
<span class="sd">            e.g., &#39;o&#39; for dots</span>
<span class="sd">            See [matplotlib.markers](https://matplotlib.org/3.1.3/api/markers_api.html) for details</span>

<span class="sd">        markersize : float</span>
<span class="sd">            the size of the marker</span>

<span class="sd">        color : str, list</span>
<span class="sd">            the color for the line plot</span>
<span class="sd">            e.g., &#39;r&#39; for red</span>
<span class="sd">            See [matplotlib colors] (https://matplotlib.org/3.2.1/tutorials/colors/colors.html) for details</span>

<span class="sd">        linestyle : str</span>
<span class="sd">            e.g., &#39;--&#39; for dashed line</span>
<span class="sd">            See [matplotlib.linestyles](https://matplotlib.org/3.1.0/gallery/lines_bars_and_markers/linestyles.html) for details</span>

<span class="sd">        linewidth : float</span>
<span class="sd">            the width of the line</span>

<span class="sd">        label : str</span>
<span class="sd">            the label for the line</span>

<span class="sd">        xlabel : str</span>
<span class="sd">            the label for the x-axis</span>

<span class="sd">        ylabel : str</span>
<span class="sd">            the label for the y-axis</span>

<span class="sd">        title : str</span>
<span class="sd">            the title for the figure</span>

<span class="sd">        zorder : int</span>
<span class="sd">            The default drawing order for all lines on the plot</span>

<span class="sd">        legend : {True, False}</span>
<span class="sd">            plot legend or not</span>

<span class="sd">        invert_xaxis : bool, optional</span>
<span class="sd">            if True, the x-axis of the plot will be inverted</span>

<span class="sd">        plot_kwargs : dict</span>
<span class="sd">            the dictionary of keyword arguments for ax.plot()</span>
<span class="sd">            See [matplotlib.pyplot.plot](https://matplotlib.org/3.1.3/api/_as_gen/matplotlib.pyplot.plot.html) for details</span>

<span class="sd">        lgd_kwargs : dict</span>
<span class="sd">            the dictionary of keyword arguments for ax.legend()</span>
<span class="sd">            See [matplotlib.pyplot.legend](https://matplotlib.org/3.1.3/api/_as_gen/matplotlib.pyplot.legend.html) for details</span>

<span class="sd">        alpha : float</span>
<span class="sd">            Transparency setting</span>

<span class="sd">        savefig_settings : dict</span>
<span class="sd">            the dictionary of arguments for plt.savefig(); some notes below:</span>
<span class="sd">            - &quot;path&quot; must be specified; it can be any existed or non-existed path,</span>
<span class="sd">              with or without a suffix; if the suffix is not given in &quot;path&quot;, it will follow &quot;format&quot;</span>
<span class="sd">            - &quot;format&quot; can be one of {&quot;pdf&quot;, &quot;eps&quot;, &quot;png&quot;, &quot;ps&quot;}</span>

<span class="sd">        ax : matplotlib.axis, optional</span>
<span class="sd">            the axis object from matplotlib</span>
<span class="sd">            See [matplotlib.axes](https://matplotlib.org/api/axes_api.html) for details.</span>

<span class="sd">        mute : {True,False}</span>
<span class="sd">            if True, the plot will not show;</span>
<span class="sd">            recommend to turn on when more modifications are going to be made on ax</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        fig : matplotlib.figure</span>
<span class="sd">            the figure object from matplotlib</span>
<span class="sd">            See [matplotlib.pyplot.figure](https://matplotlib.org/3.1.1/api/_as_gen/matplotlib.pyplot.figure.html) for details.</span>

<span class="sd">        ax : matplotlib.axis</span>
<span class="sd">            the axis object from matplotlib</span>
<span class="sd">            See [matplotlib.axes](https://matplotlib.org/api/axes_api.html) for details.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>

<span class="sd">        When `ax` is passed, the return will be `ax` only; otherwise, both `fig` and `ax` will be returned.</span>

<span class="sd">        See also</span>
<span class="sd">        --------</span>

<span class="sd">        pyleoclim.utils.plotting.savefig : saving figure in Pyleoclim</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        Plot the SOI record</span>

<span class="sd">            .. ipython:: python</span>
<span class="sd">                :okwarning:</span>

<span class="sd">                import pyleoclim as pyleo</span>
<span class="sd">                import pandas as pd</span>
<span class="sd">                data = pd.read_csv(&#39;https://raw.githubusercontent.com/LinkedEarth/Pyleoclim_util/Development/example_data/soi_data.csv&#39;,skiprows=0,header=1)</span>
<span class="sd">                time = data.iloc[:,1]</span>
<span class="sd">                value = data.iloc[:,2]</span>
<span class="sd">                ts = pyleo.Series(time=time,value=value,time_name=&#39;Year C.E&#39;, value_name=&#39;SOI&#39;, label=&#39;SOI&#39;)</span>
<span class="sd">                @savefig ts_plot.png</span>
<span class="sd">                fig, ax = ts.plot()</span>
<span class="sd">                pyleo.closefig(fig)</span>

<span class="sd">        Change the line color</span>

<span class="sd">            .. ipython:: python</span>
<span class="sd">                :okwarning:</span>

<span class="sd">                @savefig ts_plot2.png</span>
<span class="sd">                fig, ax = ts.plot(color=&#39;r&#39;)</span>
<span class="sd">                pyleo.closefig(fig)</span>

<span class="sd">        Save the figure. Two options available:</span>
<span class="sd">            * Within the plotting command</span>
<span class="sd">            * After the figure has been generated</span>

<span class="sd">            .. ipython:: python</span>
<span class="sd">                :okwarning:</span>

<span class="sd">                fig, ax = ts.plot(color=&#39;k&#39;, savefig_settings={&#39;path&#39;: &#39;ts_plot3.png&#39;})</span>
<span class="sd">                pyleo.savefig(fig,path=&#39;ts_plot3.png&#39;)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># Turn the interactive mode off.</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ioff</span><span class="p">()</span>

        <span class="c1"># generate default axis labels</span>
        <span class="n">time_label</span><span class="p">,</span> <span class="n">value_label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_labels</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">xlabel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">xlabel</span> <span class="o">=</span> <span class="n">time_label</span>

        <span class="k">if</span> <span class="n">ylabel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ylabel</span> <span class="o">=</span> <span class="n">value_label</span>

        <span class="n">plot_kwargs</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">plot_kwargs</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">plot_kwargs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">label</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">label</span>

        <span class="k">if</span> <span class="n">label</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">plot_kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="n">label</span><span class="p">})</span>

        <span class="k">if</span> <span class="n">marker</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">plot_kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;marker&#39;</span><span class="p">:</span> <span class="n">marker</span><span class="p">})</span>

        <span class="k">if</span> <span class="n">markersize</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">plot_kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;markersize&#39;</span><span class="p">:</span> <span class="n">markersize</span><span class="p">})</span>

        <span class="k">if</span> <span class="n">color</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">plot_kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="n">color</span><span class="p">})</span>

        <span class="k">if</span> <span class="n">linestyle</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">plot_kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;linestyle&#39;</span><span class="p">:</span> <span class="n">linestyle</span><span class="p">})</span>

        <span class="k">if</span> <span class="n">linewidth</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">plot_kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;linewidth&#39;</span><span class="p">:</span> <span class="n">linewidth</span><span class="p">})</span>

        <span class="k">if</span> <span class="n">alpha</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">plot_kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;alpha&#39;</span><span class="p">:</span> <span class="n">alpha</span><span class="p">})</span>

        <span class="k">if</span> <span class="n">zorder</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">plot_kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;zorder&#39;</span><span class="p">:</span> <span class="n">zorder</span><span class="p">})</span>

        <span class="n">res</span> <span class="o">=</span> <span class="n">plotting</span><span class="o">.</span><span class="n">plot_xy</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="n">xlabel</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="n">ylabel</span><span class="p">,</span>
            <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">savefig_settings</span><span class="o">=</span><span class="n">savefig_settings</span><span class="p">,</span>
            <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="n">legend</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="n">xlim</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="n">ylim</span><span class="p">,</span>
            <span class="n">plot_kwargs</span><span class="o">=</span><span class="n">plot_kwargs</span><span class="p">,</span> <span class="n">lgd_kwargs</span><span class="o">=</span><span class="n">lgd_kwargs</span><span class="p">,</span>
            <span class="n">mute</span><span class="o">=</span><span class="n">mute</span><span class="p">,</span> <span class="n">invert_xaxis</span><span class="o">=</span><span class="n">invert_xaxis</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">res</span></div>

<div class="viewcode-block" id="Series.ssa"><a class="viewcode-back" href="../../../core/ui.html#pyleoclim.core.ui.Series.ssa">[docs]</a>    <span class="k">def</span> <span class="nf">ssa</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">M</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nMC</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">trunc</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">var_thresh</span><span class="o">=</span><span class="mi">80</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Singular Spectrum Analysis</span>

<span class="sd">        Nonparametric, orthogonal decomposition of timeseries into constituent oscillations.</span>
<span class="sd">        This implementation  uses the method of [1], with applications presented in [2].</span>
<span class="sd">        Optionally (MC&gt;0), the significance of eigenvalues is assessed by Monte-Carlo simulations of an AR(1) model fit to X, using [3].</span>
<span class="sd">        The method expects regular spacing, but is tolerant to missing values, up to a fraction 0&lt;f&lt;1 (see [4]).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        M : int, optional</span>
<span class="sd">            window size. The default is None (10% of the length of the series).</span>
<span class="sd">        MC : int, optional</span>
<span class="sd">            Number of iteration in the Monte-Carlo process. The default is 0.</span>
<span class="sd">        f : float, optional</span>
<span class="sd">            maximum allowable fraction of missing values. The default is 0.3.</span>
<span class="sd">        trunc : str</span>
<span class="sd">            if present, truncates the expansion to a level K &lt; M owing to one of 3 criteria:</span>
<span class="sd">                (1) &#39;kaiser&#39;: variant of the Kaiser-Guttman rule, retaining eigenvalues larger than the median</span>
<span class="sd">                (2) &#39;mc-ssa&#39;: Monte-Carlo SSA (use modes above the 95% threshold)</span>
<span class="sd">                (3) &#39;var&#39;: first K modes that explain at least var_thresh % of the variance.</span>
<span class="sd">            Default is None, which bypasses truncation (K = M)</span>

<span class="sd">        var_thresh : float</span>
<span class="sd">            variance threshold for reconstruction (only impcatful if trunc is set to &#39;var&#39;)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        res : dict</span>
<span class="sd">            Containing:</span>

<span class="sd">            - eigval : (M, 1) array of eigenvalue spectrum of length r, the number of SSA modes. As in Principal Component Analysis, eigenvaluesare closely related to the fraction of variance accounted for (&quot;explained&quot;, a common but not-so-helpful term) by each mode.</span>

<span class="sd">            - eig_vec : is a matrix of the temporal eigenvectors (T-EOFs), i.e. the temporal patterns that explain most of the variations in the original series.</span>

<span class="sd">            - PC : (N - M + 1, M) array of principal components, i.e. the loadings that, convolved with the T-EOFs, produce the reconstructed components, or RCs</span>

<span class="sd">            - RC : (N,  M) array of reconstructed components, One can think of each RC as the contribution of each mode to the timeseries, weighted by their eigenvalue (loosely speaking, their &quot;amplitude&quot;). Summing over all columns of RC recovers the original series. (synthesis, the reciprocal operation of analysis).</span>

<span class="sd">            - eigval_q : (M, 2) array containing the 5% and 95% quantiles of the Monte-Carlo eigenvalue spectrum [ if MC &gt;0 ]</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        SSA with SOI</span>

<span class="sd">        .. ipython:: python</span>
<span class="sd">            :okwarning:</span>

<span class="sd">            import pyleoclim as pyleo</span>
<span class="sd">            import pandas as pd</span>
<span class="sd">            data = pd.read_csv(&#39;https://raw.githubusercontent.com/LinkedEarth/Pyleoclim_util/Development/example_data/soi_data.csv&#39;,skiprows=0,header=1)</span>
<span class="sd">            time = data.iloc[:,1]</span>
<span class="sd">            value = data.iloc[:,2]</span>
<span class="sd">            ts = pyleo.Series(time=time, value=value, time_name=&#39;Year C.E&#39;, value_name=&#39;SOI&#39;, label=&#39;SOI&#39;)</span>
<span class="sd">            # plot</span>
<span class="sd">            @savefig ts_plot4.png</span>
<span class="sd">            fig, ax = ts.plot()</span>
<span class="sd">            pyleo.closefig(fig)</span>

<span class="sd">            # SSA</span>
<span class="sd">            nino_ssa = ts.ssa(M=60)</span>

<span class="sd">        Let us now see how to make use of all these arrays. The first step is too inspect the eigenvalue spectrum (&quot;scree plot&quot;) to identify remarkable modes. Let us restrict ourselves to the first 40, so we can see something:</span>

<span class="sd">        .. ipython:: python</span>
<span class="sd">            :okwarning:</span>

<span class="sd">            import matplotlib.pyplot as plt</span>
<span class="sd">            import matplotlib.gridspec as gridspec</span>
<span class="sd">            import numpy as np</span>

<span class="sd">            d  = nino_ssa[&#39;eigvals&#39;] # extract eigenvalue vector</span>
<span class="sd">            M  = len(d)  # infer window size</span>
<span class="sd">            de = d*np.sqrt(2/(M-1))</span>
<span class="sd">            var_pct = nino_ssa[&#39;pctvar&#39;] # extract the fraction of variance attributable to each mode</span>

<span class="sd">            # plot eigenvalues</span>
<span class="sd">            r = 20</span>
<span class="sd">            rk = np.arange(0,r)+1</span>
<span class="sd">            fig, ax = plt.subplots()</span>
<span class="sd">            ax.errorbar(rk,d[:r],yerr=de[:r],label=&#39;SSA eigenvalues w/ 95% CI&#39;)</span>
<span class="sd">            ax.set_title(&#39;Scree plot of SSA eigenvalues&#39;)</span>
<span class="sd">            ax.set_xlabel(&#39;Rank $i$&#39;); plt.ylabel(r&#39;$\lambda_i$&#39;)</span>
<span class="sd">            ax.legend(loc=&#39;upper right&#39;)</span>
<span class="sd">            @savefig ts_eigen.png</span>
<span class="sd">            pyleo.showfig(fig)</span>
<span class="sd">            pyleo.closefig(fig)</span>

<span class="sd">        This highlights a few common phenomena with SSA:</span>
<span class="sd">            * the eigenvalues are in descending order</span>
<span class="sd">            * their uncertainties are proportional to the eigenvalues themselves</span>
<span class="sd">            * the eigenvalues tend to come in pairs : (1,2) (3,4), are all clustered within uncertainties . (5,6) looks like another doublet</span>
<span class="sd">            * around i=15, the eigenvalues appear to reach a floor, and all subsequent eigenvalues explain a very small amount of variance.</span>

<span class="sd">        So, summing the variance of all modes higher than 19, we get:</span>

<span class="sd">        .. ipython:: python</span>
<span class="sd">            :okwarning:</span>

<span class="sd">            print(var_pct[15:].sum()*100)</span>

<span class="sd">        That is, over 95% of the variance is in the first 15 modes. That is a typical result for a (paleo)climate timeseries; a few modes do the vast majority of the work. That means we can focus our attention on these modes and capture most of the interesting behavior. To see this, let&#39;s use the reconstructed components (RCs), and sum the RC matrix over the first 15 columns:</span>

<span class="sd">        .. ipython:: python</span>
<span class="sd">            :okwarning:</span>

<span class="sd">            RCk = nino_ssa[&#39;RCmat&#39;][:,:14].sum(axis=1)</span>
<span class="sd">            fig, ax = ts.plot(title=&#39;ONI&#39;,mute=True) # we mute the first call to only get the plot with 2 lines</span>
<span class="sd">            ax.plot(time,RCk,label=&#39;SSA reconstruction, 14 modes&#39;,color=&#39;orange&#39;)</span>
<span class="sd">            ax.legend()</span>
<span class="sd">            @savefig ssa_recon.png</span>
<span class="sd">            pyleo.showfig(fig)</span>
<span class="sd">            pyleo.closefig(fig)</span>

<span class="sd">        Indeed, these first few modes capture the vast majority of the low-frequency behavior, including all the El Nio/La Nia events. What is left (the blue wiggles not captured in the orange curve) are high-frequency oscillations that might be considered &quot;noise&quot; from the standpoint of ENSO dynamics. This illustrates how SSA might be used for filtering a timeseries. One must be careful however:</span>
<span class="sd">            * there was not much rhyme or reason for picking 15 modes. Why not 5, or 39? All we have seen so far is that they gather &gt;95% of the variance, which is by no means a magic number.</span>
<span class="sd">            * there is no guarantee that the first few modes will filter out high-frequency behavior, or at what frequency cutoff they will do so. If you need to cut out specific frequencies, you are better off doing it with a classical filter, like the butterworth filter implemented in Pyleoclim. However, in many instances the choice of a cutoff frequency is itself rather arbitrary. In such cases, SSA provides a principled alternative for generating a version of a timeseries that preserves features and excludes others (i.e, a filter).</span>
<span class="sd">            * as with all orthgonal decompositions, summing over all RCs will recover the original signal within numerical precision.</span>

<span class="sd">        Monte-Carlo SSA</span>

<span class="sd">        Selecting meaningful modes in eigenproblems (e.g. EOF analysis) is more art than science. However, one technique stands out: Monte Carlo SSA, introduced by Allen &amp; Smith, (1996) to identiy SSA modes that rise above what one would expect from &quot;red noise&quot;, specifically an AR(1) process_process). To run it, simply provide the parameter MC, ideally with a number of iterations sufficient to get decent statistics. Here&#39;s let&#39;s use MC = 1000. The result will be stored in the eigval_q array, which has the same length as eigval, and its two columns contain the 5% and 95% quantiles of the ensemble of MC-SSA eigenvalues.</span>

<span class="sd">        .. ipython:: python</span>
<span class="sd">            :okwarning:</span>

<span class="sd">            nino_mcssa = ts.ssa(M = 60, nMC=1000)</span>

<span class="sd">        Now let&#39;s look at the result:</span>

<span class="sd">        .. ipython:: python</span>
<span class="sd">            :okwarning:</span>

<span class="sd">            d  = nino_mcssa[&#39;eigvals&#39;] # extract eigenvalue vector</span>
<span class="sd">            de = d*np.sqrt(2/(M-1))</span>
<span class="sd">            du = nino_mcssa[&#39;eigvals_q&#39;][:,0]  # extract upper quantile of MC-SSA eigenvalues</span>
<span class="sd">            dl = nino_mcssa[&#39;eigvals_q&#39;][:,1]  # extract lower quantile of MC-SSA eigenvalues</span>

<span class="sd">            # plot eigenvalues</span>
<span class="sd">            rk = np.arange(0,20)+1</span>
<span class="sd">            fig = plt.figure()</span>
<span class="sd">            plt.fill_between(rk, dl[:20], du[:20], color=&#39;silver&#39;, alpha=0.5, label=&#39;MC-SSA 95% CI&#39;)</span>
<span class="sd">            plt.errorbar(rk,d[:20],yerr=de[:20],label=&#39;SSA eigenvalues w/ 95% CI&#39;)</span>
<span class="sd">            plt.title(&#39;Scree plot of SSA eigenvalues, w/ MC-SSA bounds&#39;)</span>
<span class="sd">            plt.xlabel(&#39;Rank $i$&#39;); plt.ylabel(r&#39;$\lambda_i$&#39;)</span>
<span class="sd">            plt.legend(loc=&#39;upper right&#39;)</span>
<span class="sd">            @savefig scree_nmc.png</span>
<span class="sd">            pyleo.showfig(fig)</span>
<span class="sd">            pyleo.closefig(fig)</span>

<span class="sd">        This suggests that modes 1-5 fall above the red noise benchmark.</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">res</span> <span class="o">=</span> <span class="n">decomposition</span><span class="o">.</span><span class="n">ssa</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">M</span><span class="o">=</span><span class="n">M</span><span class="p">,</span> <span class="n">nMC</span><span class="o">=</span><span class="n">nMC</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="n">f</span><span class="p">,</span> <span class="n">trunc</span> <span class="o">=</span> <span class="n">trunc</span><span class="p">,</span> <span class="n">var_thresh</span><span class="o">=</span><span class="n">var_thresh</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">res</span></div>

<div class="viewcode-block" id="Series.is_evenly_spaced"><a class="viewcode-back" href="../../../core/ui.html#pyleoclim.core.ui.Series.is_evenly_spaced">[docs]</a>    <span class="k">def</span> <span class="nf">is_evenly_spaced</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Check if the timeseries is evenly-spaced</span>

<span class="sd">        Returns</span>
<span class="sd">        ------</span>

<span class="sd">        res : bool</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">res</span> <span class="o">=</span> <span class="n">tsutils</span><span class="o">.</span><span class="n">is_evenly_spaced</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">res</span></div>

<div class="viewcode-block" id="Series.filter"><a class="viewcode-back" href="../../../core/ui.html#pyleoclim.core.ui.Series.filter">[docs]</a>    <span class="k">def</span> <span class="nf">filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cutoff_freq</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cutoff_scale</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;butterworth&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Filtering the timeseries</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        method : str, {&#39;savitzky-golay&#39;, &#39;butterworth&#39;}</span>
<span class="sd">            the filtering method</span>
<span class="sd">            - &#39;butterworth&#39;: the Butterworth method (default)</span>
<span class="sd">            - &#39;savitzky-golay&#39;: the Savitzky-Golay method</span>
<span class="sd">            - &#39;firwin&#39;: FIR filter design using the window method, with default window as Hanning</span>

<span class="sd">        cutoff_freq : float or list</span>
<span class="sd">            The cutoff frequency only works with the Butterworth method.</span>
<span class="sd">            If a float, it is interpreted as a low-frequency cutoff (lowpass).</span>
<span class="sd">            If a list,  it is interpreted as a frequency band (f1, f2), with f1 &lt; f2 (bandpass).</span>

<span class="sd">        cutoff_scale : float or list</span>
<span class="sd">            cutoff_freq = 1 / cutoff_scale</span>
<span class="sd">            The cutoff scale only works with the Butterworth method and when cutoff_freq is None.</span>
<span class="sd">            If a float, it is interpreted as a low-frequency (high-scale) cutoff (lowpass).</span>
<span class="sd">            If a list,  it is interpreted as a frequency band (f1, f2), with f1 &lt; f2 (bandpass).</span>

<span class="sd">        kwargs : dict</span>
<span class="sd">            a dictionary of the keyword arguments for the filtering method,</span>
<span class="sd">            see `pyleoclim.utils.filter.savitzky_golay`, `pyleoclim.utils.filter.butterworth`, and `pyleoclim.utils.filter.firwin` for the details</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        new : pyleoclim.Series</span>

<span class="sd">        See also</span>
<span class="sd">        --------</span>

<span class="sd">        pyleoclim.utils.filter.butterworth : Butterworth method</span>
<span class="sd">        pyleoclim.utils.filter.savitzky_golay : Savitzky-Golay method</span>
<span class="sd">        pyleoclim.utils.filter.firwin : FIR filter design using the window method</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        In the example below, we generate a signal as the sum of two signals with frequency 10 Hz and 20 Hz, respectively.</span>
<span class="sd">        Then we apply a low-pass filter with a cutoff frequency at 15 Hz, and compare the output to the signal of 10 Hz.</span>
<span class="sd">        After that, we apply a band-pass filter with the band 15-25 Hz, and compare the outcome to the signal of 20 Hz.</span>

<span class="sd">        - Generating the test data</span>

<span class="sd">        .. ipython:: python</span>
<span class="sd">            :okwarning:</span>

<span class="sd">            import pyleoclim as pyleo</span>
<span class="sd">            import numpy as np</span>

<span class="sd">            t = np.linspace(0, 1, 1000)</span>
<span class="sd">            sig1 = np.sin(2*np.pi*10*t)</span>
<span class="sd">            sig2 = np.sin(2*np.pi*20*t)</span>
<span class="sd">            sig = sig1 + sig2</span>
<span class="sd">            ts1 = pyleo.Series(time=t, value=sig1)</span>
<span class="sd">            ts2 = pyleo.Series(time=t, value=sig2)</span>
<span class="sd">            ts = pyleo.Series(time=t, value=sig)</span>
<span class="sd">            fig, ax = ts.plot(mute=True, label=&#39;mix&#39;)</span>
<span class="sd">            ts1.plot(ax=ax, label=&#39;10 Hz&#39;)</span>
<span class="sd">            ts2.plot(ax=ax, label=&#39;20 Hz&#39;)</span>
<span class="sd">            ax.legend(loc=&#39;upper left&#39;, bbox_to_anchor=(0, 1.1), ncol=3)</span>
<span class="sd">            @savefig ts_filter1.png</span>
<span class="sd">            pyleo.showfig(fig)</span>
<span class="sd">            pyleo.closefig(fig)</span>

<span class="sd">        - Applying the low-pass filter</span>

<span class="sd">        .. ipython:: python</span>
<span class="sd">            :okwarning:</span>

<span class="sd">            fig, ax = ts.plot(mute=True, label=&#39;mix&#39;)</span>
<span class="sd">            ts.filter(cutoff_freq=15).plot(ax=ax, label=&#39;After 15 Hz low-pass filter&#39;)</span>
<span class="sd">            ts1.plot(ax=ax, label=&#39;10 Hz&#39;)</span>
<span class="sd">            ax.legend(loc=&#39;upper left&#39;, bbox_to_anchor=(0, 1.1), ncol=3)</span>
<span class="sd">            @savefig ts_filter2.png</span>
<span class="sd">            pyleo.showfig(fig)</span>
<span class="sd">            pyleo.closefig(fig)</span>

<span class="sd">        - Applying the band-pass filter</span>

<span class="sd">        .. ipython:: python</span>
<span class="sd">            :okwarning:</span>

<span class="sd">            fig, ax = ts.plot(mute=True, label=&#39;mix&#39;)</span>
<span class="sd">            ts.filter(cutoff_freq=[15, 25]).plot(ax=ax, label=&#39;After 15-25 Hz band-pass filter&#39;)</span>
<span class="sd">            ts2.plot(ax=ax, label=&#39;20 Hz&#39;)</span>
<span class="sd">            ax.legend(loc=&#39;upper left&#39;, bbox_to_anchor=(0, 1.1), ncol=3)</span>
<span class="sd">            @savefig ts_filter3.png</span>
<span class="sd">            pyleo.showfig(fig)</span>
<span class="sd">            pyleo.closefig(fig)</span>

<span class="sd">        Above is using the default Butterworth filtering. To use FIR filtering with a window like Hanning is also simple:</span>
<span class="sd">        .. ipython:: python</span>
<span class="sd">            :okwarning:</span>

<span class="sd">            fig, ax = ts.plot(mute=True, label=&#39;mix&#39;)</span>
<span class="sd">            ts.filter(cutoff_freq=[15, 25], method=&#39;firwin&#39;, window=&#39;hanning&#39;).plot(ax=ax, label=&#39;After 15-25 Hz band-pass filter&#39;)</span>
<span class="sd">            ts2.plot(ax=ax, label=&#39;20 Hz&#39;)</span>
<span class="sd">            ax.legend(loc=&#39;upper left&#39;, bbox_to_anchor=(0, 1.1), ncol=3)</span>
<span class="sd">            @savefig ts_filter4.png</span>
<span class="sd">            pyleo.showfig(fig)</span>
<span class="sd">            pyleo.closefig(fig)</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_evenly_spaced</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;This  method assumes evenly-spaced timeseries, while the input is not. Use the &quot;.interp()&quot;, &quot;.bin()&quot; or &quot;.gkernel()&quot; methods prior to &quot;.filter()&quot;.&#39;</span><span class="p">)</span>

        <span class="n">new</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        
        <span class="n">mu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span> <span class="c1"># extract the mean</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">-</span> <span class="n">mu</span>

        <span class="n">method_func</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;savitzky-golay&#39;</span><span class="p">:</span> <span class="n">filterutils</span><span class="o">.</span><span class="n">savitzky_golay</span><span class="p">,</span>
            <span class="s1">&#39;butterworth&#39;</span><span class="p">:</span> <span class="n">filterutils</span><span class="o">.</span><span class="n">butterworth</span><span class="p">,</span>
            <span class="s1">&#39;firwin&#39;</span><span class="p">:</span> <span class="n">filterutils</span><span class="o">.</span><span class="n">firwin</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">args</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="n">method</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;butterworth&#39;</span><span class="p">,</span> <span class="s1">&#39;firwin&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">cutoff_freq</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">cutoff_scale</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Please set the cutoff frequency or scale argument: &quot;cutoff_freq&quot; or &quot;cutoff_scale&quot;.&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">cutoff_scale</span><span class="p">)</span> <span class="p">:</span>
                        <span class="n">cutoff_freq</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">cutoff_scale</span>
                    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">cutoff_scale</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="n">cutoff_scale</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cutoff_scale</span><span class="p">)</span>
                        <span class="n">cutoff_freq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">cutoff_scale</span><span class="p">)</span>
                        <span class="n">cutoff_freq</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">cutoff_freq</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Wrong cutoff_scale; should be either one float value (lowpass) or a list two float values (bandpass).&#39;</span><span class="p">)</span>

        <span class="n">args</span><span class="p">[</span><span class="s1">&#39;butterworth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;fc&#39;</span><span class="p">:</span> <span class="n">cutoff_freq</span><span class="p">,</span> <span class="s1">&#39;fs&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">))}</span>
        <span class="n">args</span><span class="p">[</span><span class="s1">&#39;firwin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;fc&#39;</span><span class="p">:</span> <span class="n">cutoff_freq</span><span class="p">,</span> <span class="s1">&#39;fs&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">))}</span>
        <span class="n">args</span><span class="p">[</span><span class="n">method</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">new_val</span> <span class="o">=</span> <span class="n">method_func</span><span class="p">[</span><span class="n">method</span><span class="p">](</span><span class="n">y</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span><span class="p">[</span><span class="n">method</span><span class="p">])</span>
        <span class="n">new</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">new_val</span> <span class="o">+</span> <span class="n">mu</span> <span class="c1"># restore the mean</span>

        <span class="k">return</span> <span class="n">new</span></div>



<div class="viewcode-block" id="Series.distplot"><a class="viewcode-back" href="../../../core/ui.html#pyleoclim.core.ui.Series.distplot">[docs]</a>    <span class="k">def</span> <span class="nf">distplot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">savefig_settings</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;KDE&#39;</span><span class="p">,</span> <span class="n">vertical</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span><span class="n">mute</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">plot_kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Plot the distribution of the timeseries values</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        figsize : list</span>
<span class="sd">            a list of two integers indicating the figure size</span>

<span class="sd">        title : str</span>
<span class="sd">            the title for the figure</span>

<span class="sd">        savefig_settings : dict</span>
<span class="sd">            the dictionary of arguments for plt.savefig(); some notes below:</span>
<span class="sd">              - &quot;path&quot; must be specified; it can be any existed or non-existed path,</span>
<span class="sd">                with or without a suffix; if the suffix is not given in &quot;path&quot;, it will follow &quot;format&quot;</span>
<span class="sd">              - &quot;format&quot; can be one of {&quot;pdf&quot;, &quot;eps&quot;, &quot;png&quot;, &quot;ps&quot;}</span>

<span class="sd">        ax : matplotlib.axis, optional</span>
<span class="sd">            A matplotlib axis</span>

<span class="sd">        ylabel : str</span>
<span class="sd">            Label for the count axis</span>

<span class="sd">        vertical : {True,False}</span>
<span class="sd">            Whether to flip the plot vertically</span>

<span class="sd">        edgecolor : matplotlib.color</span>
<span class="sd">            The color of the edges of the bar</span>

<span class="sd">        mute : {True,False}</span>
<span class="sd">            if True, the plot will not show;</span>
<span class="sd">            recommend to turn on when more modifications are going to be made on ax</span>

<span class="sd">        plot_kwargs : dict</span>
<span class="sd">            Plotting arguments for seaborn histplot: https://seaborn.pydata.org/generated/seaborn.histplot.html</span>


<span class="sd">        ax : matplotlib.axis, optional</span>
<span class="sd">            A matplotlib axis</span>

<span class="sd">        ylabel : str</span>
<span class="sd">            Label for the count axis</span>

<span class="sd">        vertical : {True,False}</span>
<span class="sd">            Whether to flip the plot vertically</span>

<span class="sd">        edgecolor : matplotlib.color</span>
<span class="sd">            The color of the edges of the bar</span>

<span class="sd">        mute : {True,False}</span>
<span class="sd">            if True, the plot will not show;</span>
<span class="sd">            recommend to turn on when more modifications are going to be made on ax</span>

<span class="sd">        plot_kwargs : dict</span>
<span class="sd">            Plotting arguments for seaborn histplot: https://seaborn.pydata.org/generated/seaborn.histplot.html</span>


<span class="sd">        See also</span>
<span class="sd">        --------</span>

<span class="sd">        pyleoclim.utils.plotting.savefig : saving figure in Pyleoclim</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        Distribution of the SOI record</span>

<span class="sd">        .. ipython:: python</span>
<span class="sd">            :okwarning:</span>

<span class="sd">            import pyleoclim as pyleo</span>
<span class="sd">            import pandas as pd</span>
<span class="sd">            data=pd.read_csv(&#39;https://raw.githubusercontent.com/LinkedEarth/Pyleoclim_util/Development/example_data/soi_data.csv&#39;,skiprows=0,header=1)</span>
<span class="sd">            time=data.iloc[:,1]</span>
<span class="sd">            value=data.iloc[:,2]</span>
<span class="sd">            ts=pyleo.Series(time=time,value=value,time_name=&#39;Year C.E&#39;, value_name=&#39;SOI&#39;, label=&#39;SOI&#39;)</span>

<span class="sd">            @savefig ts_plot5.png</span>
<span class="sd">            fig, ax = ts.plot()</span>
<span class="sd">            pyleo.closefig(fig)</span>

<span class="sd">            @savefig ts_dist.png</span>
<span class="sd">            fig, ax = ts.distplot()</span>
<span class="sd">            pyleo.closefig(fig)</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># Turn the interactive mode off.</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ioff</span><span class="p">()</span>

        <span class="n">savefig_settings</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">savefig_settings</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">savefig_settings</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>

        <span class="c1">#make the data into a dataframe so we can flip the figure</span>
        <span class="n">time_label</span><span class="p">,</span> <span class="n">value_label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_labels</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">vertical</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">data</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;value&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">})</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">kde</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="n">edgecolor</span><span class="p">,</span> <span class="o">**</span><span class="n">plot_kwargs</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">value_label</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">kde</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="n">edgecolor</span><span class="p">,</span> <span class="o">**</span><span class="n">plot_kwargs</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">value_label</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;fig&#39;</span> <span class="ow">in</span> <span class="nb">locals</span><span class="p">():</span>
            <span class="k">if</span> <span class="s1">&#39;path&#39;</span> <span class="ow">in</span> <span class="n">savefig_settings</span><span class="p">:</span>
                <span class="n">plotting</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">settings</span><span class="o">=</span><span class="n">savefig_settings</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">mute</span><span class="p">:</span>
                    <span class="n">plotting</span><span class="o">.</span><span class="n">showfig</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ax</span></div>

<div class="viewcode-block" id="Series.summary_plot"><a class="viewcode-back" href="../../../core/ui.html#pyleoclim.core.ui.Series.summary_plot">[docs]</a>    <span class="k">def</span> <span class="nf">summary_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">psd</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">scalogram</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">savefig_settings</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">time_lim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">value_lim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">period_lim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">psd_lim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">n_signif_test</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
                    <span class="n">time_label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">value_label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">period_label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">psd_label</span><span class="o">=</span><span class="s1">&#39;PSD&#39;</span><span class="p">,</span> <span class="n">mute</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Generate a plot of the timeseries and its frequency content through spectral and wavelet analyses.</span>


<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        psd : PSD</span>
<span class="sd">            the PSD object of a Series. If None, will be calculated. This process can be slow as it will be using the WWZ method.</span>

<span class="sd">        scalogram : Scalogram</span>
<span class="sd">            the Scalogram object of a Series. If None, will be calculated. This process can be slow as it will be using the WWZ method.</span>

<span class="sd">        figsize : list</span>
<span class="sd">            a list of two integers indicating the figure size</span>

<span class="sd">        title : str</span>
<span class="sd">            the title for the figure</span>

<span class="sd">        time_lim : list or tuple</span>
<span class="sd">            the limitation of the time axis</span>

<span class="sd">        value_lim : list or tuple</span>
<span class="sd">            the limitation of the value axis of the timeseries</span>

<span class="sd">        period_lim : list or tuple</span>
<span class="sd">            the limitation of the period axis</span>

<span class="sd">        psd_lim : list or tuple</span>
<span class="sd">            the limitation of the psd axis</span>

<span class="sd">        n_signif_test=100 : int</span>
<span class="sd">            Number of Monte-Carlo simulations to perform for significance testing. Used when psd=None or scalogram=None</span>

<span class="sd">        time_label : str</span>
<span class="sd">            the label for the time axis</span>

<span class="sd">        value_label : str</span>
<span class="sd">            the label for the value axis of the timeseries</span>

<span class="sd">        period_label : str</span>
<span class="sd">            the label for the period axis</span>

<span class="sd">        psd_label : str</span>
<span class="sd">            the label for the amplitude axis of PDS</span>

<span class="sd">        savefig_settings : dict</span>
<span class="sd">            the dictionary of arguments for plt.savefig(); some notes below:</span>
<span class="sd">            - &quot;path&quot; must be specified; it can be any existed or non-existed path,</span>
<span class="sd">              with or without a suffix; if the suffix is not given in &quot;path&quot;, it will follow &quot;format&quot;</span>
<span class="sd">            - &quot;format&quot; can be one of {&quot;pdf&quot;, &quot;eps&quot;, &quot;png&quot;, &quot;ps&quot;}</span>

<span class="sd">        mute : {True,False}</span>
<span class="sd">            if True, the plot will not show;</span>
<span class="sd">            recommend to turn on when more modifications are going to be made on ax</span>

<span class="sd">        See also</span>
<span class="sd">        --------</span>

<span class="sd">        pyleoclim.core.ui.Series.spectral : Spectral analysis for a timeseries</span>

<span class="sd">        pyleoclim.core.ui.Series.wavelet : Wavelet analysis for a timeseries</span>

<span class="sd">        pyleoclim.utils.plotting.savefig : saving figure in Pyleoclim</span>

<span class="sd">        pyleoclim.core.ui.PSD : PSD object</span>

<span class="sd">        pyleoclim.core.ui.MultiplePSD : Multiple PSD object</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># Turn the interactive mode off.</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ioff</span><span class="p">()</span>

        <span class="n">savefig_settings</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">savefig_settings</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">savefig_settings</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
        <span class="n">gs</span> <span class="o">=</span> <span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span>
        <span class="n">gs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="n">ax</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">ax</span><span class="p">[</span><span class="s1">&#39;ts&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="p">:</span><span class="o">-</span><span class="mi">3</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="s1">&#39;ts&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="s1">&#39;ts&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">time_lim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="p">[</span><span class="s1">&#39;ts&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">time_lim</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value_lim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="p">[</span><span class="s1">&#39;ts&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">value_lim</span><span class="p">)</span>

        <span class="n">ax</span><span class="p">[</span><span class="s1">&#39;ts&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;bottom&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">ax</span><span class="p">[</span><span class="s1">&#39;scal&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span> <span class="p">:</span><span class="o">-</span><span class="mi">3</span><span class="p">],</span> <span class="n">sharex</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="s1">&#39;ts&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">scalogram</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">n_signif_test</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">scalogram</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wavelet</span><span class="p">()</span><span class="o">.</span><span class="n">signif_test</span><span class="p">(</span><span class="n">number</span><span class="o">=</span><span class="n">n_signif_test</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">scalogram</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wavelet</span><span class="p">()</span>

        <span class="n">ax</span><span class="p">[</span><span class="s1">&#39;scal&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">scalogram</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="s1">&#39;scal&#39;</span><span class="p">],</span> <span class="n">cbar_style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;orientation&#39;</span><span class="p">:</span> <span class="s1">&#39;horizontal&#39;</span><span class="p">,</span> <span class="s1">&#39;pad&#39;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">})</span>

        <span class="n">ax</span><span class="p">[</span><span class="s1">&#39;psd&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">:],</span> <span class="n">sharey</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="s1">&#39;scal&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">psd</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">n_signif_test</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">psd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spectral</span><span class="p">()</span><span class="o">.</span><span class="n">signif_test</span><span class="p">(</span><span class="n">number</span><span class="o">=</span><span class="n">n_signif_test</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">psd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spectral</span><span class="p">()</span>

        <span class="n">ax</span><span class="p">[</span><span class="s1">&#39;psd&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">psd</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="s1">&#39;psd&#39;</span><span class="p">],</span> <span class="n">transpose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">period_lim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="p">[</span><span class="s1">&#39;psd&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">period_lim</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="s1">&#39;psd&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="s1">&#39;psd&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="n">labelleft</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="s1">&#39;psd&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">psd_lim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="p">[</span><span class="s1">&#39;psd&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">psd_lim</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="p">[</span><span class="s1">&#39;ts&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">value_label</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">time_label</span><span class="p">,</span> <span class="n">value_label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_labels</span><span class="p">()</span>
            <span class="n">ax</span><span class="p">[</span><span class="s1">&#39;ts&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">value_label</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">time_label</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">time_label</span><span class="p">,</span> <span class="n">value_label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_labels</span><span class="p">()</span>
            <span class="n">ax</span><span class="p">[</span><span class="s1">&#39;scal&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">time_label</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">period_label</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">period_unit</span> <span class="o">=</span> <span class="n">infer_period_unit_from_time_unit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time_unit</span><span class="p">)</span>
            <span class="n">period_label</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;Period [</span><span class="si">{</span><span class="n">period_unit</span><span class="si">}</span><span class="s1">]&#39;</span> <span class="k">if</span> <span class="n">period_unit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s1">&#39;Period&#39;</span>
            <span class="n">ax</span><span class="p">[</span><span class="s1">&#39;scal&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">period_label</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">psd_label</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="p">[</span><span class="s1">&#39;psd&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">psd_label</span><span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;path&#39;</span> <span class="ow">in</span> <span class="n">savefig_settings</span><span class="p">:</span>
            <span class="n">plotting</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">settings</span><span class="o">=</span><span class="n">savefig_settings</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">mute</span><span class="p">:</span>
                <span class="n">plotting</span><span class="o">.</span><span class="n">showfig</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span></div>

<div class="viewcode-block" id="Series.copy"><a class="viewcode-back" href="../../../core/ui.html#pyleoclim.core.ui.Series.copy">[docs]</a>    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Make a copy of the Series object</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Series</span>
<span class="sd">            A copy of the Series object</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="Series.clean"><a class="viewcode-back" href="../../../core/ui.html#pyleoclim.core.ui.Series.clean">[docs]</a>    <span class="k">def</span> <span class="nf">clean</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Clean up the timeseries by removing NaNs and sort with increasing time points</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        verbose : bool</span>
<span class="sd">            If True, will print warning messages if there is any</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Series</span>
<span class="sd">            Series object with removed NaNs and sorting</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">new</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">v_mod</span><span class="p">,</span> <span class="n">t_mod</span> <span class="o">=</span> <span class="n">tsutils</span><span class="o">.</span><span class="n">clean_ts</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="n">new</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="n">t_mod</span>
        <span class="n">new</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">v_mod</span>
        <span class="k">return</span> <span class="n">new</span></div>

<div class="viewcode-block" id="Series.gaussianize"><a class="viewcode-back" href="../../../core/ui.html#pyleoclim.core.ui.Series.gaussianize">[docs]</a>    <span class="k">def</span> <span class="nf">gaussianize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Gaussianizes the timeseries</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        new : pyleoclim.Series</span>
<span class="sd">            The Gaussianized series object</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">new</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">v_mod</span> <span class="o">=</span> <span class="n">tsutils</span><span class="o">.</span><span class="n">gaussianize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="n">new</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">v_mod</span>
        <span class="k">return</span> <span class="n">new</span></div>

<div class="viewcode-block" id="Series.standardize"><a class="viewcode-back" href="../../../core/ui.html#pyleoclim.core.ui.Series.standardize">[docs]</a>    <span class="k">def</span> <span class="nf">standardize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Standardizes the time series</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        new : pyleoclim.Series</span>
<span class="sd">            The standardized series object</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">new</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">v_mod</span> <span class="o">=</span> <span class="n">tsutils</span><span class="o">.</span><span class="n">standardize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">new</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">v_mod</span>
        <span class="k">return</span> <span class="n">new</span></div>

<div class="viewcode-block" id="Series.anomaly"><a class="viewcode-back" href="../../../core/ui.html#pyleoclim.core.ui.Series.anomaly">[docs]</a>    <span class="k">def</span> <span class="nf">anomaly</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timespan</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Calculate the anomaly of the series</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        timespan : tuple or list</span>
<span class="sd">            The timespan of the mean as the reference for anomaly calculation.</span>
<span class="sd">            It is in form of [a, b], where a, b are two time points.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        new : pyleoclim.Series</span>
<span class="sd">            The standardized series object</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">new</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">timespan</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">v_mod</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="n">timespan</span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">v_mod</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="n">new</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">v_mod</span>
        <span class="k">return</span> <span class="n">new</span></div>

<div class="viewcode-block" id="Series.segment"><a class="viewcode-back" href="../../../core/ui.html#pyleoclim.core.ui.Series.segment">[docs]</a>    <span class="k">def</span> <span class="nf">segment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">factor</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gap detection</span>

<span class="sd">        This function segments a timeseries into n number of parts following a gap</span>
<span class="sd">            detection algorithm. The rule of gap detection is very simple:</span>
<span class="sd">            we define the intervals between time points as dts, then if dts[i] is larger than factor * dts[i-1],</span>
<span class="sd">            we think that the change of dts (or the gradient) is too large, and we regard it as a breaking point</span>
<span class="sd">            and divide the time series into two segments here</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        ts : pyleoclim Series</span>

<span class="sd">        factor : float</span>
<span class="sd">            The factor that adjusts the threshold for gap detection</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        res : pyleoclim MultipleSeries Object or pyleoclim Series Object</span>
<span class="sd">            If gaps were detected, returns the segments in a MultipleSeries object,</span>
<span class="sd">            else, returns the original timeseries.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">seg_y</span><span class="p">,</span> <span class="n">seg_t</span><span class="p">,</span> <span class="n">n_segs</span> <span class="o">=</span> <span class="n">tsutils</span><span class="o">.</span><span class="n">ts2segments</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span><span class="n">factor</span><span class="o">=</span><span class="n">factor</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">seg_y</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">s_list</span><span class="o">=</span><span class="p">[]</span>
            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span><span class="n">s</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">seg_y</span><span class="p">):</span>
                <span class="n">s_tmp</span><span class="o">=</span><span class="n">Series</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">seg_t</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span><span class="n">value</span><span class="o">=</span><span class="n">s</span><span class="p">,</span><span class="n">time_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time_name</span><span class="p">,</span>
                             <span class="n">time_unit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time_unit</span><span class="p">,</span> <span class="n">value_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">value_name</span><span class="p">,</span>
                             <span class="n">value_unit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">value_unit</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="p">)</span>
                <span class="n">s_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s_tmp</span><span class="p">)</span>
            <span class="n">res</span><span class="o">=</span><span class="n">MultipleSeries</span><span class="p">(</span><span class="n">series_list</span><span class="o">=</span><span class="n">s_list</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">seg_y</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">res</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;No timeseries detected&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">res</span></div>

<div class="viewcode-block" id="Series.slice"><a class="viewcode-back" href="../../../core/ui.html#pyleoclim.core.ui.Series.slice">[docs]</a>    <span class="k">def</span> <span class="nf">slice</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timespan</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Slicing the timeseries with a timespan (tuple or list)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        timespan : tuple or list</span>
<span class="sd">            The list of time points for slicing, whose length must be even.</span>
<span class="sd">            When there are n time points, the output Series includes n/2 segments.</span>
<span class="sd">            For example, if timespan = [a, b], then the sliced output includes one segment [a, b];</span>
<span class="sd">            if timespan = [a, b, c, d], then the sliced output includes segment [a, b] and segment [c, d].</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        new : Series</span>
<span class="sd">            The sliced Series object.</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">new</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">n_elements</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">timespan</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">n_elements</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;The number of elements in timespan must be even!&#39;</span><span class="p">)</span>

        <span class="n">n_segments</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">n_elements</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">))]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_segments</span><span class="p">):</span>
            <span class="n">mask</span> <span class="o">|=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">&gt;=</span> <span class="n">timespan</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="mi">2</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">&lt;=</span> <span class="n">timespan</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>

        <span class="n">new</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
        <span class="n">new</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">new</span></div>

<div class="viewcode-block" id="Series.detrend"><a class="viewcode-back" href="../../../core/ui.html#pyleoclim.core.ui.Series.detrend">[docs]</a>    <span class="k">def</span> <span class="nf">detrend</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;emd&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Detrend Series object</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        method : str, optional</span>
<span class="sd">            The method for detrending. The default is &#39;emd&#39;.</span>
<span class="sd">            Options include:</span>
<span class="sd">                * linear: the result of a linear least-squares fit to y is subtracted from y.</span>
<span class="sd">                * constant: only the mean of data is subtrated.</span>
<span class="sd">                * &quot;savitzky-golay&quot;, y is filtered using the Savitzky-Golay filters and the resulting filtered series is subtracted from y.</span>
<span class="sd">                * &quot;emd&quot; (default): Empirical mode decomposition. The last mode is assumed to be the trend and removed from the series</span>
<span class="sd">        **kwargs : dict</span>
<span class="sd">            Relevant arguments for each of the methods.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        new : pyleoclim.Series</span>
<span class="sd">            Detrended Series object</span>

<span class="sd">        See also</span>
<span class="sd">        --------</span>
<span class="sd">        pyleoclim.utils.tsutils.detrend : detrending wrapper functions</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        We will generate a random signal and use the different detrending functions</span>

<span class="sd">        .. ipython:: python</span>
<span class="sd">            :okwarning:</span>

<span class="sd">            import pyleoclim as pyleo</span>
<span class="sd">            import numpy as np</span>

<span class="sd">            # Generate a mixed signal with known frequencies</span>
<span class="sd">            freqs=[1/20,1/80]</span>
<span class="sd">            time=np.arange(2001)</span>
<span class="sd">            signals=[]</span>
<span class="sd">            for freq in freqs:</span>
<span class="sd">                signals.append(np.cos(2*np.pi*freq*time))</span>
<span class="sd">            signal=sum(signals)</span>

<span class="sd">            # Add a non-linear trend</span>
<span class="sd">            slope = 1e-5</span>
<span class="sd">            intercept = -1</span>
<span class="sd">            nonlinear_trend = slope*time**2 + intercept</span>
<span class="sd">            signal_trend = signal + nonlinear_trend</span>

<span class="sd">            # Add white noise</span>
<span class="sd">            sig_var = np.var(signal)</span>
<span class="sd">            noise_var = sig_var / 2 #signal is twice the size of noise</span>
<span class="sd">            white_noise = np.random.normal(0, np.sqrt(noise_var), size=np.size(signal))</span>
<span class="sd">            signal_noise = signal_trend + white_noise</span>

<span class="sd">            # Create a series object</span>
<span class="sd">            ts = pyleo.Series(time=time,value=signal_noise)</span>
<span class="sd">            @savefig random_series.png</span>
<span class="sd">            fig, ax = ts.plot(title=&#39;Timeseries with nonlinear trend&#39;)</span>
<span class="sd">            pyleo.closefig(fig)</span>

<span class="sd">            # kStandardize</span>
<span class="sd">            ts_std = ts.standardize()</span>

<span class="sd">            # Detrend using EMD</span>
<span class="sd">            ts_emd = ts_std.detrend()</span>
<span class="sd">            @savefig ts_emd.png</span>
<span class="sd">            fig, ax = ts_emd.plot(title=&#39;Detrended with EMD method&#39;)</span>
<span class="sd">            pyleo.closefig(fig)</span>

<span class="sd">            # Detrend using Savitzky-Golay filter</span>
<span class="sd">            ts_sg = ts_std.detrend(method=&#39;savitzky-golay&#39;)</span>
<span class="sd">            @savefig ts_sg.png</span>
<span class="sd">            fig, ax = ts_sg.plot(title=&#39;Detrended with Savitzky-Golay filter&#39;)</span>
<span class="sd">            pyleo.closefig(fig)</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">new</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">v_mod</span> <span class="o">=</span> <span class="n">tsutils</span><span class="o">.</span><span class="n">detrend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">new</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">v_mod</span>
        <span class="k">return</span> <span class="n">new</span></div>

<div class="viewcode-block" id="Series.spectral"><a class="viewcode-back" href="../../../core/ui.html#pyleoclim.core.ui.Series.spectral">[docs]</a>    <span class="k">def</span> <span class="nf">spectral</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;lomb_scargle&#39;</span><span class="p">,</span> <span class="n">freq_method</span><span class="o">=</span><span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="n">freq_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">settings</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Perform spectral analysis on the timeseries</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        method : str</span>
<span class="sd">            {&#39;wwz&#39;, &#39;mtm&#39;, &#39;lomb_scargle&#39;, &#39;welch&#39;, &#39;periodogram&#39;}</span>

<span class="sd">        freq_method : str</span>
<span class="sd">            {&#39;log&#39;,&#39;scale&#39;, &#39;nfft&#39;, &#39;lomb_scargle&#39;, &#39;welch&#39;}</span>

<span class="sd">        freq_kwargs : dict</span>
<span class="sd">            Arguments for frequency vector</span>

<span class="sd">        settings : dict</span>
<span class="sd">            Arguments for the specific spectral method</span>

<span class="sd">        label : str</span>
<span class="sd">            Label for the PSD object</span>

<span class="sd">        verbose : bool</span>
<span class="sd">            If True, will print warning messages if there is any</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        psd : pyleoclim.PSD</span>
<span class="sd">            A :mod:`pyleoclim.PSD` object</span>

<span class="sd">        See also</span>
<span class="sd">        --------</span>
<span class="sd">        pyleoclim.utils.spectral.mtm : Spectral analysis using the Multitaper approach</span>

<span class="sd">        pyleoclim.utils.spectral.lomb_scargle : Spectral analysis using the Lomb-Scargle method</span>

<span class="sd">        pyleoclim.utils.spectral.welch: Spectral analysis using the Welch segement approach</span>

<span class="sd">        pyleoclim.utils.spectral.periodogram: Spectral anaysis using the basic Fourier transform</span>

<span class="sd">        pyleoclim.utils.spectral.wwz_psd : Spectral analysis using the Wavelet Weighted Z transform</span>

<span class="sd">        pyleoclim.utils.wavelet.make_freq_vector : Functions to create the frequency vector</span>

<span class="sd">        pyleoclim.utils.tsutils.detrend : Detrending function</span>

<span class="sd">        pyleoclim.core.ui.PSD : PSD object</span>

<span class="sd">        pyleoclim.core.ui.MultiplePSD : Multiple PSD object</span>


<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        Calculate the spectrum of SOI using the various methods and compute significance</span>

<span class="sd">        .. ipython:: python</span>
<span class="sd">            :okwarning:</span>

<span class="sd">            import pyleoclim as pyleo</span>
<span class="sd">            import pandas as pd</span>
<span class="sd">            data = pd.read_csv(&#39;https://raw.githubusercontent.com/LinkedEarth/Pyleoclim_util/Development/example_data/soi_data.csv&#39;,skiprows=0,header=1)</span>
<span class="sd">            time = data.iloc[:,1]</span>
<span class="sd">            value = data.iloc[:,2]</span>
<span class="sd">            ts = pyleo.Series(time=time, value=value, time_name=&#39;Year C.E&#39;, value_name=&#39;SOI&#39;, label=&#39;SOI&#39;)</span>
<span class="sd">            # Standardize the time series</span>
<span class="sd">            ts_std = ts.standardize()</span>

<span class="sd">        - Lomb-Scargle</span>

<span class="sd">        .. ipython:: python</span>
<span class="sd">            :okwarning:</span>

<span class="sd">            psd_ls = ts_std.spectral(method=&#39;lomb_scargle&#39;)</span>
<span class="sd">            psd_ls_signif = psd_ls.signif_test(number=20) #in practice, need more AR1 simulations</span>
<span class="sd">            @savefig spec_ls.png</span>
<span class="sd">            fig, ax = psd_ls_signif.plot(title=&#39;PSD using Lomb-Scargle method&#39;)</span>
<span class="sd">            pyleo.closefig(fig)</span>

<span class="sd">        We may pass in method-specific arguments via &quot;settings&quot;, which is a dictionary.</span>
<span class="sd">        For instance, to adjust the number of overlapping segment for Lomb-Scargle, we may specify the method-specific argument &quot;n50&quot;;</span>
<span class="sd">        to adjust the frequency vector, we may modify the &quot;freq_method&quot; or modify the method-specific argument &quot;freq&quot;.</span>

<span class="sd">        .. ipython:: python</span>
<span class="sd">            :okwarning:</span>

<span class="sd">            import numpy as np</span>
<span class="sd">            psd_LS_n50 = ts_std.spectral(method=&#39;lomb_scargle&#39;, settings={&#39;n50&#39;: 4})  # c=1e-2 yields lower frequency resolution</span>
<span class="sd">            psd_LS_freq = ts_std.spectral(method=&#39;lomb_scargle&#39;, settings={&#39;freq&#39;: np.linspace(1/20, 1/0.2, 51)})</span>
<span class="sd">            psd_LS_LS = ts_std.spectral(method=&#39;lomb_scargle&#39;, freq_method=&#39;lomb_scargle&#39;)  # with frequency vector generated using REDFIT method</span>
<span class="sd">            fig, ax = psd_LS_n50.plot(</span>
<span class="sd">                title=&#39;PSD using Lomb-Scargle method with 4 overlapping segments&#39;,</span>
<span class="sd">                label=&#39;settings={&quot;n50&quot;: 4}&#39;, mute=True)</span>
<span class="sd">            psd_ls.plot(ax=ax, label=&#39;settings={&quot;n50&quot;: 3}&#39;, marker=&#39;o&#39;)</span>
<span class="sd">            @savefig spec_ls_n50.png</span>
<span class="sd">            pyleo.showfig(fig)</span>
<span class="sd">            pyleo.closefig(fig)</span>

<span class="sd">            fig, ax = psd_LS_freq.plot(</span>
<span class="sd">                title=&#39;PSD using Lomb-Scargle method with differnt frequency vectors&#39;, mute=True,</span>
<span class="sd">                label=&#39;freq=np.linspace(1/20, 1/0.2, 51)&#39;, marker=&#39;o&#39;)</span>
<span class="sd">            psd_ls.plot(ax=ax, label=&#39;freq_method=&quot;log&quot;&#39;, marker=&#39;o&#39;)</span>
<span class="sd">            @savefig spec_ls_freq.png</span>
<span class="sd">            pyleo.showfig(fig)</span>
<span class="sd">            pyleo.closefig(fig)</span>

<span class="sd">        You may notice the differences in the PSD curves regarding smoothness and the locations of the analyzed period points.</span>

<span class="sd">        For other method-specific arguments, please look up the specific methods in the &quot;See also&quot; section.</span>

<span class="sd">        - WWZ</span>

<span class="sd">        .. ipython:: python</span>
<span class="sd">            :okwarning:</span>

<span class="sd">            psd_wwz = ts_std.spectral(method=&#39;wwz&#39;)  # wwz is the default method</span>
<span class="sd">            psd_wwz_signif = psd_wwz.signif_test(number=1)  # significance test; for real work, should use number=200 or even larger</span>
<span class="sd">            @savefig spec_wwz.png</span>
<span class="sd">            fig, ax = psd_wwz_signif.plot(title=&#39;PSD using WWZ method&#39;)</span>
<span class="sd">            pyleo.closefig(fig)</span>

<span class="sd">        - Periodogram</span>

<span class="sd">        .. ipython:: python</span>
<span class="sd">            :okwarning:</span>

<span class="sd">            ts_interp = ts_std.interp()</span>
<span class="sd">            psd_perio = ts_interp.spectral(method=&#39;periodogram&#39;)</span>
<span class="sd">            psd_perio_signif = psd_perio.signif_test(number=20) #in practice, need more AR1 simulations</span>
<span class="sd">            @savefig spec_perio.png</span>
<span class="sd">            fig, ax = psd_perio_signif.plot(title=&#39;PSD using Periodogram method&#39;)</span>
<span class="sd">            pyleo.closefig(fig)</span>

<span class="sd">        - Welch</span>

<span class="sd">        .. ipython:: python</span>
<span class="sd">            :okwarning:</span>

<span class="sd">            ts_interp = ts_std.interp()</span>
<span class="sd">            psd_welch = ts_interp.spectral(method=&#39;welch&#39;)</span>
<span class="sd">            psd_welch_signif = psd_welch.signif_test(number=20) #in practice, need more AR1 simulations</span>
<span class="sd">            @savefig spec_welch.png</span>
<span class="sd">            fig, ax = psd_welch_signif.plot(title=&#39;PSD using Welch method&#39;)</span>
<span class="sd">            pyleo.closefig(fig)</span>

<span class="sd">        - MTM</span>

<span class="sd">        .. ipython:: python</span>
<span class="sd">            :okwarning:</span>

<span class="sd">            ts_interp = ts_std.interp()</span>
<span class="sd">            psd_mtm = ts_interp.spectral(method=&#39;mtm&#39;)</span>
<span class="sd">            psd_mtm_signif = psd_mtm.signif_test(number=20) #in practice, need more AR1 simulations</span>
<span class="sd">            @savefig spec_mtm.png</span>
<span class="sd">            fig, ax = psd_mtm_signif.plot(title=&#39;PSD using MTM method&#39;)</span>
<span class="sd">            pyleo.closefig(fig)</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>

        <span class="n">settings</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">settings</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">settings</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">spec_func</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;wwz&#39;</span><span class="p">:</span> <span class="n">specutils</span><span class="o">.</span><span class="n">wwz_psd</span><span class="p">,</span>
            <span class="s1">&#39;mtm&#39;</span><span class="p">:</span> <span class="n">specutils</span><span class="o">.</span><span class="n">mtm</span><span class="p">,</span>
            <span class="s1">&#39;lomb_scargle&#39;</span><span class="p">:</span> <span class="n">specutils</span><span class="o">.</span><span class="n">lomb_scargle</span><span class="p">,</span>
            <span class="s1">&#39;welch&#39;</span><span class="p">:</span> <span class="n">specutils</span><span class="o">.</span><span class="n">welch</span><span class="p">,</span>
            <span class="s1">&#39;periodogram&#39;</span><span class="p">:</span> <span class="n">specutils</span><span class="o">.</span><span class="n">periodogram</span>
        <span class="p">}</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">freq_kwargs</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">freq_kwargs</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">freq_kwargs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">freq</span> <span class="o">=</span> <span class="n">waveutils</span><span class="o">.</span><span class="n">make_freq_vector</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">freq_method</span><span class="p">,</span> <span class="o">**</span><span class="n">freq_kwargs</span><span class="p">)</span>

        <span class="n">args</span><span class="p">[</span><span class="s1">&#39;wwz&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;freq&#39;</span><span class="p">:</span> <span class="n">freq</span><span class="p">}</span>
        <span class="n">args</span><span class="p">[</span><span class="s1">&#39;mtm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">args</span><span class="p">[</span><span class="s1">&#39;lomb_scargle&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;freq&#39;</span><span class="p">:</span> <span class="n">freq</span><span class="p">}</span>
        <span class="n">args</span><span class="p">[</span><span class="s1">&#39;welch&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">args</span><span class="p">[</span><span class="s1">&#39;periodogram&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">args</span><span class="p">[</span><span class="n">method</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span>
        <span class="n">spec_res</span> <span class="o">=</span> <span class="n">spec_func</span><span class="p">[</span><span class="n">method</span><span class="p">](</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span><span class="p">[</span><span class="n">method</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">spec_res</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">dict</span><span class="p">:</span>
            <span class="n">spec_res</span> <span class="o">=</span> <span class="n">dict2namedtuple</span><span class="p">(</span><span class="n">spec_res</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">label</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">label</span>

        <span class="n">psd</span> <span class="o">=</span> <span class="n">PSD</span><span class="p">(</span>
            <span class="n">frequency</span><span class="o">=</span><span class="n">spec_res</span><span class="o">.</span><span class="n">freq</span><span class="p">,</span>
            <span class="n">amplitude</span><span class="o">=</span><span class="n">spec_res</span><span class="o">.</span><span class="n">psd</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span>
            <span class="n">timeseries</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
            <span class="n">spec_method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span>
            <span class="n">spec_args</span><span class="o">=</span><span class="n">args</span><span class="p">[</span><span class="n">method</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">psd</span></div>

<div class="viewcode-block" id="Series.wavelet"><a class="viewcode-back" href="../../../core/ui.html#pyleoclim.core.ui.Series.wavelet">[docs]</a>    <span class="k">def</span> <span class="nf">wavelet</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;wwz&#39;</span><span class="p">,</span> <span class="n">settings</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">freq_method</span><span class="o">=</span><span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="n">ntau</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">freq_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Perform wavelet analysis on the timeseries</span>

<span class="sd">        cwt wavelets documented on https://pywavelets.readthedocs.io/en/latest/ref/cwt.html</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        method : {wwz, cwt}</span>
<span class="sd">            Whether to use the wwz method for unevenly spaced timeseries or traditional cwt (from pywavelets)</span>

<span class="sd">        freq_method : str</span>
<span class="sd">            {&#39;log&#39;, &#39;scale&#39;, &#39;nfft&#39;, &#39;lomb_scargle&#39;, &#39;welch&#39;}</span>

<span class="sd">        freq_kwargs : dict</span>
<span class="sd">            Arguments for frequency vector</span>

<span class="sd">        ntau : int</span>
<span class="sd">            The length of the time shift points that determins the temporal resolution of the result.</span>
<span class="sd">            If None, it will be either the length of the input time axis, or at most 50.</span>

<span class="sd">        settings : dict</span>
<span class="sd">            Arguments for the specific spectral method</span>

<span class="sd">        verbose : bool</span>
<span class="sd">            If True, will print warning messages if there is any</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        scal : Series.Scalogram</span>

<span class="sd">        See also</span>
<span class="sd">        --------</span>

<span class="sd">        pyleoclim.utils.wavelet.wwz : wwz function</span>

<span class="sd">        pyleoclim.utils.wavelet.cwt : cwt function</span>

<span class="sd">        pyleoclim.utils.wavelet.make_freq : Functions to create the frequency vector</span>

<span class="sd">        pyleoclim.utils.tsutils.detrend : Detrending function</span>

<span class="sd">        pyleoclim.core.ui.Scalogram : Scalogram object</span>

<span class="sd">        pyleoclim.core.ui.MultipleScalogram : Multiple Scalogram object</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        Wavelet analysis on the SOI record.</span>

<span class="sd">        .. ipython:: python</span>
<span class="sd">            :okwarning:</span>

<span class="sd">            import pyleoclim as pyleo</span>
<span class="sd">            import pandas as pd</span>
<span class="sd">            data = pd.read_csv(&#39;https://raw.githubusercontent.com/LinkedEarth/Pyleoclim_util/Development/example_data/soi_data.csv&#39;,skiprows=0,header=1)</span>
<span class="sd">            time = data.iloc[:,1]</span>
<span class="sd">            value = data.iloc[:,2]</span>
<span class="sd">            ts = pyleo.Series(time=time,value=value,time_name=&#39;Year C.E&#39;, value_name=&#39;SOI&#39;, label=&#39;SOI&#39;)</span>
<span class="sd">            # WWZ</span>
<span class="sd">            scal = ts.wavelet()</span>
<span class="sd">            scal_signif = scal.signif_test(number=1)  # for real work, should use number=200 or even larger</span>
<span class="sd">            @savefig spec_mtm.png</span>
<span class="sd">            fig, ax = scal_signif.plot()</span>
<span class="sd">            pyleo.closefig(fig)</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>

        <span class="n">settings</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">settings</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">settings</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">wave_func</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;wwz&#39;</span><span class="p">:</span> <span class="n">waveutils</span><span class="o">.</span><span class="n">wwz</span><span class="p">,</span>
            <span class="s1">&#39;cwt&#39;</span><span class="p">:</span> <span class="n">waveutils</span><span class="o">.</span><span class="n">cwt</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;cwt&#39;</span> <span class="ow">and</span> <span class="s1">&#39;freq&#39;</span> <span class="ow">in</span> <span class="n">settings</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">scales</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;freq&#39;</span><span class="p">])</span>
            <span class="n">settings</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;scales&#39;</span><span class="p">:</span><span class="n">scales</span><span class="p">})</span>
            <span class="k">del</span> <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;freq&#39;</span><span class="p">]</span>

        <span class="n">freq_kwargs</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">freq_kwargs</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">freq_kwargs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">freq</span> <span class="o">=</span> <span class="n">waveutils</span><span class="o">.</span><span class="n">make_freq_vector</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">freq_method</span><span class="p">,</span> <span class="o">**</span><span class="n">freq_kwargs</span><span class="p">)</span>

        <span class="n">args</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="n">ntau</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ntau</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">),</span> <span class="mi">50</span><span class="p">])</span>

        <span class="n">tau</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">),</span> <span class="n">ntau</span><span class="p">)</span>

        <span class="n">args</span><span class="p">[</span><span class="s1">&#39;wwz&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;tau&#39;</span><span class="p">:</span> <span class="n">tau</span><span class="p">,</span> <span class="s1">&#39;freq&#39;</span><span class="p">:</span> <span class="n">freq</span><span class="p">}</span>
        <span class="n">args</span><span class="p">[</span><span class="s1">&#39;cwt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;wavelet&#39;</span> <span class="p">:</span> <span class="s1">&#39;morl&#39;</span><span class="p">,</span> <span class="s1">&#39;scales&#39;</span><span class="p">:</span><span class="mi">1</span><span class="o">/</span><span class="n">freq</span><span class="p">}</span>


        <span class="n">args</span><span class="p">[</span><span class="n">method</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span>
        <span class="n">wave_res</span> <span class="o">=</span> <span class="n">wave_func</span><span class="p">[</span><span class="n">method</span><span class="p">](</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span><span class="p">[</span><span class="n">method</span><span class="p">])</span>
        <span class="n">scal</span> <span class="o">=</span> <span class="n">Scalogram</span><span class="p">(</span>
            <span class="n">frequency</span><span class="o">=</span><span class="n">wave_res</span><span class="o">.</span><span class="n">freq</span><span class="p">,</span>
            <span class="n">time</span><span class="o">=</span><span class="n">wave_res</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
            <span class="n">amplitude</span><span class="o">=</span><span class="n">wave_res</span><span class="o">.</span><span class="n">amplitude</span><span class="p">,</span>
            <span class="n">coi</span><span class="o">=</span><span class="n">wave_res</span><span class="o">.</span><span class="n">coi</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="p">,</span>
            <span class="n">timeseries</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
            <span class="n">wave_method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span>
            <span class="n">freq_method</span><span class="o">=</span><span class="n">freq_method</span><span class="p">,</span>
            <span class="n">freq_kwargs</span><span class="o">=</span><span class="n">freq_kwargs</span><span class="p">,</span>
            <span class="n">wave_args</span><span class="o">=</span><span class="n">args</span><span class="p">[</span><span class="n">method</span><span class="p">],</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">scal</span></div>

<div class="viewcode-block" id="Series.wavelet_coherence"><a class="viewcode-back" href="../../../core/ui.html#pyleoclim.core.ui.Series.wavelet_coherence">[docs]</a>    <span class="k">def</span> <span class="nf">wavelet_coherence</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target_series</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;wwz&#39;</span><span class="p">,</span> <span class="n">settings</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">freq_method</span><span class="o">=</span><span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="n">ntau</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">freq_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Perform wavelet coherence analysis with the target timeseries</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        target_series : pyleoclim.Series</span>
<span class="sd">            A pyleoclim Series object on which to perform the coherence analysis</span>

<span class="sd">        method : {&#39;wwz&#39;}</span>

<span class="sd">        freq_method : str</span>
<span class="sd">            {&#39;log&#39;,&#39;scale&#39;, &#39;nfft&#39;, &#39;lomb_scargle&#39;, &#39;welch&#39;}</span>

<span class="sd">        freq_kwargs : dict</span>
<span class="sd">            Arguments for frequency vector</span>

<span class="sd">        ntau : int</span>
<span class="sd">            The length of the time shift points that determins the temporal resolution of the result.</span>
<span class="sd">            If None, it will be either the length of the input time axis, or at most 50.</span>

<span class="sd">        settings : dict</span>
<span class="sd">            Arguments for the specific spectral method</span>

<span class="sd">        verbose : bool</span>
<span class="sd">            If True, will print warning messages if there is any</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        coh : pyleoclim.Coherence</span>

<span class="sd">        See also</span>
<span class="sd">        --------</span>

<span class="sd">        pyleoclim.utils.wavelet.xwt : Cross-wavelet analysis based on WWZ method</span>

<span class="sd">        pyleoclim.utils.wavelet.make_freq : Functions to create the frequency vector</span>

<span class="sd">        pyleoclim.utils.tsutils.detrend : Detrending function</span>

<span class="sd">        pyleoclim.core.ui.Coherence : Coherence object</span>


<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>

        <span class="n">settings</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">settings</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">settings</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">xwc_func</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;wwz&#39;</span><span class="p">:</span> <span class="n">waveutils</span><span class="o">.</span><span class="n">xwc</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">freq_kwargs</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">freq_kwargs</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">freq_kwargs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">freq</span> <span class="o">=</span> <span class="n">waveutils</span><span class="o">.</span><span class="n">make_freq_vector</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">freq_method</span><span class="p">,</span> <span class="o">**</span><span class="n">freq_kwargs</span><span class="p">)</span>

        <span class="n">t1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">)</span>
        <span class="n">t2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">target_series</span><span class="o">.</span><span class="n">time</span><span class="p">)</span>
        <span class="n">dt1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">t1</span><span class="p">))</span>
        <span class="n">dt2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">t2</span><span class="p">))</span>
        <span class="n">overlap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="n">t1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">t2</span><span class="p">[</span><span class="mi">0</span><span class="p">]]),</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">([</span><span class="n">t1</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">t2</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="n">dt1</span><span class="p">,</span> <span class="n">dt2</span><span class="p">]))</span>

        <span class="k">if</span> <span class="n">ntau</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ntau</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">overlap</span><span class="p">),</span> <span class="mi">50</span><span class="p">])</span>

        <span class="n">tau</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">overlap</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">overlap</span><span class="p">),</span> <span class="n">ntau</span><span class="p">)</span>

        <span class="n">args</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">args</span><span class="p">[</span><span class="s1">&#39;wwz&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;tau&#39;</span><span class="p">:</span> <span class="n">tau</span><span class="p">,</span> <span class="s1">&#39;freq&#39;</span><span class="p">:</span> <span class="n">freq</span><span class="p">}</span>
        <span class="n">args</span><span class="p">[</span><span class="n">method</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span>
        <span class="n">xwc_res</span> <span class="o">=</span> <span class="n">xwc_func</span><span class="p">[</span><span class="n">method</span><span class="p">](</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">target_series</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">target_series</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span><span class="p">[</span><span class="n">method</span><span class="p">])</span>

        <span class="n">coh</span> <span class="o">=</span> <span class="n">Coherence</span><span class="p">(</span>
            <span class="n">frequency</span><span class="o">=</span><span class="n">xwc_res</span><span class="o">.</span><span class="n">freq</span><span class="p">,</span>
            <span class="n">time</span><span class="o">=</span><span class="n">xwc_res</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
            <span class="n">coherence</span><span class="o">=</span><span class="n">xwc_res</span><span class="o">.</span><span class="n">xw_coherence</span><span class="p">,</span>
            <span class="n">phase</span><span class="o">=</span><span class="n">xwc_res</span><span class="o">.</span><span class="n">xw_phase</span><span class="p">,</span>
            <span class="n">coi</span><span class="o">=</span><span class="n">xwc_res</span><span class="o">.</span><span class="n">coi</span><span class="p">,</span>
            <span class="n">timeseries1</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
            <span class="n">timeseries2</span><span class="o">=</span><span class="n">target_series</span><span class="p">,</span>
            <span class="n">freq_method</span><span class="o">=</span><span class="n">freq_method</span><span class="p">,</span>
            <span class="n">freq_kwargs</span><span class="o">=</span><span class="n">freq_kwargs</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">coh</span></div>

<div class="viewcode-block" id="Series.correlation"><a class="viewcode-back" href="../../../core/ui.html#pyleoclim.core.ui.Series.correlation">[docs]</a>    <span class="k">def</span> <span class="nf">correlation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target_series</span><span class="p">,</span> <span class="n">timespan</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">settings</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">common_time_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Estimates the Pearson&#39;s correlation and associated significance between two non IID time series</span>

<span class="sd">        The significance of the correlation is assessed using one of the following methods:</span>

<span class="sd">        1) &#39;ttest&#39;: T-test adjusted for effective sample size.</span>
<span class="sd">        2) &#39;isopersistent&#39;: AR(1) modeling of x and y.</span>
<span class="sd">        3) &#39;isospectral&#39;: phase randomization of original inputs. (default)</span>

<span class="sd">        The T-test is a parametric test, hence computationally cheap but can only be performed in ideal circumstances.</span>
<span class="sd">        The others are non-parametric, but their computational requirements scale with the number of simulations.</span>

<span class="sd">        The choise of significance test and associated number of Monte-Carlo simulations are passed through the settings parameter.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        target_series : pyleoclim.Series</span>
<span class="sd">            A pyleoclim Series object</span>

<span class="sd">        timespan : tuple</span>
<span class="sd">            The time interval over which to perform the calculation</span>

<span class="sd">        alpha : float</span>
<span class="sd">            The significance level (default: 0.05)</span>

<span class="sd">        settings : dict</span>
<span class="sd">            Parameters for the correlation function, including:</span>

<span class="sd">            nsim : int</span>
<span class="sd">                the number of simulations (default: 1000)</span>
<span class="sd">            method : str, {&#39;ttest&#39;,&#39;isopersistent&#39;,&#39;isospectral&#39; (default)}</span>
<span class="sd">                method for significance testing</span>

<span class="sd">        common_time_kwargs : dict</span>
<span class="sd">            Parameters for the method `MultipleSeries.common_time()`. Will use interpolation by default.</span>

<span class="sd">        seed : float or int</span>
<span class="sd">            random seed for isopersistent and isospectral methods</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        corr_res_dict : dict</span>
<span class="sd">            the result dictionary, containing</span>

<span class="sd">            - r : float</span>
<span class="sd">                correlation coefficient</span>
<span class="sd">            - p : float</span>
<span class="sd">                the p-value</span>
<span class="sd">            - signif : bool</span>
<span class="sd">                true if significant; false otherwise</span>
<span class="sd">                Note that signif = True if and only if p &lt;= alpha.</span>

<span class="sd">        See also</span>
<span class="sd">        --------</span>

<span class="sd">        pyleoclim.utils.correlation.corr_sig : Correlation function</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        Correlation between the Nino3.4 index and the Deasonalized All Indian Rainfall Index</span>

<span class="sd">        .. ipython:: python</span>
<span class="sd">            :okwarning:</span>

<span class="sd">            import pyleoclim as pyleo</span>
<span class="sd">            import pandas as pd</span>

<span class="sd">            data = pd.read_csv(&#39;https://raw.githubusercontent.com/LinkedEarth/Pyleoclim_util/Development/example_data/wtc_test_data_nino.csv&#39;)</span>
<span class="sd">            t = data.iloc[:, 0]</span>
<span class="sd">            air = data.iloc[:, 1]</span>
<span class="sd">            nino = data.iloc[:, 2]</span>
<span class="sd">            ts_nino = pyleo.Series(time=t, value=nino)</span>
<span class="sd">            ts_air = pyleo.Series(time=t, value=air)</span>

<span class="sd">            # with `nsim=20` and default `method=&#39;isospectral&#39;`</span>
<span class="sd">            # set an arbitrary randome seed to fix the result</span>
<span class="sd">            corr_res = ts_nino.correlation(ts_air, settings={&#39;nsim&#39;: 20}, seed=2333)</span>
<span class="sd">            print(corr_res)</span>

<span class="sd">            # using a simple t-test</span>
<span class="sd">            # set an arbitrary randome seed to fix the result</span>
<span class="sd">            corr_res = ts_nino.correlation(ts_air, settings={&#39;nsim&#39;: 20, &#39;method&#39;: &#39;ttest&#39;}, seed=2333)</span>
<span class="sd">            print(corr_res)</span>

<span class="sd">            # using the method &quot;isopersistent&quot;</span>
<span class="sd">            # set an arbitrary randome seed to fix the result</span>
<span class="sd">            corr_res = ts_nino.correlation(ts_air, settings={&#39;nsim&#39;: 20, &#39;method&#39;: &#39;isopersistent&#39;}, seed=2333)</span>
<span class="sd">            print(corr_res)</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">settings</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">settings</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">settings</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">corr_args</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;alpha&#39;</span><span class="p">:</span> <span class="n">alpha</span><span class="p">}</span>
        <span class="n">corr_args</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span>

        <span class="n">ms</span> <span class="o">=</span> <span class="n">MultipleSeries</span><span class="p">([</span><span class="bp">self</span><span class="p">,</span> <span class="n">target_series</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">list</span><span class="p">(</span><span class="n">target_series</span><span class="o">.</span><span class="n">time</span><span class="p">):</span>
            <span class="n">common_time_kwargs</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">common_time_kwargs</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">common_time_kwargs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">ct_args</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;method&#39;</span><span class="p">:</span> <span class="s1">&#39;interp&#39;</span><span class="p">}</span>
            <span class="n">ct_args</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">common_time_kwargs</span><span class="p">)</span>
            <span class="n">ms</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">common_time</span><span class="p">(</span><span class="o">**</span><span class="n">ct_args</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">timespan</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">value1</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">series_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
            <span class="n">value2</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">series_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">value1</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">series_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="n">timespan</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
            <span class="n">value2</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">series_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="n">timespan</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>


        <span class="k">if</span> <span class="n">seed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>

        <span class="n">corr_res</span> <span class="o">=</span> <span class="n">corrutils</span><span class="o">.</span><span class="n">corr_sig</span><span class="p">(</span><span class="n">value1</span><span class="p">,</span> <span class="n">value2</span><span class="p">,</span> <span class="o">**</span><span class="n">corr_args</span><span class="p">)</span>
        <span class="n">signif</span> <span class="o">=</span> <span class="kc">True</span> <span class="k">if</span> <span class="n">corr_res</span><span class="p">[</span><span class="s1">&#39;signif&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="kc">False</span>
        <span class="n">corr_res_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;r&#39;</span><span class="p">:</span> <span class="n">corr_res</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">],</span>
            <span class="s1">&#39;p&#39;</span><span class="p">:</span> <span class="n">corr_res</span><span class="p">[</span><span class="s1">&#39;p&#39;</span><span class="p">],</span>
            <span class="s1">&#39;signif&#39;</span><span class="p">:</span> <span class="n">signif</span><span class="p">,</span>
            <span class="s1">&#39;alpha&#39;</span><span class="p">:</span> <span class="n">alpha</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">corr_res_dict</span></div>

<div class="viewcode-block" id="Series.causality"><a class="viewcode-back" href="../../../core/ui.html#pyleoclim.core.ui.Series.causality">[docs]</a>    <span class="k">def</span> <span class="nf">causality</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target_series</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;liang&#39;</span><span class="p">,</span> <span class="n">settings</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Perform causality analysis with the target timeseries</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        target_series : pyleoclim.Series</span>
<span class="sd">            A pyleoclim Series object on which to compute causality</span>

<span class="sd">        method : {&#39;liang&#39;, &#39;granger&#39;}</span>
<span class="sd">            The causality method to use.</span>

<span class="sd">        settings : dict</span>
<span class="sd">            Parameters associated with the causality methods. Note that each method has different parameters. See individual methods for details</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        res : dict</span>
<span class="sd">            Dictionary containing the results of the the causality analysis. See indivudal methods for details</span>

<span class="sd">        See also</span>
<span class="sd">        --------</span>

<span class="sd">        pyleoclim.utils.causality.liang_causality : Liang causality</span>

<span class="sd">        pyleoclim.utils.causality.granger_causality : Granger causality</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        Liang causality</span>

<span class="sd">        .. ipython:: python</span>
<span class="sd">            :okwarning:</span>

<span class="sd">            import pyleoclim as pyleo</span>
<span class="sd">            import pandas as pd</span>
<span class="sd">            data=pd.read_csv(&#39;https://raw.githubusercontent.com/LinkedEarth/Pyleoclim_util/Development/example_data/wtc_test_data_nino.csv&#39;)</span>
<span class="sd">            t=data.iloc[:,0]</span>
<span class="sd">            air=data.iloc[:,1]</span>
<span class="sd">            nino=data.iloc[:,2]</span>
<span class="sd">            ts_nino=pyleo.Series(time=t,value=nino)</span>
<span class="sd">            ts_air=pyleo.Series(time=t,value=air)</span>

<span class="sd">            # plot the two timeseries</span>
<span class="sd">            @savefig ts_nino.png</span>
<span class="sd">            fig, ax = ts_nino.plot(title=&#39;El Nino Region 3 -- SST Anomalies&#39;)</span>
<span class="sd">            pyleo.closefig(fig)</span>

<span class="sd">            @savefig ts_air.png</span>
<span class="sd">            fig, ax = ts_air.plot(title=&#39;Deasonalized All Indian Rainfall Index&#39;)</span>
<span class="sd">            pyleo.closefig(fig)</span>

<span class="sd">            # we use the specific params below in ts_nino.causality() just to make the example less heavier;</span>
<span class="sd">            # please drop the `settings` for real work</span>
<span class="sd">            caus_res = ts_nino.causality(ts_air, settings={&#39;nsim&#39;: 2, &#39;signif_test&#39;: &#39;isopersist&#39;})</span>
<span class="sd">            print(caus_res)</span>

<span class="sd">        Granger causality</span>

<span class="sd">        .. ipython:: python</span>
<span class="sd">            :okwarning:</span>

<span class="sd">            caus_res = ts_nino.causality(ts_air, method=&#39;granger&#39;)</span>
<span class="sd">            print(caus_res)</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">settings</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">settings</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">settings</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">spec_func</span><span class="o">=</span><span class="p">{</span>
            <span class="s1">&#39;liang&#39;</span><span class="p">:</span><span class="n">causalutils</span><span class="o">.</span><span class="n">liang_causality</span><span class="p">,</span>
            <span class="s1">&#39;granger&#39;</span><span class="p">:</span><span class="n">causalutils</span><span class="o">.</span><span class="n">granger_causality</span><span class="p">}</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">args</span><span class="p">[</span><span class="s1">&#39;liang&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">args</span><span class="p">[</span><span class="s1">&#39;granger&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">args</span><span class="p">[</span><span class="n">method</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span>
        <span class="n">causal_res</span> <span class="o">=</span> <span class="n">spec_func</span><span class="p">[</span><span class="n">method</span><span class="p">](</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">target_series</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span><span class="p">[</span><span class="n">method</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">causal_res</span></div>

<div class="viewcode-block" id="Series.surrogates"><a class="viewcode-back" href="../../../core/ui.html#pyleoclim.core.ui.Series.surrogates">[docs]</a>    <span class="k">def</span> <span class="nf">surrogates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;ar1&#39;</span><span class="p">,</span> <span class="n">number</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">settings</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Generate surrogates with increasing time axis</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        method : {ar1}</span>
<span class="sd">            Uses an AR1 model to generate surrogates of the timeseries</span>

<span class="sd">        number : int</span>
<span class="sd">            The number of surrogates to generate</span>

<span class="sd">        length : int</span>
<span class="sd">            Lenght of the series</span>

<span class="sd">        seed : int</span>
<span class="sd">            Control seed option for reproducibility</span>

<span class="sd">        settings : dict</span>
<span class="sd">            Parameters for surogate generator. See individual methods for details.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        surr : pyleoclim SurrogateSeries</span>

<span class="sd">        See also</span>
<span class="sd">        --------</span>

<span class="sd">        pyleoclim.utils.tsmodel.ar1_sim : AR1 simulator</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">settings</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">settings</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">settings</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">surrogate_func</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;ar1&#39;</span><span class="p">:</span> <span class="n">tsmodel</span><span class="o">.</span><span class="n">ar1_sim</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">args</span><span class="p">[</span><span class="s1">&#39;ar1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;t&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">}</span>
        <span class="n">args</span><span class="p">[</span><span class="n">method</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">seed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>

        <span class="n">surr_res</span> <span class="o">=</span> <span class="n">surrogate_func</span><span class="p">[</span><span class="n">method</span><span class="p">](</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">number</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span><span class="p">[</span><span class="n">method</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">surr_res</span><span class="p">))</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">surr_res</span> <span class="o">=</span> <span class="n">surr_res</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>

        <span class="n">s_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">surr_res</span><span class="o">.</span><span class="n">T</span><span class="p">:</span>
            <span class="n">s_tmp</span> <span class="o">=</span> <span class="n">Series</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">s</span><span class="p">,</span> <span class="n">time_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time_name</span><span class="p">,</span> <span class="n">time_unit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time_unit</span><span class="p">,</span> <span class="n">value_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">value_name</span><span class="p">,</span> <span class="n">value_unit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">value_unit</span><span class="p">)</span>
            <span class="n">s_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s_tmp</span><span class="p">)</span>

        <span class="n">surr</span> <span class="o">=</span> <span class="n">SurrogateSeries</span><span class="p">(</span><span class="n">series_list</span><span class="o">=</span><span class="n">s_list</span><span class="p">,</span> <span class="n">surrogate_method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="n">surrogate_args</span><span class="o">=</span><span class="n">args</span><span class="p">[</span><span class="n">method</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">surr</span></div>

<div class="viewcode-block" id="Series.outliers"><a class="viewcode-back" href="../../../core/ui.html#pyleoclim.core.ui.Series.outliers">[docs]</a>    <span class="k">def</span> <span class="nf">outliers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">auto</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">remove</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fig_outliers</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">fig_knee</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                 <span class="n">plot_outliers_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">plot_knee_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">4</span><span class="p">],</span>
                 <span class="n">saveknee_settings</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">saveoutliers_settings</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mute</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Detects outliers in a timeseries and removes if specified</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        auto : boolean</span>
<span class="sd">            True by default, detects knee in the plot automatically</span>
<span class="sd">        remove : boolean</span>
<span class="sd">            True by default, removes all outlier points if detected</span>
<span class="sd">        fig_knee  : boolean</span>
<span class="sd">            True by default, plots knee plot if true</span>
<span class="sd">        fig_outliers : boolean</span>
<span class="sd">            True by degault, plots outliers if true</span>
<span class="sd">        save_knee : dict</span>
<span class="sd">            default parameters from matplotlib savefig None by default</span>
<span class="sd">        save_outliers : dict</span>
<span class="sd">            default parameters from matplotlib savefig None by default</span>
<span class="sd">        plot_knee_kwargs : dict</span>
<span class="sd">            arguments for the knee plot</span>
<span class="sd">        plot_outliers_kwargs : dict</span>
<span class="sd">            arguments for the outliers plot</span>
<span class="sd">        figsize : list</span>
<span class="sd">            by default [10,4]</span>
<span class="sd">        mute : {True,False}</span>
<span class="sd">            if True, the plot will not show;</span>
<span class="sd">            recommend to turn on when more modifications are going to be made on ax</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        new : Series</span>
<span class="sd">            Time series with outliers removed if they exist</span>

<span class="sd">        See also</span>
<span class="sd">        --------</span>

<span class="sd">        pyleoclim.utils.tsutils.remove_outliers : remove outliers function</span>

<span class="sd">        pyleoclim.utils.plotting.plot_xy : basic x-y plot</span>

<span class="sd">        pyleoclim.utils.plotting.plot_scatter_xy : Scatter plot on top of a line plot</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">new</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="c1">#outlier_indices,fig1,ax1,fig2,ax2 = tsutils.detect_outliers(self.time, self.value, auto=auto, plot_knee=fig_knee,plot_outliers=fig_outliers,\</span>
        <span class="c1">#                                                   figsize=figsize,save_knee=save_knee,save_outliers=save_outliers,plot_outliers_kwargs=plot_outliers_kwargs,plot_knee_kwargs=plot_knee_kwargs)</span>
        <span class="n">outlier_indices</span> <span class="o">=</span> <span class="n">tsutils</span><span class="o">.</span><span class="n">detect_outliers</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">auto</span><span class="o">=</span><span class="n">auto</span><span class="p">,</span> <span class="n">plot_knee</span><span class="o">=</span><span class="n">fig_knee</span><span class="p">,</span><span class="n">plot_outliers</span><span class="o">=</span><span class="n">fig_outliers</span><span class="p">,</span>
            <span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">,</span><span class="n">saveknee_settings</span><span class="o">=</span><span class="n">saveknee_settings</span><span class="p">,</span><span class="n">saveoutliers_settings</span><span class="o">=</span><span class="n">saveoutliers_settings</span><span class="p">,</span>
            <span class="n">plot_outliers_kwargs</span><span class="o">=</span><span class="n">plot_outliers_kwargs</span><span class="p">,</span><span class="n">plot_knee_kwargs</span><span class="o">=</span><span class="n">plot_knee_kwargs</span><span class="p">,</span> <span class="n">mute</span><span class="o">=</span><span class="n">mute</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">outlier_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">outlier_indices</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">remove</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">new</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">ys</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">outlier_indices</span><span class="p">)</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">outlier_indices</span><span class="p">)</span>
            <span class="n">new</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">ys</span>
            <span class="n">new</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="n">t</span>

        <span class="k">return</span> <span class="n">new</span></div>

<div class="viewcode-block" id="Series.interp"><a class="viewcode-back" href="../../../core/ui.html#pyleoclim.core.ui.Series.interp">[docs]</a>    <span class="k">def</span> <span class="nf">interp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Interpolate a Series object onto a new time axis</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        method : {linear, nearest, zero, slinear, quadratic, cubic, previous, next}</span>
<span class="sd">            where zero, slinear, quadratic and cubic refer to a spline interpolation of zeroth, first, second or third order; previous and next simply return the previous or next value of the point) or as an integer specifying the order of the spline interpolator to use. Default is linear.</span>

<span class="sd">        kwargs :</span>
<span class="sd">            Arguments specific to each interpolation function. See pyleoclim.utils.tsutils.interp for details</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        new : pyleoclim.Series</span>
<span class="sd">            An interpolated Series object</span>

<span class="sd">        See also</span>
<span class="sd">        --------</span>

<span class="sd">        pyleoclim.utils.tsutils.interp : interpolation function</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">new</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">ti</span><span class="p">,</span> <span class="n">vi</span> <span class="o">=</span> <span class="n">tsutils</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span><span class="n">interp_type</span><span class="o">=</span><span class="n">method</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">new</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="n">ti</span>
        <span class="n">new</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">vi</span>
        <span class="k">return</span> <span class="n">new</span></div>

<div class="viewcode-block" id="Series.gkernel"><a class="viewcode-back" href="../../../core/ui.html#pyleoclim.core.ui.Series.gkernel">[docs]</a>    <span class="k">def</span> <span class="nf">gkernel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">step_type</span><span class="o">=</span><span class="s1">&#39;median&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Coarse-grain a Series object via a Gaussian kernel.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        step_type : str</span>
<span class="sd">            type of timestep: &#39;mean&#39;, &#39;median&#39;, or &#39;max&#39; of the time increments</span>
<span class="sd">        kwargs :</span>
<span class="sd">            Arguments for kernel function. See pyleoclim.utils.tsutils.gkernel for details</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        new : pyleoclim.Series</span>
<span class="sd">            The coarse-grained Series object</span>
<span class="sd">        See also</span>
<span class="sd">        --------</span>
<span class="sd">        pyleoclim.utils.tsutils.gkernel : application of a Gaussian kernel</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">new</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="n">ti</span><span class="p">,</span> <span class="n">vi</span> <span class="o">=</span> <span class="n">tsutils</span><span class="o">.</span><span class="n">gkernel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="c1"># apply kernel</span>
        <span class="n">new</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="n">ti</span>
        <span class="n">new</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">vi</span>
        <span class="k">return</span> <span class="n">new</span></div>

<div class="viewcode-block" id="Series.bin"><a class="viewcode-back" href="../../../core/ui.html#pyleoclim.core.ui.Series.bin">[docs]</a>    <span class="k">def</span> <span class="nf">bin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Bin values in a time series</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        kwargs :</span>
<span class="sd">            Arguments for binning function. See pyleoclim.utils.tsutils.bin for details</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        new : pyleoclim.Series</span>
<span class="sd">            An binned Series object</span>

<span class="sd">        See also</span>
<span class="sd">        --------</span>

<span class="sd">        pyleoclim.utils.tsutils.bin : bin the time series into evenly-spaced bins</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">new</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">res_dict</span> <span class="o">=</span> <span class="n">tsutils</span><span class="o">.</span><span class="n">bin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">new</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="n">res_dict</span><span class="p">[</span><span class="s1">&#39;bins&#39;</span><span class="p">]</span>
        <span class="n">new</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">res_dict</span><span class="p">[</span><span class="s1">&#39;binned_values&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">new</span></div></div>

<div class="viewcode-block" id="PSD"><a class="viewcode-back" href="../../../core/ui.html#pyleoclim.core.ui.PSD">[docs]</a><span class="k">class</span> <span class="nc">PSD</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;PSD object obtained from spectral analysis.</span>

<span class="sd">    See examples in pyleoclim.core.ui.Series.spectral to see how to create and manipulate these objects</span>

<span class="sd">    See also</span>
<span class="sd">    --------</span>

<span class="sd">    pyleoclim.core.ui.Series.spectral : spectral analysis</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frequency</span><span class="p">,</span> <span class="n">amplitude</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">timeseries</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">plot_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">spec_method</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">spec_args</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">signif_qs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">signif_method</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">period_unit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">beta_est_res</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">frequency</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">amplitude</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">amplitude</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">label</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timeseries</span> <span class="o">=</span> <span class="n">timeseries</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spec_method</span> <span class="o">=</span> <span class="n">spec_method</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spec_args</span> <span class="o">=</span> <span class="n">spec_args</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">signif_qs</span> <span class="o">=</span> <span class="n">signif_qs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">signif_method</span> <span class="o">=</span> <span class="n">signif_method</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_kwargs</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">plot_kwargs</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">plot_kwargs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">beta_est_res</span> <span class="o">=</span> <span class="n">beta_est_res</span>

        <span class="k">if</span> <span class="n">period_unit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">period_unit</span> <span class="o">=</span> <span class="n">period_unit</span>
        <span class="k">elif</span> <span class="n">timeseries</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">period_unit</span> <span class="o">=</span> <span class="n">infer_period_unit_from_time_unit</span><span class="p">(</span><span class="n">timeseries</span><span class="o">.</span><span class="n">time_unit</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">period_unit</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="PSD.copy"><a class="viewcode-back" href="../../../core/ui.html#pyleoclim.core.ui.PSD.copy">[docs]</a>    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Copy object</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">table</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;Frequency&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="p">,</span>
            <span class="s1">&#39;Amplitude&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">amplitude</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">msg</span> <span class="o">=</span> <span class="nb">print</span><span class="p">(</span><span class="n">tabulate</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="s1">&#39;keys&#39;</span><span class="p">))</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;Length: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span>

<div class="viewcode-block" id="PSD.signif_test"><a class="viewcode-back" href="../../../core/ui.html#pyleoclim.core.ui.PSD.signif_test">[docs]</a>    <span class="k">def</span> <span class="nf">signif_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">number</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;ar1&#39;</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">qs</span><span class="o">=</span><span class="p">[</span><span class="mf">0.95</span><span class="p">],</span>
                    <span class="n">settings</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>


<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        number : int, optional</span>
<span class="sd">            Number of surrogate series to generate for significance testing. The default is 200.</span>
<span class="sd">        method : {ar1}, optional</span>
<span class="sd">            Method to generate surrogates. The default is &#39;ar1&#39;.</span>
<span class="sd">        seed : int, optional</span>
<span class="sd">            Option to set the seed for reproducibility. The default is None.</span>
<span class="sd">        qs : list, optional</span>
<span class="sd">            Singificance levels to return. The default is [0.95].</span>
<span class="sd">        settings : dict, optional</span>
<span class="sd">            Parameters. The default is None.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        new : pyleoclim.PSD</span>
<span class="sd">            New PSD object with appropriate significance test</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">number</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span>

        <span class="n">new</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">surr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeseries</span><span class="o">.</span><span class="n">surrogates</span><span class="p">(</span>
            <span class="n">number</span><span class="o">=</span><span class="n">number</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="n">settings</span><span class="o">=</span><span class="n">settings</span>
        <span class="p">)</span>
        <span class="n">surr_psd</span> <span class="o">=</span> <span class="n">surr</span><span class="o">.</span><span class="n">spectral</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">spec_method</span><span class="p">,</span> <span class="n">settings</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">spec_args</span><span class="p">)</span>
        <span class="n">new</span><span class="o">.</span><span class="n">signif_qs</span> <span class="o">=</span> <span class="n">surr_psd</span><span class="o">.</span><span class="n">quantiles</span><span class="p">(</span><span class="n">qs</span><span class="o">=</span><span class="n">qs</span><span class="p">)</span>
        <span class="n">new</span><span class="o">.</span><span class="n">signif_method</span> <span class="o">=</span> <span class="n">method</span>

        <span class="k">return</span> <span class="n">new</span></div>

<div class="viewcode-block" id="PSD.beta_est"><a class="viewcode-back" href="../../../core/ui.html#pyleoclim.core.ui.PSD.beta_est">[docs]</a>    <span class="k">def</span> <span class="nf">beta_est</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fmin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fmax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">logf_binning_step</span><span class="o">=</span><span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Estimate the scaling factor beta of the PSD in a log-log space</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        fmin : float</span>
<span class="sd">            the minimum frequency edge for beta estimation; the default is the minimum of the frequency vector of the PSD obj</span>

<span class="sd">        fmax : float</span>
<span class="sd">            the maximum frequency edge for beta estimation; the default is the maximum of the frequency vector of the PSD obj</span>

<span class="sd">        logf_binning_step : str, {&#39;max&#39;, &#39;first&#39;}</span>
<span class="sd">            if &#39;max&#39;, then the maximum spacing of log(f) will be used as the binning step</span>
<span class="sd">            if &#39;first&#39;, then the 1st spacing of log(f) will be used as the binning step</span>

<span class="sd">        verbose : bool</span>
<span class="sd">            If True, will print warning messages if there is any</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        res_dict : dictionary</span>
<span class="sd">            - beta: the scaling factor</span>
<span class="sd">            - std_err: the one standard deviation error of the scaling factor</span>
<span class="sd">            - f_binned: the binned frequency series, used as X for linear regression</span>
<span class="sd">            - psd_binned: the binned PSD series, used as Y for linear regression</span>
<span class="sd">            - Y_reg: the predicted Y from linear regression, used with f_binned for the slope curve plotting</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">fmin</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">fmax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="p">)</span>

        <span class="n">res</span> <span class="o">=</span> <span class="n">waveutils</span><span class="o">.</span><span class="n">beta_estimation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">amplitude</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="p">,</span> <span class="n">fmin</span><span class="o">=</span><span class="n">fmin</span><span class="p">,</span> <span class="n">fmax</span><span class="o">=</span><span class="n">fmax</span><span class="p">,</span> <span class="n">logf_binning_step</span><span class="o">=</span><span class="n">logf_binning_step</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="n">res_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;beta&#39;</span><span class="p">:</span> <span class="n">res</span><span class="o">.</span><span class="n">beta</span><span class="p">,</span>
            <span class="s1">&#39;std_err&#39;</span><span class="p">:</span> <span class="n">res</span><span class="o">.</span><span class="n">std_err</span><span class="p">,</span>
            <span class="s1">&#39;f_binned&#39;</span><span class="p">:</span> <span class="n">res</span><span class="o">.</span><span class="n">f_binned</span><span class="p">,</span>
            <span class="s1">&#39;psd_binned&#39;</span><span class="p">:</span> <span class="n">res</span><span class="o">.</span><span class="n">psd_binned</span><span class="p">,</span>
            <span class="s1">&#39;Y_reg&#39;</span><span class="p">:</span> <span class="n">res</span><span class="o">.</span><span class="n">Y_reg</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">res_dict</span></div>

<div class="viewcode-block" id="PSD.plot"><a class="viewcode-back" href="../../../core/ui.html#pyleoclim.core.ui.PSD.plot">[docs]</a>    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">in_loglog</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">in_period</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;PSD&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">marker</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">transpose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
             <span class="n">xlim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="n">savefig_settings</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mute</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
             <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">lgd_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xticks</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">yticks</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">plot_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">signif_clr</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">signif_linestyles</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="s1">&#39;-.&#39;</span><span class="p">,</span> <span class="s1">&#39;:&#39;</span><span class="p">],</span> <span class="n">signif_linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Plots the PSD estimates and signif level if included</span>


<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        in_loglog : bool, optional</span>
<span class="sd">            Plot on loglog axis. The default is True.</span>
<span class="sd">        in_period : bool, optional</span>
<span class="sd">            Plot the x-axis as periodicity rather than frequency. The default is True.</span>
<span class="sd">        label : str, optional</span>
<span class="sd">            label for the series. The default is None.</span>
<span class="sd">        xlabel : str, optional</span>
<span class="sd">            Label for the x-axis. The default is None. Will guess based on Series</span>
<span class="sd">        ylabel : str, optional</span>
<span class="sd">            Label for the y-axis. The default is &#39;PSD&#39;.</span>
<span class="sd">        title : str, optional</span>
<span class="sd">            Plot title. The default is None.</span>
<span class="sd">        marker : str, optional</span>
<span class="sd">            marker to use. The default is None.</span>
<span class="sd">        markersize : int, optional</span>
<span class="sd">            size of the marker. The default is None.</span>
<span class="sd">        color : str, optional</span>
<span class="sd">            Line color. The default is None.</span>
<span class="sd">        linestyle : str, optional</span>
<span class="sd">            linestyle. The default is None.</span>
<span class="sd">        linewidth : float, optional</span>
<span class="sd">            Width of the line. The default is None.</span>
<span class="sd">        transpose : bool, optional</span>
<span class="sd">            Plot periodicity on y-. The default is False.</span>
<span class="sd">        xlim : list, optional</span>
<span class="sd">            x-axis limits. The default is None.</span>
<span class="sd">        ylim : list, optional</span>
<span class="sd">            y-axis limits. The default is None.</span>
<span class="sd">        figsize : list, optional</span>
<span class="sd">            Figure size. The default is [10, 4].</span>
<span class="sd">        savefig_settings : dict, optional</span>
<span class="sd">            save settings options. The default is None.</span>
<span class="sd">            the dictionary of arguments for plt.savefig(); some notes below:</span>
<span class="sd">            - &quot;path&quot; must be specified; it can be any existed or non-existed path,</span>
<span class="sd">              with or without a suffix; if the suffix is not given in &quot;path&quot;, it will follow &quot;format&quot;</span>
<span class="sd">            - &quot;format&quot; can be one of {&quot;pdf&quot;, &quot;eps&quot;, &quot;png&quot;, &quot;ps&quot;}</span>
<span class="sd">        ax : ax, optional</span>
<span class="sd">            The matplotlib.Axes object onto which to return the plot. The default is None.</span>
<span class="sd">        mute : bool, optional</span>
<span class="sd">            if True, the plot will not show;</span>
<span class="sd">            recommend to turn on when more modifications are going to be made on ax The default is False.</span>
<span class="sd">        legend : bool, optional</span>
<span class="sd">            whether to plot the legend. The default is True.</span>
<span class="sd">        lgd_kwargs : dict, optional</span>
<span class="sd">            Arguments for the legend. The default is None.</span>
<span class="sd">        xticks : list, optional</span>
<span class="sd">            xticks to use. The default is None.</span>
<span class="sd">        yticks : list, optional</span>
<span class="sd">            yticks to use. The default is None.</span>
<span class="sd">        alpha : float, optional</span>
<span class="sd">            Transparency setting. The default is None.</span>
<span class="sd">        zorder : int, optional</span>
<span class="sd">            Order for the plot. The default is None.</span>
<span class="sd">        plot_kwargs : dict, optional</span>
<span class="sd">            Other plotting argument. The default is None.</span>
<span class="sd">        signif_clr : str, optional</span>
<span class="sd">            Color for the significance line. The default is &#39;red&#39;.</span>
<span class="sd">        signif_linestyles : list of str, optional</span>
<span class="sd">            Linestyles for significance. The default is [&#39;--&#39;, &#39;-.&#39;, &#39;:&#39;].</span>
<span class="sd">        signif_linewidth : float, optional</span>
<span class="sd">            width of the significance line. The default is 1.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        fig, ax</span>

<span class="sd">        See also</span>
<span class="sd">        --------</span>

<span class="sd">        pyleoclim.core.ui.Series.spectral : spectral analysis</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># Turn the interactive mode off.</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ioff</span><span class="p">()</span>

        <span class="n">savefig_settings</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">savefig_settings</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">savefig_settings</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">plot_kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_kwargs</span> <span class="k">if</span> <span class="n">plot_kwargs</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">plot_kwargs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">lgd_kwargs</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">lgd_kwargs</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">lgd_kwargs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">label</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">label</span>

        <span class="k">if</span> <span class="n">label</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">plot_kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="n">label</span><span class="p">})</span>

        <span class="k">if</span> <span class="n">marker</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">plot_kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;marker&#39;</span><span class="p">:</span> <span class="n">marker</span><span class="p">})</span>

        <span class="k">if</span> <span class="n">markersize</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">plot_kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;markersize&#39;</span><span class="p">:</span> <span class="n">markersize</span><span class="p">})</span>

        <span class="k">if</span> <span class="n">color</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">plot_kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="n">color</span><span class="p">})</span>

        <span class="k">if</span> <span class="n">linestyle</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">plot_kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;linestyle&#39;</span><span class="p">:</span> <span class="n">linestyle</span><span class="p">})</span>

        <span class="k">if</span> <span class="n">linewidth</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">plot_kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;linewidth&#39;</span><span class="p">:</span> <span class="n">linewidth</span><span class="p">})</span>

        <span class="k">if</span> <span class="n">alpha</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">plot_kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;alpha&#39;</span><span class="p">:</span> <span class="n">alpha</span><span class="p">})</span>

        <span class="k">if</span> <span class="n">zorder</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">plot_kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;zorder&#39;</span><span class="p">:</span> <span class="n">zorder</span><span class="p">})</span>

        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">in_period</span><span class="p">:</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">x_axis</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span>
            <span class="n">y_axis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">amplitude</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">xlabel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">xlabel</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;Period [</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">period_unit</span><span class="si">}</span><span class="s1">]&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">period_unit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s1">&#39;Period&#39;</span>

            <span class="k">if</span> <span class="n">xticks</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">xticks_default</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">2000</span><span class="p">,</span> <span class="mi">5000</span><span class="p">,</span> <span class="mf">1e4</span><span class="p">,</span> <span class="mf">2e4</span><span class="p">,</span> <span class="mf">5e4</span><span class="p">,</span> <span class="mf">1e5</span><span class="p">,</span> <span class="mf">2e5</span><span class="p">,</span> <span class="mf">5e5</span><span class="p">,</span> <span class="mf">1e6</span><span class="p">])</span>
                <span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">xticks_default</span> <span class="o">&gt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">x_axis</span><span class="p">))</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">xticks_default</span> <span class="o">&lt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">x_axis</span><span class="p">))</span>
                <span class="n">xticks</span> <span class="o">=</span> <span class="n">xticks_default</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">xlim</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">xlim</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">xticks</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">xticks</span><span class="p">)]</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">x_axis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span>
            <span class="n">y_axis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">amplitude</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">xlabel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">xlabel</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;Frequency [1/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">period_unit</span><span class="si">}</span><span class="s1">]&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">period_unit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s1">&#39;Frequency&#39;</span>

            <span class="k">if</span> <span class="n">xlim</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">xlim</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()</span>
                <span class="n">xlim</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">xlim</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">xlim</span><span class="p">)]</span>

        <span class="k">if</span> <span class="n">transpose</span><span class="p">:</span>
            <span class="n">x_axis</span><span class="p">,</span> <span class="n">y_axis</span> <span class="o">=</span> <span class="n">y_axis</span><span class="p">,</span> <span class="n">x_axis</span>
            <span class="n">xlim</span><span class="p">,</span> <span class="n">ylim</span> <span class="o">=</span> <span class="n">ylim</span><span class="p">,</span> <span class="n">xlim</span>
            <span class="n">xticks</span><span class="p">,</span> <span class="n">yticks</span> <span class="o">=</span> <span class="n">yticks</span><span class="p">,</span> <span class="n">xticks</span>
            <span class="n">xlabel</span><span class="p">,</span> <span class="n">ylabel</span> <span class="o">=</span> <span class="n">ylabel</span><span class="p">,</span> <span class="n">xlabel</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ylim</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xlim</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_axis</span><span class="p">,</span> <span class="n">y_axis</span><span class="p">,</span> <span class="o">**</span><span class="n">plot_kwargs</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">xlim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xlim</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">ylim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ylim</span><span class="p">)</span>

        <span class="c1"># plot significance levels</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">signif_qs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">signif_method_label</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;ar1&#39;</span><span class="p">:</span> <span class="s1">&#39;AR(1)&#39;</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="n">nqs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">signif_qs</span><span class="o">.</span><span class="n">psd_list</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">q</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">signif_qs</span><span class="o">.</span><span class="n">psd_list</span><span class="p">):</span>
                <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">frequency</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">signif_x_axis</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">frequency</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span> <span class="k">if</span> <span class="n">in_period</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">frequency</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span>
                <span class="n">signif_y_axis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">amplitude</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">transpose</span><span class="p">:</span>
                    <span class="n">signif_x_axis</span><span class="p">,</span> <span class="n">signif_y_axis</span> <span class="o">=</span> <span class="n">signif_y_axis</span><span class="p">,</span> <span class="n">signif_x_axis</span>

                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                    <span class="n">signif_x_axis</span><span class="p">,</span> <span class="n">signif_y_axis</span><span class="p">,</span>
                    <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">signif_method_label</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">signif_method</span><span class="p">]</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="n">q</span><span class="o">.</span><span class="n">label</span><span class="si">}</span><span class="s1"> threshold&#39;</span><span class="p">,</span>
                    <span class="n">color</span><span class="o">=</span><span class="n">signif_clr</span><span class="p">,</span>
                    <span class="n">linestyle</span><span class="o">=</span><span class="n">signif_linestyles</span><span class="p">[</span><span class="n">i</span><span class="o">%</span><span class="mi">3</span><span class="p">],</span>
                    <span class="n">linewidth</span><span class="o">=</span><span class="n">signif_linewidth</span><span class="p">,</span>
                <span class="p">)</span>

        <span class="k">if</span> <span class="n">in_loglog</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">xticks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">xticks</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">ScalarFormatter</span><span class="p">())</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">FormatStrFormatter</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%g</span><span class="s1">&#39;</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">yticks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">yticks</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">ScalarFormatter</span><span class="p">())</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">FormatStrFormatter</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%g</span><span class="s1">&#39;</span><span class="p">))</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">legend</span><span class="p">:</span>
            <span class="n">lgd_args</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;frameon&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>
            <span class="n">lgd_args</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">lgd_kwargs</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="o">**</span><span class="n">lgd_args</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;fig&#39;</span> <span class="ow">in</span> <span class="nb">locals</span><span class="p">():</span>
            <span class="k">if</span> <span class="s1">&#39;path&#39;</span> <span class="ow">in</span> <span class="n">savefig_settings</span><span class="p">:</span>
                <span class="n">plotting</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">settings</span><span class="o">=</span><span class="n">savefig_settings</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">mute</span><span class="p">:</span>
                    <span class="n">plotting</span><span class="o">.</span><span class="n">showfig</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ax</span></div></div>

<div class="viewcode-block" id="Scalogram"><a class="viewcode-back" href="../../../core/ui.html#pyleoclim.core.ui.Scalogram">[docs]</a><span class="k">class</span> <span class="nc">Scalogram</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frequency</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">amplitude</span><span class="p">,</span> <span class="n">coi</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Neff</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">timeseries</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">wave_method</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">wave_args</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">signif_qs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">signif_method</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">freq_method</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">freq_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">period_unit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">time_label</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            frequency : array</span>
<span class="sd">                the frequency axis</span>
<span class="sd">            time : array</span>
<span class="sd">                the time axis</span>
<span class="sd">            amplitude : array</span>
<span class="sd">                the amplitude at each (frequency, time) point;</span>
<span class="sd">                note the dimension is assumed to be (frequency, time)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">frequency</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">amplitude</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">amplitude</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">coi</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">coi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">coi</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">coi</span> <span class="o">=</span> <span class="n">waveutils</span><span class="o">.</span><span class="n">make_coi</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">Neff</span><span class="o">=</span><span class="n">Neff</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">label</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timeseries</span> <span class="o">=</span> <span class="n">timeseries</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wave_method</span> <span class="o">=</span> <span class="n">wave_method</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wave_args</span> <span class="o">=</span> <span class="n">wave_args</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">signif_qs</span> <span class="o">=</span> <span class="n">signif_qs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">signif_method</span> <span class="o">=</span> <span class="n">signif_method</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">freq_method</span> <span class="o">=</span> <span class="n">freq_method</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">freq_kwargs</span> <span class="o">=</span> <span class="n">freq_kwargs</span>

        <span class="k">if</span> <span class="n">period_unit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">period_unit</span> <span class="o">=</span> <span class="n">period_unit</span>
        <span class="k">elif</span> <span class="n">timeseries</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">period_unit</span> <span class="o">=</span> <span class="n">infer_period_unit_from_time_unit</span><span class="p">(</span><span class="n">timeseries</span><span class="o">.</span><span class="n">time_unit</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">period_unit</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">time_label</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">time_label</span> <span class="o">=</span> <span class="n">time_label</span>
        <span class="k">elif</span> <span class="n">timeseries</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">timeseries</span><span class="o">.</span><span class="n">time_unit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">time_label</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">timeseries</span><span class="o">.</span><span class="n">time_name</span><span class="si">}</span><span class="s1"> [</span><span class="si">{</span><span class="n">timeseries</span><span class="o">.</span><span class="n">time_unit</span><span class="si">}</span><span class="s1">]&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">time_label</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">timeseries</span><span class="o">.</span><span class="n">time_name</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">time_label</span> <span class="o">=</span> <span class="kc">None</span>


<div class="viewcode-block" id="Scalogram.copy"><a class="viewcode-back" href="../../../core/ui.html#pyleoclim.core.ui.Scalogram.copy">[docs]</a>    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Copy object</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">table</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;Frequency&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="p">,</span>
            <span class="s1">&#39;Time&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
            <span class="s1">&#39;Amplitude&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">amplitude</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">msg</span> <span class="o">=</span> <span class="nb">print</span><span class="p">(</span><span class="n">tabulate</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="s1">&#39;keys&#39;</span><span class="p">))</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;Dimension: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="p">)</span><span class="si">}</span><span class="s1"> x </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span>

<div class="viewcode-block" id="Scalogram.plot"><a class="viewcode-back" href="../../../core/ui.html#pyleoclim.core.ui.Scalogram.plot">[docs]</a>    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">in_period</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">ylim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">yticks</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">],</span> <span class="n">mute</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
             <span class="n">signif_clr</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">signif_linestyles</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">signif_linewidths</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
             <span class="n">contourf_style</span><span class="o">=</span><span class="p">{},</span> <span class="n">cbar_style</span><span class="o">=</span><span class="p">{},</span> <span class="n">savefig_settings</span><span class="o">=</span><span class="p">{},</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Plot the scalogram</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        in_period : bool, optional</span>
<span class="sd">            Plot the in period instead of frequency space. The default is True.</span>
<span class="sd">        xlabel : str, optional</span>
<span class="sd">            Label for the x-axis. The default is None.</span>
<span class="sd">        ylabel : str, optional</span>
<span class="sd">            Label for the y-axis. The default is None.</span>
<span class="sd">        title : str, optional</span>
<span class="sd">            Title for the figure. The default is None.</span>
<span class="sd">        ylim : list, optional</span>
<span class="sd">            Limits for the y-axis. The default is None.</span>
<span class="sd">        xlim : list, optional</span>
<span class="sd">            Limits for the x-axis. The default is None.</span>
<span class="sd">        yticks : list, optional</span>
<span class="sd">            yticks label. The default is None.</span>
<span class="sd">        figsize : list, optional</span>
<span class="sd">            Figure size The default is [10, 8].</span>
<span class="sd">        mute : bool, optional</span>
<span class="sd">            if True, the plot will not show;</span>
<span class="sd">            recommend to turn on when more modifications are going to be made on ax The default is False.</span>
<span class="sd">        signif_clr : str, optional</span>
<span class="sd">            Color of the singificance line. The default is &#39;white&#39;.</span>
<span class="sd">        signif_linestyles : str, optional</span>
<span class="sd">            Linestyle of the significance line. The default is &#39;-&#39;.</span>
<span class="sd">        signif_linewidths : float, optional</span>
<span class="sd">            Width for the significance line. The default is 1.</span>
<span class="sd">        contourf_style : dict, optional</span>
<span class="sd">            Arguments for the contour plot. The default is {}.</span>
<span class="sd">        cbar_style : dict, optional</span>
<span class="sd">            Arguments for the colarbar. The default is {}.</span>
<span class="sd">        savefig_settings : dict, optional</span>
<span class="sd">            saving options for the figure. The default is {}.</span>
<span class="sd">        ax : ax, optional</span>
<span class="sd">            Matplotlib Axis on which to return the figure. The default is None.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        fig, ax</span>

<span class="sd">        See also</span>
<span class="sd">        --------</span>

<span class="sd">        pyleoclim.core.ui.Series.wavelet : Wavelet analysis</span>


<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># Turn the interactive mode off.</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ioff</span><span class="p">()</span>

        <span class="n">contourf_args</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;cmap&#39;</span><span class="p">:</span> <span class="s1">&#39;magma&#39;</span><span class="p">,</span> <span class="s1">&#39;origin&#39;</span><span class="p">:</span> <span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="s1">&#39;levels&#39;</span><span class="p">:</span> <span class="mi">11</span><span class="p">}</span>
        <span class="n">contourf_args</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">contourf_style</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">in_period</span><span class="p">:</span>
            <span class="n">y_axis</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency</span>
            <span class="k">if</span> <span class="n">ylabel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">ylabel</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;Period [</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">period_unit</span><span class="si">}</span><span class="s1">]&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">period_unit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s1">&#39;Period&#39;</span>

            <span class="k">if</span> <span class="n">yticks</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">yticks_default</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">2000</span><span class="p">,</span> <span class="mi">5000</span><span class="p">,</span> <span class="mf">1e4</span><span class="p">,</span> <span class="mf">2e4</span><span class="p">,</span> <span class="mf">5e4</span><span class="p">,</span> <span class="mf">1e5</span><span class="p">,</span> <span class="mf">2e5</span><span class="p">,</span> <span class="mf">5e5</span><span class="p">,</span> <span class="mf">1e6</span><span class="p">])</span>
                <span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">yticks_default</span> <span class="o">&gt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">y_axis</span><span class="p">))</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">yticks_default</span> <span class="o">&lt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">y_axis</span><span class="p">))</span>
                <span class="n">yticks</span> <span class="o">=</span> <span class="n">yticks_default</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">y_axis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span>
            <span class="k">if</span> <span class="n">ylabel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">ylabel</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;Frequency [1/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">period_unit</span><span class="si">}</span><span class="s1">]&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">period_unit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s1">&#39;Frequency&#39;</span>

        <span class="n">cont</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">y_axis</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">amplitude</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="o">**</span><span class="n">contourf_args</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>

        <span class="c1"># plot colorbar</span>
        <span class="n">cbar_args</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;drawedges&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;orientation&#39;</span><span class="p">:</span> <span class="s1">&#39;vertical&#39;</span><span class="p">,</span> <span class="s1">&#39;fraction&#39;</span><span class="p">:</span> <span class="mf">0.15</span><span class="p">,</span> <span class="s1">&#39;pad&#39;</span><span class="p">:</span> <span class="mf">0.05</span><span class="p">}</span>
        <span class="n">cbar_args</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">cbar_style</span><span class="p">)</span>

        <span class="n">cb</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cont</span><span class="p">,</span> <span class="o">**</span><span class="n">cbar_args</span><span class="p">)</span>

        <span class="c1"># plot cone of influence</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">coi</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">coi</span><span class="p">,</span> <span class="s1">&#39;k--&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">yticks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">yticks</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">ScalarFormatter</span><span class="p">())</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">FormatStrFormatter</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%g</span><span class="s1">&#39;</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">ylim</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ylim</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">y_axis</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">y_axis</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coi</span><span class="p">)])]</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">coi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coi</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

        <span class="c1"># plot significance levels</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">signif_qs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">signif_method_label</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;ar1&#39;</span><span class="p">:</span> <span class="s1">&#39;AR(1)&#39;</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="n">signif_scal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">signif_qs</span><span class="o">.</span><span class="n">scalogram_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">signif_boundary</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">amplitude</span><span class="o">.</span><span class="n">T</span> <span class="o">/</span> <span class="n">signif_scal</span><span class="o">.</span><span class="n">amplitude</span><span class="o">.</span><span class="n">T</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">y_axis</span><span class="p">,</span> <span class="n">signif_boundary</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="mi">99</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                <span class="n">colors</span><span class="o">=</span><span class="n">signif_clr</span><span class="p">,</span>
                <span class="n">linestyles</span><span class="o">=</span><span class="n">signif_linestyles</span><span class="p">,</span>
                <span class="n">linewidths</span><span class="o">=</span><span class="n">signif_linewidths</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">xlabel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">xlabel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_label</span>

        <span class="k">if</span> <span class="n">xlabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">ylabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">xlim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xlim</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ylim</span><span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;fig&#39;</span> <span class="ow">in</span> <span class="nb">locals</span><span class="p">():</span>
            <span class="k">if</span> <span class="s1">&#39;path&#39;</span> <span class="ow">in</span> <span class="n">savefig_settings</span><span class="p">:</span>
                <span class="n">plotting</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">settings</span><span class="o">=</span><span class="n">savefig_settings</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">mute</span><span class="p">:</span>
                    <span class="n">plotting</span><span class="o">.</span><span class="n">showfig</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ax</span></div>

<div class="viewcode-block" id="Scalogram.signif_test"><a class="viewcode-back" href="../../../core/ui.html#pyleoclim.core.ui.Scalogram.signif_test">[docs]</a>    <span class="k">def</span> <span class="nf">signif_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">number</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;ar1&#39;</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">qs</span><span class="o">=</span><span class="p">[</span><span class="mf">0.95</span><span class="p">],</span>
                    <span class="n">settings</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Significance test for wavelet analysis</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        number : int, optional</span>
<span class="sd">            Number of surrogates to generate for significance analysis. The default is 200.</span>
<span class="sd">        method : {&#39;ar1&#39;}, optional</span>
<span class="sd">            Method to use to generate the surrogates. The default is &#39;ar1&#39;.</span>
<span class="sd">        seed : int, optional</span>
<span class="sd">            Set the seed for the random number generator. Useful for reproducibility The default is None.</span>
<span class="sd">        qs : list, optional</span>
<span class="sd">            Significane level to consider. The default is [0.95].</span>
<span class="sd">        settings : dict, optional</span>
<span class="sd">            Parameters for the model. The default is None.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            qs should be a list with at least one value.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        new : pyleoclim.Scalogram</span>
<span class="sd">            A new Scalogram object with the significance level</span>

<span class="sd">        See also</span>
<span class="sd">        --------</span>

<span class="sd">        pyleoclim.core.ui.Series.wavelet : wavelet analysis</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">number</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span>

        <span class="n">new</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">surr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeseries</span><span class="o">.</span><span class="n">surrogates</span><span class="p">(</span>
            <span class="n">number</span><span class="o">=</span><span class="n">number</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="n">settings</span><span class="o">=</span><span class="n">settings</span>
        <span class="p">)</span>
        <span class="n">surr_scal</span> <span class="o">=</span> <span class="n">surr</span><span class="o">.</span><span class="n">wavelet</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">wave_method</span><span class="p">,</span> <span class="n">settings</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">wave_args</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">qs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;qs should be a list with size 1!&#39;</span><span class="p">)</span>

        <span class="n">new</span><span class="o">.</span><span class="n">signif_qs</span> <span class="o">=</span> <span class="n">surr_scal</span><span class="o">.</span><span class="n">quantiles</span><span class="p">(</span><span class="n">qs</span><span class="o">=</span><span class="n">qs</span><span class="p">)</span>
        <span class="n">new</span><span class="o">.</span><span class="n">signif_method</span> <span class="o">=</span> <span class="n">method</span>

        <span class="k">return</span> <span class="n">new</span></div></div>


<div class="viewcode-block" id="Coherence"><a class="viewcode-back" href="../../../core/ui.html#pyleoclim.core.ui.Coherence">[docs]</a><span class="k">class</span> <span class="nc">Coherence</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;Coherence object</span>

<span class="sd">    See also</span>
<span class="sd">    --------</span>

<span class="sd">    pyleoclim.core.ui.Series.wavelet_coherence : Wavelet coherence</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frequency</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">coherence</span><span class="p">,</span> <span class="n">phase</span><span class="p">,</span> <span class="n">coi</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">timeseries1</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">timeseries2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">signif_qs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">signif_method</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">freq_method</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">freq_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Neff</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">period_unit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">time_label</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">frequency</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coherence</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">coherence</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">coi</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">coi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">coi</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">coi</span> <span class="o">=</span> <span class="n">waveutils</span><span class="o">.</span><span class="n">make_coi</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">Neff</span><span class="o">=</span><span class="n">Neff</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phase</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">phase</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timeseries1</span> <span class="o">=</span> <span class="n">timeseries1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timeseries2</span> <span class="o">=</span> <span class="n">timeseries2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">signif_qs</span> <span class="o">=</span> <span class="n">signif_qs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">signif_method</span> <span class="o">=</span> <span class="n">signif_method</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">freq_method</span> <span class="o">=</span> <span class="n">freq_method</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">freq_kwargs</span> <span class="o">=</span> <span class="n">freq_kwargs</span>

        <span class="k">if</span> <span class="n">period_unit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">period_unit</span> <span class="o">=</span> <span class="n">period_unit</span>
        <span class="k">elif</span> <span class="n">timeseries1</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">period_unit</span> <span class="o">=</span> <span class="n">infer_period_unit_from_time_unit</span><span class="p">(</span><span class="n">timeseries1</span><span class="o">.</span><span class="n">time_unit</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">timeseries2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">period_unit</span> <span class="o">=</span> <span class="n">infer_period_unit_from_time_unit</span><span class="p">(</span><span class="n">timeseries2</span><span class="o">.</span><span class="n">time_unit</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">period_unit</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">time_label</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">time_label</span> <span class="o">=</span> <span class="n">time_label</span>
        <span class="k">elif</span> <span class="n">timeseries1</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">timeseries1</span><span class="o">.</span><span class="n">time_unit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">time_label</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">timeseries1</span><span class="o">.</span><span class="n">time_name</span><span class="si">}</span><span class="s1"> [</span><span class="si">{</span><span class="n">timeseries1</span><span class="o">.</span><span class="n">time_unit</span><span class="si">}</span><span class="s1">]&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">time_label</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">timeseries1</span><span class="o">.</span><span class="n">time_name</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="k">elif</span> <span class="n">timeseries2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">timeseries2</span><span class="o">.</span><span class="n">time_unit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">time_label</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">timeseries2</span><span class="o">.</span><span class="n">time_name</span><span class="si">}</span><span class="s1"> [</span><span class="si">{</span><span class="n">timeseries2</span><span class="o">.</span><span class="n">time_unit</span><span class="si">}</span><span class="s1">]&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">time_label</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">timeseries2</span><span class="o">.</span><span class="n">time_name</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">time_label</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="Coherence.copy"><a class="viewcode-back" href="../../../core/ui.html#pyleoclim.core.ui.Coherence.copy">[docs]</a>    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Copy object</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="Coherence.plot"><a class="viewcode-back" href="../../../core/ui.html#pyleoclim.core.ui.Coherence.plot">[docs]</a>    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">],</span>
             <span class="n">ylim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">in_period</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">yticks</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mute</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
             <span class="n">contourf_style</span><span class="o">=</span><span class="p">{},</span> <span class="n">phase_style</span><span class="o">=</span><span class="p">{},</span> <span class="n">cbar_style</span><span class="o">=</span><span class="p">{},</span> <span class="n">savefig_settings</span><span class="o">=</span><span class="p">{},</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">signif_clr</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">signif_linestyles</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">signif_linewidths</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
             <span class="n">under_clr</span><span class="o">=</span><span class="s1">&#39;ivory&#39;</span><span class="p">,</span> <span class="n">over_clr</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">bad_clr</span><span class="o">=</span><span class="s1">&#39;dimgray&#39;</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Plot the cross-wavelet results</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        xlabel : str, optional</span>
<span class="sd">            x-axis label. The default is None.</span>
<span class="sd">        ylabel : str, optional</span>
<span class="sd">            y-axis label. The default is None.</span>
<span class="sd">        title : str, optional</span>
<span class="sd">            Title of the plot. The default is None.</span>
<span class="sd">        figsize : list, optional</span>
<span class="sd">            Figure size. The default is [10, 8].</span>
<span class="sd">        ylim : list, optional</span>
<span class="sd">            y-axis limits. The default is None.</span>
<span class="sd">        xlim : list, optional</span>
<span class="sd">            x-axis limits. The default is None.</span>
<span class="sd">        in_period : bool, optional</span>
<span class="sd">            Plots periods instead of frequencies The default is True.</span>
<span class="sd">        yticks : list, optional</span>
<span class="sd">            y-ticks label. The default is None.</span>
<span class="sd">        mute : bool, optional</span>
<span class="sd">            if True, the plot will not show;</span>
<span class="sd">            recommend to turn on when more modifications are going to be made on ax The default is False. The default is False.</span>
<span class="sd">        contourf_style : dict, optional</span>
<span class="sd">            Arguments for the contour plot. The default is {}.</span>
<span class="sd">        phase_style : dict, optional</span>
<span class="sd">            Arguments for the phase arrows. The default is {}. It includes:</span>
<span class="sd">            - &#39;pt&#39;: the default threshold above which phase arrows will be plotted</span>
<span class="sd">            - &#39;skip_x&#39;: the number of points to skip between phase arrows along the x-axis</span>
<span class="sd">            - &#39;skip_y&#39;:  the number of points to skip between phase arrows along the y-axis</span>
<span class="sd">            - &#39;scale&#39;: number of data units per arrow length unit (see matplotlib.pyplot.quiver)</span>
<span class="sd">            - &#39;width&#39;: shaft width in arrow units (see matplotlib.pyplot.quiver)</span>
<span class="sd">        cbar_style : dict, optional</span>
<span class="sd">            Arguments for the color bar. The default is {}.</span>
<span class="sd">        savefig_settings : dict, optional</span>
<span class="sd">            The default is {}.</span>
<span class="sd">            the dictionary of arguments for plt.savefig(); some notes below:</span>
<span class="sd">            - &quot;path&quot; must be specified; it can be any existed or non-existed path,</span>
<span class="sd">              with or without a suffix; if the suffix is not given in &quot;path&quot;, it will follow &quot;format&quot;</span>
<span class="sd">            - &quot;format&quot; can be one of {&quot;pdf&quot;, &quot;eps&quot;, &quot;png&quot;, &quot;ps&quot;}</span>
<span class="sd">        ax : ax, optional</span>
<span class="sd">            Matplotlib axis on which to return the figure. The default is None.</span>
<span class="sd">        signif_clr : str, optional</span>
<span class="sd">            Color of the singificance line. The default is &#39;white&#39;.</span>
<span class="sd">        signif_linestyles : str, optional</span>
<span class="sd">            Style of the significance line. The default is &#39;-&#39;.</span>
<span class="sd">        signif_linewidths : float, optional</span>
<span class="sd">            Width of the significance line. The default is 1.</span>
<span class="sd">        under_clr : str, optional</span>
<span class="sd">            Color for under 0. The default is &#39;ivory&#39;.</span>
<span class="sd">        over_clr : str, optional</span>
<span class="sd">            Color for over 1. The default is &#39;black&#39;.</span>
<span class="sd">        bad_clr : str, optional</span>
<span class="sd">            Color for missing values. The default is &#39;dimgray&#39;.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        fig, ax</span>

<span class="sd">        See also</span>
<span class="sd">        --------</span>

<span class="sd">        pyleoclim.core.ui.Series.wavelet_coherence</span>
<span class="sd">        matplotlib.pyplot.quiver</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># Turn the interactive mode off.</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ioff</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>

        <span class="c1"># handling NaNs</span>
        <span class="n">mask_freq</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="p">)):</span>
            <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coherence</span><span class="p">[:,</span> <span class="n">i</span><span class="p">])):</span>
                <span class="n">mask_freq</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">mask_freq</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">in_period</span><span class="p">:</span>
            <span class="n">y_axis</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="p">[</span><span class="n">mask_freq</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">ylabel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">ylabel</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;Period [</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">period_unit</span><span class="si">}</span><span class="s1">]&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">period_unit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s1">&#39;Period&#39;</span>

            <span class="k">if</span> <span class="n">yticks</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">yticks_default</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">2000</span><span class="p">,</span> <span class="mi">5000</span><span class="p">,</span> <span class="mf">1e4</span><span class="p">,</span> <span class="mf">2e4</span><span class="p">,</span> <span class="mf">5e4</span><span class="p">,</span> <span class="mf">1e5</span><span class="p">,</span> <span class="mf">2e5</span><span class="p">,</span> <span class="mf">5e5</span><span class="p">,</span> <span class="mf">1e6</span><span class="p">])</span>
                <span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">yticks_default</span> <span class="o">&gt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">y_axis</span><span class="p">))</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">yticks_default</span> <span class="o">&lt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">y_axis</span><span class="p">))</span>
                <span class="n">yticks</span> <span class="o">=</span> <span class="n">yticks_default</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">y_axis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="p">[</span><span class="n">mask_freq</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">ylabel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">ylabel</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;Frequency [1/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">period_unit</span><span class="si">}</span><span class="s1">]&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">period_unit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s1">&#39;Frequency&#39;</span>

        <span class="c1"># plot coherence amplitude</span>
        <span class="n">contourf_args</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;cmap&#39;</span><span class="p">:</span> <span class="s1">&#39;magma&#39;</span><span class="p">,</span>
            <span class="s1">&#39;origin&#39;</span><span class="p">:</span> <span class="s1">&#39;lower&#39;</span><span class="p">,</span>
            <span class="s1">&#39;levels&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">11</span><span class="p">),</span>
        <span class="p">}</span>
        <span class="n">contourf_args</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">contourf_style</span><span class="p">)</span>

        <span class="n">cmap</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="n">contourf_args</span><span class="p">[</span><span class="s1">&#39;cmap&#39;</span><span class="p">])</span>
        <span class="n">cmap</span><span class="o">.</span><span class="n">set_under</span><span class="p">(</span><span class="n">under_clr</span><span class="p">)</span>
        <span class="n">cmap</span><span class="o">.</span><span class="n">set_over</span><span class="p">(</span><span class="n">over_clr</span><span class="p">)</span>
        <span class="n">cmap</span><span class="o">.</span><span class="n">set_bad</span><span class="p">(</span><span class="n">bad_clr</span><span class="p">)</span>
        <span class="n">contourf_args</span><span class="p">[</span><span class="s1">&#39;cmap&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cmap</span>

        <span class="n">cont</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">y_axis</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">coherence</span><span class="p">[:,</span> <span class="n">mask_freq</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="o">**</span><span class="n">contourf_args</span><span class="p">)</span>

        <span class="c1"># plot significance levels</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">signif_qs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">signif_method_label</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;ar1&#39;</span><span class="p">:</span> <span class="s1">&#39;AR(1)&#39;</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="n">signif_coh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">signif_qs</span><span class="o">.</span><span class="n">scalogram_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">signif_boundary</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coherence</span><span class="p">[:,</span> <span class="n">mask_freq</span><span class="p">]</span><span class="o">.</span><span class="n">T</span> <span class="o">/</span> <span class="n">signif_coh</span><span class="o">.</span><span class="n">amplitude</span><span class="p">[:,</span> <span class="n">mask_freq</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">y_axis</span><span class="p">,</span> <span class="n">signif_boundary</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="mi">99</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                <span class="n">colors</span><span class="o">=</span><span class="n">signif_clr</span><span class="p">,</span>
                <span class="n">linestyles</span><span class="o">=</span><span class="n">signif_linestyles</span><span class="p">,</span>
                <span class="n">linewidths</span><span class="o">=</span><span class="n">signif_linewidths</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="c1"># plot colorbar</span>
        <span class="n">cbar_args</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;drawedges&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s1">&#39;orientation&#39;</span><span class="p">:</span> <span class="s1">&#39;vertical&#39;</span><span class="p">,</span>
            <span class="s1">&#39;fraction&#39;</span><span class="p">:</span> <span class="mf">0.15</span><span class="p">,</span>
            <span class="s1">&#39;pad&#39;</span><span class="p">:</span> <span class="mf">0.05</span><span class="p">,</span>
            <span class="s1">&#39;ticks&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">11</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="n">cbar_args</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">cbar_style</span><span class="p">)</span>

        <span class="n">cb</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cont</span><span class="p">,</span> <span class="o">**</span><span class="n">cbar_args</span><span class="p">)</span>

        <span class="c1"># plot cone of influence</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="n">nonposy</span><span class="o">=</span><span class="s1">&#39;clip&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">coi</span><span class="p">,</span> <span class="s1">&#39;k--&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">ylim</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ylim</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">y_axis</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">y_axis</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coi</span><span class="p">)])]</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">coi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coi</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">yticks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">yticks</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">ScalarFormatter</span><span class="p">())</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">FormatStrFormatter</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%g</span><span class="s1">&#39;</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">xlabel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">xlabel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_label</span>

        <span class="k">if</span> <span class="n">xlabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">ylabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">)</span>

        <span class="c1"># plot phase</span>
        <span class="n">skip_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">)</span><span class="o">//</span><span class="mi">20</span><span class="p">),</span> <span class="mi">1</span><span class="p">])</span>
        <span class="n">skip_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">y_axis</span><span class="p">)</span><span class="o">//</span><span class="mi">20</span><span class="p">),</span> <span class="mi">1</span><span class="p">])</span>
        <span class="n">phase_args</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;pt&#39;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span> <span class="s1">&#39;skip_x&#39;</span><span class="p">:</span> <span class="n">skip_x</span><span class="p">,</span> <span class="s1">&#39;skip_y&#39;</span><span class="p">:</span> <span class="n">skip_y</span><span class="p">,</span> <span class="s1">&#39;scale&#39;</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span> <span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="mf">0.004</span><span class="p">}</span>
        <span class="n">phase_args</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">phase_style</span><span class="p">)</span>

        <span class="n">pt</span> <span class="o">=</span> <span class="n">phase_args</span><span class="p">[</span><span class="s1">&#39;pt&#39;</span><span class="p">]</span>
        <span class="n">skip_x</span> <span class="o">=</span> <span class="n">phase_args</span><span class="p">[</span><span class="s1">&#39;skip_x&#39;</span><span class="p">]</span>
        <span class="n">skip_y</span> <span class="o">=</span> <span class="n">phase_args</span><span class="p">[</span><span class="s1">&#39;skip_y&#39;</span><span class="p">]</span>
        <span class="n">scale</span> <span class="o">=</span> <span class="n">phase_args</span><span class="p">[</span><span class="s1">&#39;scale&#39;</span><span class="p">]</span>
        <span class="n">width</span> <span class="o">=</span> <span class="n">phase_args</span><span class="p">[</span><span class="s1">&#39;width&#39;</span><span class="p">]</span>

        <span class="n">phase</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phase</span><span class="p">)[:,</span> <span class="n">mask_freq</span><span class="p">]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">signif_qs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">phase</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">coherence</span> <span class="o">&lt;</span> <span class="n">pt</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">phase</span><span class="p">[</span><span class="n">signif_boundary</span><span class="o">.</span><span class="n">T</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

        <span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="p">[</span><span class="n">mask_freq</span><span class="p">])</span>
        <span class="n">U</span><span class="p">,</span> <span class="n">V</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phase</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phase</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">quiver</span><span class="p">(</span><span class="n">X</span><span class="p">[::</span><span class="n">skip_y</span><span class="p">,</span> <span class="p">::</span><span class="n">skip_x</span><span class="p">],</span> <span class="n">Y</span><span class="p">[::</span><span class="n">skip_y</span><span class="p">,</span> <span class="p">::</span><span class="n">skip_x</span><span class="p">],</span>
                  <span class="n">U</span><span class="p">[::</span><span class="n">skip_y</span><span class="p">,</span> <span class="p">::</span><span class="n">skip_x</span><span class="p">],</span> <span class="n">V</span><span class="p">[::</span><span class="n">skip_y</span><span class="p">,</span> <span class="p">::</span><span class="n">skip_x</span><span class="p">],</span>
                  <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">99</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ylim</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">xlim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xlim</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;fig&#39;</span> <span class="ow">in</span> <span class="nb">locals</span><span class="p">():</span>
            <span class="k">if</span> <span class="s1">&#39;path&#39;</span> <span class="ow">in</span> <span class="n">savefig_settings</span><span class="p">:</span>
                <span class="n">plotting</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">settings</span><span class="o">=</span><span class="n">savefig_settings</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">mute</span><span class="p">:</span>
                    <span class="n">plotting</span><span class="o">.</span><span class="n">showfig</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ax</span></div>

<div class="viewcode-block" id="Coherence.signif_test"><a class="viewcode-back" href="../../../core/ui.html#pyleoclim.core.ui.Coherence.signif_test">[docs]</a>    <span class="k">def</span> <span class="nf">signif_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">number</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;ar1&#39;</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">qs</span><span class="o">=</span><span class="p">[</span><span class="mf">0.95</span><span class="p">],</span> <span class="n">settings</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mute_pbar</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Significance testing</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        number : int, optional</span>
<span class="sd">            Number of surrogate series to create for significance testing. The default is 200.</span>
<span class="sd">        method : {&#39;ar1&#39;}, optional</span>
<span class="sd">            Method through which to generate the surrogate series. The default is &#39;ar1&#39;.</span>
<span class="sd">        seed : int, optional</span>
<span class="sd">            Fixes the seed for the random number generator. Useful for reproducibility. The default is None.</span>
<span class="sd">        qs : list, optional</span>
<span class="sd">            Significanc level to return. The default is [0.95].</span>
<span class="sd">        settings : dict, optional</span>
<span class="sd">            Parameters for surrogate model. The default is None.</span>
<span class="sd">        mute_pbar : bool, optional</span>
<span class="sd">            Mute the progress bar. The default is False.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        new : pyleoclim.Coherence</span>
<span class="sd">            Coherence with significance level</span>

<span class="sd">        See also</span>
<span class="sd">        --------</span>

<span class="sd">        pyleoclim.core.ui.Series.wavelet_coherence : Wavelet coherence</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="n">number</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span>

        <span class="n">new</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">surr1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeseries1</span><span class="o">.</span><span class="n">surrogates</span><span class="p">(</span>
            <span class="n">number</span><span class="o">=</span><span class="n">number</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="n">settings</span><span class="o">=</span><span class="n">settings</span>
        <span class="p">)</span>
        <span class="n">surr2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeseries2</span><span class="o">.</span><span class="n">surrogates</span><span class="p">(</span>
            <span class="n">number</span><span class="o">=</span><span class="n">number</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="n">settings</span><span class="o">=</span><span class="n">settings</span>
        <span class="p">)</span>

        <span class="n">cohs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">number</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Performing wavelet coherence on surrogate pairs&#39;</span><span class="p">,</span> <span class="n">total</span><span class="o">=</span><span class="n">number</span><span class="p">,</span> <span class="n">disable</span><span class="o">=</span><span class="n">mute_pbar</span><span class="p">):</span>
            <span class="n">coh_tmp</span> <span class="o">=</span> <span class="n">surr1</span><span class="o">.</span><span class="n">series_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">wavelet_coherence</span><span class="p">(</span><span class="n">surr2</span><span class="o">.</span><span class="n">series_list</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">freq_method</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">freq_method</span><span class="p">,</span> <span class="n">freq_kwargs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">freq_kwargs</span><span class="p">)</span>
            <span class="n">cohs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coh_tmp</span><span class="o">.</span><span class="n">coherence</span><span class="p">)</span>

        <span class="n">cohs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cohs</span><span class="p">)</span>

        <span class="n">ne</span><span class="p">,</span> <span class="n">nf</span><span class="p">,</span> <span class="n">nt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">cohs</span><span class="p">)</span>

        <span class="n">coh_qs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">qs</span><span class="p">),</span> <span class="n">nf</span><span class="p">,</span> <span class="n">nt</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nf</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nt</span><span class="p">):</span>
                <span class="n">coh_qs</span><span class="p">[:,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">mquantiles</span><span class="p">(</span><span class="n">cohs</span><span class="p">[:,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">],</span> <span class="n">qs</span><span class="p">)</span>

        <span class="n">scal_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">amp</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">coh_qs</span><span class="p">):</span>
            <span class="n">scal_tmp</span> <span class="o">=</span> <span class="n">Scalogram</span><span class="p">(</span>
                    <span class="n">frequency</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">amplitude</span><span class="o">=</span><span class="n">amp</span><span class="p">,</span> <span class="n">coi</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">coi</span><span class="p">,</span>
                    <span class="n">freq_method</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">freq_method</span><span class="p">,</span> <span class="n">freq_kwargs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">freq_kwargs</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">qs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="mi">100</span><span class="si">:</span><span class="s1">g</span><span class="si">}</span><span class="s1">%&#39;</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="n">scal_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scal_tmp</span><span class="p">)</span>

        <span class="n">new</span><span class="o">.</span><span class="n">signif_qs</span> <span class="o">=</span> <span class="n">MultipleScalogram</span><span class="p">(</span><span class="n">scalogram_list</span><span class="o">=</span><span class="n">scal_list</span><span class="p">)</span>
        <span class="n">new</span><span class="o">.</span><span class="n">signif_method</span> <span class="o">=</span> <span class="n">method</span>

        <span class="k">return</span> <span class="n">new</span></div></div>

<div class="viewcode-block" id="MultipleSeries"><a class="viewcode-back" href="../../../core/ui.html#pyleoclim.core.ui.MultipleSeries">[docs]</a><span class="k">class</span> <span class="nc">MultipleSeries</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;MultipleSeries object.</span>

<span class="sd">    This object handles multiple objects of the type Series and can be created from a list of Series objects.</span>
<span class="sd">    MultipleSeries should be used when the need to run analysis on multiple records arises, such as running principal component analysis.</span>
<span class="sd">    Some of the methods automatically rescale the time axis prior to analysis to ensure that the analysis is run over the same time period.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    series_list : list</span>
<span class="sd">        a list of pyleoclim.Series objects</span>

<span class="sd">    time_unit : str</span>
<span class="sd">        The target time unit for every series in the list.</span>
<span class="sd">        If None, then no conversion will be applied;</span>
<span class="sd">        Otherwise, the time unit of every series in the list will be converted to the target.</span>

<span class="sd">   name : str</span>
<span class="sd">        name of the collection of timeseries (e.g. &#39;PAGES 2k ice cores&#39;)</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    .. ipython:: python</span>
<span class="sd">        :okwarning:</span>

<span class="sd">        import pyleoclim as pyleo</span>
<span class="sd">        import pandas as pd</span>
<span class="sd">        data = pd.read_csv(</span>
<span class="sd">            &#39;https://raw.githubusercontent.com/LinkedEarth/Pyleoclim_util/Development/example_data/soi_data.csv&#39;,</span>
<span class="sd">            skiprows=0, header=1</span>
<span class="sd">        )</span>
<span class="sd">        time = data.iloc[:,1]</span>
<span class="sd">        value = data.iloc[:,2]</span>
<span class="sd">        ts1 = pyleo.Series(time=time, value=value, time_unit=&#39;years&#39;)</span>
<span class="sd">        ts2 = pyleo.Series(time=time, value=value, time_unit=&#39;years&#39;)</span>
<span class="sd">        ms = pyleo.MultipleSeries([ts1, ts2], name = &#39;SOI x2&#39;)</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">series_list</span><span class="p">,</span> <span class="n">time_unit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">series_list</span> <span class="o">=</span> <span class="n">series_list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_unit</span> <span class="o">=</span> <span class="n">time_unit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_unit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">new_ts_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">ts</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">series_list</span><span class="p">:</span>
                <span class="n">new_ts</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">convert_time_unit</span><span class="p">(</span><span class="n">time_unit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time_unit</span><span class="p">)</span>
                <span class="n">new_ts_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_ts</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">series_list</span> <span class="o">=</span> <span class="n">new_ts_list</span>

<div class="viewcode-block" id="MultipleSeries.convert_time_unit"><a class="viewcode-back" href="../../../core/ui.html#pyleoclim.core.ui.MultipleSeries.convert_time_unit">[docs]</a>    <span class="k">def</span> <span class="nf">convert_time_unit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time_unit</span><span class="o">=</span><span class="s1">&#39;years&#39;</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Convert the time unit of the timeseries</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        time_unit : str</span>
<span class="sd">            the target time unit, possible input:</span>
<span class="sd">            {</span>
<span class="sd">                &#39;year&#39;, &#39;years&#39;, &#39;yr&#39;, &#39;yrs&#39;,</span>
<span class="sd">                &#39;y BP&#39;, &#39;yr BP&#39;, &#39;yrs BP&#39;, &#39;year BP&#39;, &#39;years BP&#39;,</span>
<span class="sd">                &#39;ky BP&#39;, &#39;kyr BP&#39;, &#39;kyrs BP&#39;, &#39;ka BP&#39;, &#39;ka&#39;,</span>
<span class="sd">                &#39;my BP&#39;, &#39;myr BP&#39;, &#39;myrs BP&#39;, &#39;ma BP&#39;, &#39;ma&#39;,</span>
<span class="sd">            }</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        .. ipython:: python</span>
<span class="sd">            :okwarning:</span>

<span class="sd">            import pyleoclim as pyleo</span>
<span class="sd">            import pandas as pd</span>
<span class="sd">            data = pd.read_csv(</span>
<span class="sd">                &#39;https://raw.githubusercontent.com/LinkedEarth/Pyleoclim_util/Development/example_data/soi_data.csv&#39;,</span>
<span class="sd">                skiprows=0, header=1</span>
<span class="sd">            )</span>
<span class="sd">            time = data.iloc[:,1]</span>
<span class="sd">            value = data.iloc[:,2]</span>
<span class="sd">            ts1 = pyleo.Series(time=time, value=value, time_unit=&#39;years&#39;)</span>
<span class="sd">            ts2 = pyleo.Series(time=time, value=value, time_unit=&#39;years&#39;)</span>
<span class="sd">            ms = pyleo.MultipleSeries([ts1, ts2])</span>
<span class="sd">            new_ms = ms.convert_time_unit(&#39;yr BP&#39;)</span>
<span class="sd">            print(&#39;Original timeseries:&#39;)</span>
<span class="sd">            print(&#39;time unit:&#39;, ms.time_unit)</span>
<span class="sd">            print()</span>
<span class="sd">            print(&#39;Converted timeseries:&#39;)</span>
<span class="sd">            print(&#39;time unit:&#39;, new_ms.time_unit)</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">new_ms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">new_ts_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ts</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">series_list</span><span class="p">:</span>
            <span class="n">new_ts</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">convert_time_unit</span><span class="p">(</span><span class="n">time_unit</span><span class="o">=</span><span class="n">time_unit</span><span class="p">)</span>
            <span class="n">new_ts_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_ts</span><span class="p">)</span>

        <span class="n">new_ms</span><span class="o">.</span><span class="n">time_unit</span> <span class="o">=</span> <span class="n">time_unit</span>
        <span class="n">new_ms</span><span class="o">.</span><span class="n">series_list</span> <span class="o">=</span> <span class="n">new_ts_list</span>
        <span class="k">return</span> <span class="n">new_ms</span></div>

<div class="viewcode-block" id="MultipleSeries.filter"><a class="viewcode-back" href="../../../core/ui.html#pyleoclim.core.ui.MultipleSeries.filter">[docs]</a>    <span class="k">def</span> <span class="nf">filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cutoff_freq</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cutoff_scale</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;butterworth&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Filtering the timeseries in the MultipleSeries object</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        method : str, {&#39;savitzky-golay&#39;, &#39;butterworth&#39;, &#39;firwin&#39;}</span>
<span class="sd">            the filtering method</span>
<span class="sd">            - &#39;butterworth&#39;: the Butterworth method (default)</span>
<span class="sd">            - &#39;savitzky-golay&#39;: the Savitzky-Golay method</span>
<span class="sd">            - &#39;firwin&#39;: FIR filter design using the window method, with default window as Hanning</span>

<span class="sd">        cutoff_freq : float or list</span>
<span class="sd">            The cutoff frequency only works with the Butterworth method.</span>
<span class="sd">            If a float, it is interpreted as a low-frequency cutoff (lowpass).</span>
<span class="sd">            If a list,  it is interpreted as a frequency band (f1, f2), with f1 &lt; f2 (bandpass).</span>

<span class="sd">        cutoff_scale : float or list</span>
<span class="sd">            cutoff_freq = 1 / cutoff_scale</span>
<span class="sd">            The cutoff scale only works with the Butterworth method and when cutoff_freq is None.</span>
<span class="sd">            If a float, it is interpreted as a low-frequency (high-scale) cutoff (lowpass).</span>
<span class="sd">            If a list,  it is interpreted as a frequency band (f1, f2), with f1 &lt; f2 (bandpass).</span>

<span class="sd">        kwargs : dict</span>
<span class="sd">            a dictionary of the keyword arguments for the filtering method,</span>
<span class="sd">            see `pyleoclim.utils.filter.savitzky_golay`, `pyleoclim.utils.filter.butterworth`, and `pyleoclim.utils.filter.firwin` for the details</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        ms : pyleoclim.MultipleSeries</span>

<span class="sd">        See also</span>
<span class="sd">        --------</span>

<span class="sd">        pyleoclim.utils.filter.butterworth : Butterworth method</span>
<span class="sd">        pyleoclim.utils.filter.savitzky_golay : Savitzky-Golay method</span>
<span class="sd">        pyleoclim.utils.filter.firwin : FIR filter design using the window method</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">ms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="n">new_tslist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ts</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">series_list</span><span class="p">:</span>
            <span class="n">new_tslist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">cutoff_freq</span><span class="o">=</span><span class="n">cutoff_freq</span><span class="p">,</span> <span class="n">cutoff_scale</span><span class="o">=</span><span class="n">cutoff_scale</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>

        <span class="n">ms</span><span class="o">.</span><span class="n">series_list</span> <span class="o">=</span> <span class="n">new_tslist</span>

        <span class="k">return</span> <span class="n">ms</span></div>



<div class="viewcode-block" id="MultipleSeries.append"><a class="viewcode-back" href="../../../core/ui.html#pyleoclim.core.ui.MultipleSeries.append">[docs]</a>    <span class="k">def</span> <span class="nf">append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ts</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Append timeseries ts to MultipleSeries object</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ms : pyleoclim.MultipleSeries</span>
<span class="sd">            The augmented object, comprising the old one plus `ts`</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">ms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">ts_list</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">ms</span><span class="o">.</span><span class="n">series_list</span><span class="p">)</span>
        <span class="n">ts_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span>
        <span class="n">ms</span> <span class="o">=</span> <span class="n">MultipleSeries</span><span class="p">(</span><span class="n">ts_list</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ms</span></div>

<div class="viewcode-block" id="MultipleSeries.copy"><a class="viewcode-back" href="../../../core/ui.html#pyleoclim.core.ui.MultipleSeries.copy">[docs]</a>    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Copy the object</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="MultipleSeries.standardize"><a class="viewcode-back" href="../../../core/ui.html#pyleoclim.core.ui.MultipleSeries.standardize">[docs]</a>    <span class="k">def</span> <span class="nf">standardize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Standardize each series object</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ms : pyleoclim.MultipleSeries</span>
<span class="sd">            The standardized Series</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">ms</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span><span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ms</span><span class="o">.</span><span class="n">series_list</span><span class="p">):</span>
            <span class="n">s</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">v_mod</span><span class="o">=</span><span class="n">tsutils</span><span class="o">.</span><span class="n">standardize</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">value</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">s</span><span class="o">.</span><span class="n">value</span><span class="o">=</span><span class="n">v_mod</span>
            <span class="n">ms</span><span class="o">.</span><span class="n">series_list</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">=</span><span class="n">s</span>
        <span class="k">return</span> <span class="n">ms</span></div>

<div class="viewcode-block" id="MultipleSeries.common_time"><a class="viewcode-back" href="../../../core/ui.html#pyleoclim.core.ui.MultipleSeries.common_time">[docs]</a>    <span class="k">def</span> <span class="nf">common_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;interp&#39;</span><span class="p">,</span> <span class="n">common_step</span> <span class="o">=</span> <span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stop</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">step_style</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Aligns the time axes of a MultipleSeries object, via binning</span>
<span class="sd">        interpolation., or Gaussian kernel. Alignmentis critical for workflows</span>
<span class="sd">        that need to assume a common time axis for the group of series under consideration.</span>


<span class="sd">        The common time axis is characterized by the following parameters:</span>

<span class="sd">        start : the latest start date of the bunch (maximun of the minima)</span>
<span class="sd">        stop  : the earliest stop date of the bunch (minimum of the maxima)</span>
<span class="sd">        step  : The representative spacing between consecutive values</span>

<span class="sd">        Optional arguments for binning or interpolation are those of the underling functions.</span>

<span class="sd">        If the time axis are retrograde, this step makes them prograde.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        method :  string</span>
<span class="sd">            either &#39;bin&#39;, &#39;interp&#39; [default] or &#39;gkernel&#39;</span>
<span class="sd">        common_step : string</span>
<span class="sd">            Method to obtain a representative step among all Series</span>
<span class="sd">            Valid entries: &#39;median&#39; [default], &#39;mean&#39;, &#39;mode&#39; or &#39;max&#39;</span>
<span class="sd">        start : float</span>
<span class="sd">            starting point of the common time axis [default = None]</span>
<span class="sd">        stop : float</span>
<span class="sd">            end point of the common time axis [default = None]</span>
<span class="sd">        step : float</span>
<span class="sd">            increment the common time axis  [default = None]</span>

<span class="sd">        if not provided, `pyleoclim` will use `grid_properties()` to determine these parameters</span>

<span class="sd">        step_style : &#39;string&#39;</span>
<span class="sd">            step style to be applied from `grid_properties` [default = None]</span>


<span class="sd">        kwargs: dict</span>
<span class="sd">            keyword arguments (dictionary) of the various methods</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ms : pyleoclim.MultipleSeries</span>
<span class="sd">            The MultipleSeries objects with all series aligned to the same time axis.</span>


<span class="sd">        See also</span>
<span class="sd">        --------</span>

<span class="sd">        pyleoclim.utils.tsutils.bin : put timeseries values into equal bins (possibly leaving NaNs in).</span>
<span class="sd">        pyleoclim.utils.tsutils.gkernel : coarse-graining using a Gaussian kernel</span>
<span class="sd">        pyleoclim.utils.tsutils.interp : interpolation onto a regular grid (default = linear interpolation)</span>
<span class="sd">        pyleoclim.utils.tsutils.grid_properties : infer grid properties</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        .. ipython:: python</span>
<span class="sd">            :okwarning:</span>

<span class="sd">            import numpy as np</span>
<span class="sd">            import pyleoclim as pyleo</span>
<span class="sd">            import matplotlib.pyplot as plt</span>
<span class="sd">            from pyleoclim.utils.tsmodel import colored_noise</span>

<span class="sd">            # create 2 incompletely sampled series</span>
<span class="sd">            ns = 2 ; nt = 200; n_del = 20</span>
<span class="sd">            serieslist = []</span>


<span class="sd">            for j in range(ns):</span>
<span class="sd">                t = np.arange(nt)</span>
<span class="sd">                v = colored_noise(alpha=1, t=t)</span>
<span class="sd">                deleted_idx = np.random.choice(range(np.size(t)), n_del, replace=False)</span>
<span class="sd">                tu =  np.delete(t, deleted_idx)</span>
<span class="sd">                vu =  np.delete(v, deleted_idx)</span>
<span class="sd">                ts = pyleo.Series(time = tu, value = vu, label = &#39;series &#39; + str(j+1))</span>
<span class="sd">                serieslist.append(ts)</span>

<span class="sd">            # create MS object from the list</span>
<span class="sd">            ms = pyleo.MultipleSeries(serieslist)</span>

<span class="sd">            fig, ax = plt.subplots(2,2)</span>
<span class="sd">            ax = ax.flatten()</span>
<span class="sd">            # apply common_time with default parameters</span>
<span class="sd">            msc = ms.common_time()</span>
<span class="sd">            msc.plot(title=&#39;linear interpolation&#39;,ax=ax[0])</span>

<span class="sd">            # apply common_time with binning</span>
<span class="sd">            msc = ms.common_time(method=&#39;bin&#39;)</span>
<span class="sd">            msc.plot(title=&#39;Binning&#39;,ax=ax[1], legend=False)</span>

<span class="sd">            # apply common_time with gkernel</span>
<span class="sd">            msc = ms.common_time(method=&#39;gkernel&#39;)</span>
<span class="sd">            msc.plot(title=r&#39;Gaussian kernel ($h=3$)&#39;,ax=ax[2],legend=False)</span>

<span class="sd">            # apply common_time with gkernel modified</span>
<span class="sd">            msc = ms.common_time(method=&#39;gkernel&#39;, h=11)</span>
<span class="sd">            msc.plot(title=r&#39;Gaussian kernel ($h=11$)&#39;,ax=ax[3],legend=False)</span>

<span class="sd">            # display, save and close figure</span>
<span class="sd">            fig.tight_layout()</span>
<span class="sd">            @savefig ms_ct.png</span>
<span class="sd">            pyleo.showfig(fig)</span>
<span class="sd">            pyleo.closefig(fig)</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="n">step_style</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;bin&#39;</span> <span class="ow">or</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;gkernel&#39;</span><span class="p">:</span>
               <span class="n">step_style</span> <span class="o">=</span> <span class="s1">&#39;max&#39;</span>
            <span class="k">elif</span>  <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;interp&#39;</span><span class="p">:</span>
               <span class="n">step_style</span> <span class="o">=</span> <span class="s1">&#39;mean&#39;</span>

        <span class="n">gp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series_list</span><span class="p">),</span><span class="mi">3</span><span class="p">))</span> <span class="c1"># obtain grid parameters</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span><span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series_list</span><span class="p">):</span>
            <span class="n">item</span>      <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">clean</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">idx</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">gp</span><span class="p">[</span><span class="n">idx</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">tsutils</span><span class="o">.</span><span class="n">grid_properties</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">step_style</span><span class="o">=</span><span class="n">step_style</span><span class="p">)</span>
            <span class="c1"># if gp[idx,2] &lt; 0:  # flip time axis if retrograde</span>
            <span class="c1">#     item = item.clean(verbose=idx==0)</span>
            <span class="c1">#     gp[idx,2] = abs(gp[idx,2])</span>

        <span class="c1"># define parameters for common time axis</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">gp</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="n">stop</span>  <span class="o">=</span> <span class="n">gp</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">start</span> <span class="o">&gt;</span> <span class="n">stop</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;At least one series has no common time interval with others. Please check the time axis of the series.&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">common_step</span> <span class="o">==</span> <span class="s1">&#39;mean&#39;</span><span class="p">:</span>
            <span class="n">step</span> <span class="o">=</span> <span class="n">gp</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">common_step</span> <span class="o">==</span> <span class="s1">&#39;max&#39;</span><span class="p">:</span>
            <span class="n">step</span> <span class="o">=</span> <span class="n">gp</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">common_step</span> <span class="o">==</span> <span class="s1">&#39;mode&#39;</span><span class="p">:</span>
            <span class="n">step</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">mode</span><span class="p">(</span><span class="n">gp</span><span class="p">[:,</span><span class="mi">2</span><span class="p">])[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">step</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">gp</span><span class="p">[:,</span><span class="mi">2</span><span class="p">])</span>

        <span class="n">ms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;bin&#39;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span><span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series_list</span><span class="p">):</span>
                <span class="n">ts</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="n">d</span> <span class="o">=</span> <span class="n">tsutils</span><span class="o">.</span><span class="n">bin</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">ts</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">bin_size</span><span class="o">=</span><span class="n">step</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="n">stop</span><span class="p">,</span> <span class="n">evenly_spaced</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="n">ts</span><span class="o">.</span><span class="n">time</span>  <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;bins&#39;</span><span class="p">]</span>
                <span class="n">ts</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;binned_values&#39;</span><span class="p">]</span>
                <span class="n">ms</span><span class="o">.</span><span class="n">series_list</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">ts</span>

        <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;interp&#39;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span><span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series_list</span><span class="p">):</span>
                <span class="n">ts</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="n">ti</span><span class="p">,</span> <span class="n">vi</span> <span class="o">=</span> <span class="n">tsutils</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">ts</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="n">step</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="n">stop</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="n">ts</span><span class="o">.</span><span class="n">time</span>  <span class="o">=</span> <span class="n">ti</span>
                <span class="n">ts</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">vi</span>
                <span class="n">ms</span><span class="o">.</span><span class="n">series_list</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">ts</span>

        <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;gkernel&#39;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span><span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series_list</span><span class="p">):</span>
                <span class="n">ts</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="n">ti</span><span class="p">,</span> <span class="n">vi</span> <span class="o">=</span> <span class="n">tsutils</span><span class="o">.</span><span class="n">gkernel</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">time</span><span class="p">,</span><span class="n">ts</span><span class="o">.</span><span class="n">value</span><span class="p">,</span><span class="n">step</span><span class="o">=</span><span class="n">step</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="n">stop</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="n">ts</span><span class="o">.</span><span class="n">time</span>  <span class="o">=</span> <span class="n">ti</span>
                <span class="n">ts</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">vi</span>
                <span class="n">ms</span><span class="o">.</span><span class="n">series_list</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">ts</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="s1">&#39;Unknown methods; no action taken&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ms</span></div>

<div class="viewcode-block" id="MultipleSeries.correlation"><a class="viewcode-back" href="../../../core/ui.html#pyleoclim.core.ui.MultipleSeries.correlation">[docs]</a>    <span class="k">def</span> <span class="nf">correlation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">timespan</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">settings</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">common_time_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mute_pbar</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Calculate the correlation between a MultipleSeries and a target Series</span>

<span class="sd">        If the target Series is not specified, then the 1st member of MultipleSeries will be the target</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        target : pyleoclim.Series, optional</span>
<span class="sd">            A pyleoclim Series object.</span>

<span class="sd">        timespan : tuple</span>
<span class="sd">            The time interval over which to perform the calculation</span>

<span class="sd">        alpha : float</span>
<span class="sd">            The significance level (0.05 by default)</span>

<span class="sd">        settings : dict</span>
<span class="sd">            Parameters for the correlation function, including:</span>

<span class="sd">            nsim : int</span>
<span class="sd">                the number of simulations (default: 1000)</span>
<span class="sd">            method : str, {&#39;ttest&#39;,&#39;isopersistent&#39;,&#39;isospectral&#39; (default)}</span>
<span class="sd">                method for significance testing</span>

<span class="sd">        common_time_kwargs : dict</span>
<span class="sd">            Parameters for the method MultipleSeries.common_time()</span>

<span class="sd">        seed : float or int</span>
<span class="sd">            random seed for isopersistent and isospectral methods</span>

<span class="sd">        mute_pbar : bool</span>
<span class="sd">            If True, the progressbar will be muted. Default is False.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        res : dict</span>
<span class="sd">            Containing a list of the Pearson&#39;s correlation coefficient, associated significance and p-value.</span>

<span class="sd">        See also</span>
<span class="sd">        --------</span>

<span class="sd">        pyleoclim.utils.correlation.corr_sig : Correlation function</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        .. ipython:: python</span>
<span class="sd">            :okwarning:</span>

<span class="sd">            import pyleoclim as pyleo</span>
<span class="sd">            from pyleoclim.utils.tsmodel import colored_noise</span>

<span class="sd">            nt = 100</span>
<span class="sd">            t0 = np.arange(nt)</span>
<span class="sd">            v0 = colored_noise(alpha=1, t=t0)</span>
<span class="sd">            noise = np.random.normal(loc=0, scale=1, size=nt)</span>

<span class="sd">            ts0 = pyleo.Series(time=t0, value=v0)</span>
<span class="sd">            ts1 = pyleo.Series(time=t0, value=v0+noise)</span>
<span class="sd">            ts2 = pyleo.Series(time=t0, value=v0+2*noise)</span>
<span class="sd">            ts3 = pyleo.Series(time=t0, value=v0+1/2*noise)</span>

<span class="sd">            ts_list = [ts1, ts2, ts3]</span>

<span class="sd">            ms = pyleo.MultipleSeries(ts_list)</span>
<span class="sd">            ts_target = ts0</span>

<span class="sd">            # set an arbitrary randome seed to fix the result</span>
<span class="sd">            corr_res = ms.correlation(ts_target, settings={&#39;nsim&#39;: 20}, seed=2333)</span>
<span class="sd">            print(corr_res)</span>

<span class="sd">            # set an arbitrary randome seed to fix the result</span>
<span class="sd">            corr_res = ms.correlation(settings={&#39;nsim&#39;: 20}, seed=2333)</span>
<span class="sd">            print(corr_res)</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">r_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">signif_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">p_list</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="n">target</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">series_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">ts</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series_list</span><span class="p">),</span>  <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series_list</span><span class="p">),</span> <span class="n">disable</span><span class="o">=</span><span class="n">mute_pbar</span><span class="p">):</span>
            <span class="n">corr_res</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">correlation</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">timespan</span><span class="o">=</span><span class="n">timespan</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">settings</span><span class="o">=</span><span class="n">settings</span><span class="p">,</span> <span class="n">common_time_kwargs</span><span class="o">=</span><span class="n">common_time_kwargs</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>
            <span class="n">r_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">corr_res</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">])</span>
            <span class="n">signif_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">corr_res</span><span class="p">[</span><span class="s1">&#39;signif&#39;</span><span class="p">])</span>
            <span class="n">p_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">corr_res</span><span class="p">[</span><span class="s1">&#39;p&#39;</span><span class="p">])</span>

        <span class="n">r_lsit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">r_list</span><span class="p">)</span>
        <span class="n">p_lsit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">p_list</span><span class="p">)</span>

        <span class="n">corr_res</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;r&#39;</span><span class="p">:</span> <span class="n">r_list</span><span class="p">,</span>
            <span class="s1">&#39;p&#39;</span><span class="p">:</span> <span class="n">p_list</span><span class="p">,</span>
            <span class="s1">&#39;signif&#39;</span><span class="p">:</span> <span class="n">signif_list</span><span class="p">,</span>
            <span class="s1">&#39;alpha&#39;</span><span class="p">:</span> <span class="n">alpha</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">corr_res</span></div>

    <span class="c1"># def mssa(self, M, MC=0, f=0.5):</span>
    <span class="c1">#     data = []</span>
    <span class="c1">#     for val in self.series_list:</span>
    <span class="c1">#         data.append(val.value)</span>
    <span class="c1">#     data = np.transpose(np.asarray(data))</span>


    <span class="c1">#     res = decomposition.mssa(data, M=M, MC=MC, f=f)</span>
    <span class="c1">#     return res</span>

<div class="viewcode-block" id="MultipleSeries.equal_lengths"><a class="viewcode-back" href="../../../core/ui.html#pyleoclim.core.ui.MultipleSeries.equal_lengths">[docs]</a>    <span class="k">def</span> <span class="nf">equal_lengths</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Test whether all series in object have equal length</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        flag : boolean</span>
<span class="sd">        lengths : list containing the lengths of the series in object</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">lengths</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ts</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">series_list</span><span class="p">:</span>
            <span class="n">lengths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>

        <span class="n">L</span> <span class="o">=</span> <span class="n">lengths</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">lengths</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="n">flag</span> <span class="o">=</span> <span class="nb">all</span> <span class="p">(</span><span class="n">l</span><span class="o">==</span><span class="n">L</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">r</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">flag</span><span class="p">,</span> <span class="n">lengths</span></div>

<div class="viewcode-block" id="MultipleSeries.pca"><a class="viewcode-back" href="../../../core/ui.html#pyleoclim.core.ui.MultipleSeries.pca">[docs]</a>    <span class="k">def</span> <span class="nf">pca</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">nMC</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span><span class="o">**</span><span class="n">pca_kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Principal Component Analysis</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        nMC : int</span>
<span class="sd">            number of Monte Carlo simulations</span>

<span class="sd">        pca_kwargs : tuple</span>


<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        res : dictionary containing:</span>

<span class="sd">            - eigval : eigenvalues (nrec,)</span>
<span class="sd">            - eig_ar1 : eigenvalues of the AR(1) ensemble (nrec, nMC)</span>
<span class="sd">            - pcs  : PC series of all components (nrec, nt)</span>
<span class="sd">            - eofs : EOFs of all components (nrec, nrec)</span>

<span class="sd">        References:</span>
<span class="sd">        ----------</span>
<span class="sd">        Deininger, M., McDermott, F., Mudelsee, M. et al. (2017): Coherency of late Holocene</span>
<span class="sd">        European speleothem 18O records linked to North Atlantic Ocean circulation.</span>
<span class="sd">        Climate Dynamics, 49, 595618. https://doi.org/10.1007/s00382-016-3360-8</span>

<span class="sd">        See also</span>
<span class="sd">        --------</span>

<span class="sd">        pyleoclim.utils.decomposition.mcpca: Monte Carlo PCA</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        .. ipython:: python</span>
<span class="sd">            :okwarning:</span>

<span class="sd">            import pyleoclim as pyleo</span>
<span class="sd">            url = &#39;http://wiki.linked.earth/wiki/index.php/Special:WTLiPD?op=export&amp;lipdid=MD982176.Stott.2004&#39;</span>
<span class="sd">            data = pyleo.Lipd(usr_path = url)</span>
<span class="sd">            tslist = data.to_LipdSeriesList()</span>
<span class="sd">            tslist = tslist[2:] # drop the first two series which only concerns age and depth</span>
<span class="sd">            ms = pyleo.MultipleSeries(tslist)</span>

<span class="sd">            # msc = ms.common_time()</span>

<span class="sd">            # res = msc.pca(nMC=20)</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">flag</span><span class="p">,</span> <span class="n">lengths</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">equal_lengths</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">flag</span><span class="o">==</span><span class="kc">False</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;All Time Series should be of same length. Apply common_time() first&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span> <span class="c1"># if all series have equal length</span>
            <span class="n">p</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lengths</span><span class="p">)</span>
            <span class="n">n</span> <span class="o">=</span> <span class="n">lengths</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">ys</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">n</span><span class="p">,</span><span class="n">p</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
                <span class="n">ys</span><span class="p">[:,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">series_list</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>

        <span class="n">res</span> <span class="o">=</span> <span class="n">decomposition</span><span class="o">.</span><span class="n">mcpca</span><span class="p">(</span><span class="n">ys</span><span class="p">,</span> <span class="n">nMC</span><span class="p">,</span> <span class="o">**</span><span class="n">pca_kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">res</span></div>

<div class="viewcode-block" id="MultipleSeries.bin"><a class="viewcode-back" href="../../../core/ui.html#pyleoclim.core.ui.MultipleSeries.bin">[docs]</a>    <span class="k">def</span> <span class="nf">bin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Aligns the time axes of a MultipleSeries object, via binning.</span>
<span class="sd">        This is critical for workflows that need to assume a common time axis</span>
<span class="sd">        for the group of series under consideration.</span>


<span class="sd">        The common time axis is characterized by the following parameters:</span>

<span class="sd">        start : the latest start date of the bunch (maximin of the minima)</span>
<span class="sd">        stop  : the earliest stop date of the bunch (minimum of the maxima)</span>
<span class="sd">        step  : The representative spacing between consecutive values (mean of the median spacings)</span>

<span class="sd">        This is a special case of the common_time function.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        kwargs : dict</span>
<span class="sd">            Arguments for the binning function. See pyleoclim.utils.tsutils.bin</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ms : pyleoclim.MultipleSeries</span>
<span class="sd">            The MultipleSeries objects with all series aligned to the same time axis.</span>

<span class="sd">        See also</span>
<span class="sd">        --------</span>

<span class="sd">        pyleoclim.core.ui.MultipleSeries.common_time: Base function on which this operates</span>

<span class="sd">        pyleoclim.utils.tsutils.bin: Underlying binning function</span>

<span class="sd">        pyleoclim.core.ui.Series.bin: Bin function for Series object</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        .. ipython:: python</span>
<span class="sd">            :okwarning:</span>

<span class="sd">            import pyleoclim as pyleo</span>
<span class="sd">            url = &#39;http://wiki.linked.earth/wiki/index.php/Special:WTLiPD?op=export&amp;lipdid=MD982176.Stott.2004&#39;</span>
<span class="sd">            data = pyleo.Lipd(usr_path = url)</span>
<span class="sd">            tslist = data.to_LipdSeriesList()</span>
<span class="sd">            tslist = tslist[2:] # drop the first two series which only concerns age and depth</span>
<span class="sd">            ms = pyleo.MultipleSeries(tslist)</span>
<span class="sd">            msbin = ms.bin()</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">ms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="n">ms</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">common_time</span><span class="p">(</span><span class="n">method</span> <span class="o">=</span> <span class="s1">&#39;bin&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ms</span></div>

<div class="viewcode-block" id="MultipleSeries.gkernel"><a class="viewcode-back" href="../../../core/ui.html#pyleoclim.core.ui.MultipleSeries.gkernel">[docs]</a>    <span class="k">def</span> <span class="nf">gkernel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Aligns the time axes of a MultipleSeries object, via Gaussian kernel.</span>
<span class="sd">        This is critical for workflows that need to assume a common time axis</span>
<span class="sd">        for the group of series under consideration.</span>


<span class="sd">        The common time axis is characterized by the following parameters:</span>

<span class="sd">        start : the latest start date of the bunch (maximin of the minima)</span>
<span class="sd">        stop  : the earliest stop date of the bunch (minimum of the maxima)</span>
<span class="sd">        step  : The representative spacing between consecutive values (mean of the median spacings)</span>

<span class="sd">        This is a special case of the common_time function.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        kwargs : dict</span>
<span class="sd">            Arguments for gkernel. See pyleoclim.utils.tsutils.gkernel for details.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ms : pyleoclim.MultipleSeries</span>
<span class="sd">            The MultipleSeries objects with all series aligned to the same time axis.</span>

<span class="sd">        See also</span>
<span class="sd">        --------</span>

<span class="sd">        pyleoclim.core.ui.MultipleSeries.common_time: Base function on which this operates</span>

<span class="sd">        pyleoclim.utils.tsutils.gkernel: Underlying kernel module</span>


<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        .. ipython:: python</span>
<span class="sd">            :okwarning:</span>

<span class="sd">            import pyleoclim as pyleo</span>
<span class="sd">            url = &#39;http://wiki.linked.earth/wiki/index.php/Special:WTLiPD?op=export&amp;lipdid=MD982176.Stott.2004&#39;</span>
<span class="sd">            data = pyleo.Lipd(usr_path = url)</span>
<span class="sd">            tslist = data.to_LipdSeriesList()</span>
<span class="sd">            tslist = tslist[2:] # drop the first two series which only concerns age and depth</span>
<span class="sd">            ms = pyleo.MultipleSeries(tslist)</span>
<span class="sd">            msk = ms.gkernel()</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">ms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="n">ms</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">common_time</span><span class="p">(</span><span class="n">method</span> <span class="o">=</span> <span class="s1">&#39;gkernel&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ms</span></div>

<div class="viewcode-block" id="MultipleSeries.interp"><a class="viewcode-back" href="../../../core/ui.html#pyleoclim.core.ui.MultipleSeries.interp">[docs]</a>    <span class="k">def</span> <span class="nf">interp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Aligns the time axes of a MultipleSeries object, via interpolation.</span>
<span class="sd">        This is critical for workflows that need to assume a common time axis</span>
<span class="sd">        for the group of series under consideration.</span>


<span class="sd">        The common time axis is characterized by the following parameters:</span>

<span class="sd">        start : the latest start date of the bunch (maximin of the minima)</span>
<span class="sd">        stop  : the earliest stop date of the bunch (minimum of the maxima)</span>
<span class="sd">        step  : The representative spacing between consecutive values (mean of the median spacings)</span>

<span class="sd">        This is a special case of the common_time function.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        kwargs: keyword arguments (dictionary) for the interpolation method</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ms : pyleoclim.MultipleSeries</span>
<span class="sd">            The MultipleSeries objects with all series aligned to the same time axis.</span>

<span class="sd">        See also</span>
<span class="sd">        --------</span>

<span class="sd">        pyleoclim.core.ui.MultipleSeries.common_time: Base function on which this operates</span>

<span class="sd">        pyleoclim.utils.tsutils.interp: Underlying interpolation function</span>

<span class="sd">        pyleoclim.core.ui.Series.interp: Interpolation function for Series object</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        .. ipython:: python</span>
<span class="sd">            :okwarning:</span>

<span class="sd">            import pyleoclim as pyleo</span>
<span class="sd">            url = &#39;http://wiki.linked.earth/wiki/index.php/Special:WTLiPD?op=export&amp;lipdid=MD982176.Stott.2004&#39;</span>
<span class="sd">            data = pyleo.Lipd(usr_path = url)</span>
<span class="sd">            tslist = data.to_LipdSeriesList()</span>
<span class="sd">            tslist = tslist[2:] # drop the first two series which only concerns age and depth</span>
<span class="sd">            ms = pyleo.MultipleSeries(tslist)</span>
<span class="sd">            msinterp = ms.interp()</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">ms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="n">ms</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">common_time</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;interp&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ms</span></div>

<div class="viewcode-block" id="MultipleSeries.detrend"><a class="viewcode-back" href="../../../core/ui.html#pyleoclim.core.ui.MultipleSeries.detrend">[docs]</a>    <span class="k">def</span> <span class="nf">detrend</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;emd&#39;</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Detrend timeseries</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        method : str, optional</span>
<span class="sd">            The method for detrending. The default is &#39;emd&#39;.</span>
<span class="sd">            Options include:</span>
<span class="sd">                * linear: the result of a linear least-squares fit to y is subtracted from y.</span>
<span class="sd">                * constant: only the mean of data is subtrated.</span>
<span class="sd">                * &quot;savitzky-golay&quot;, y is filtered using the Savitzky-Golay filters and the resulting filtered series is subtracted from y.</span>
<span class="sd">                * &quot;emd&quot; (default): Empirical mode decomposition. The last mode is assumed to be the trend and removed from the series</span>
<span class="sd">        **kwargs : dict</span>
<span class="sd">            Relevant arguments for each of the methods.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ms : pyleoclim.MultipleSeries</span>
<span class="sd">            The detrended timeseries</span>

<span class="sd">        See also</span>
<span class="sd">        --------</span>

<span class="sd">        pyleoclim.core.ui.Series.detrend : Detrending for a single series</span>
<span class="sd">        pyleoclim.utils.tsutils.detrend : Detrending function</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">ms</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span><span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ms</span><span class="o">.</span><span class="n">series_list</span><span class="p">):</span>
            <span class="n">s</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">v_mod</span><span class="o">=</span><span class="n">tsutils</span><span class="o">.</span><span class="n">detrend</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">value</span><span class="p">,</span><span class="n">x</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">time</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">s</span><span class="o">.</span><span class="n">value</span><span class="o">=</span><span class="n">v_mod</span>
            <span class="n">ms</span><span class="o">.</span><span class="n">series_list</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">=</span><span class="n">s</span>
        <span class="k">return</span> <span class="n">ms</span></div>

<div class="viewcode-block" id="MultipleSeries.spectral"><a class="viewcode-back" href="../../../core/ui.html#pyleoclim.core.ui.MultipleSeries.spectral">[docs]</a>    <span class="k">def</span> <span class="nf">spectral</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;lomb_scargle&#39;</span><span class="p">,</span> <span class="n">settings</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mute_pbar</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">freq_method</span><span class="o">=</span><span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="n">freq_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Perform spectral analysis on the timeseries</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        method : str</span>
<span class="sd">            {&#39;wwz&#39;, &#39;mtm&#39;, &#39;lomb_scargle&#39;, &#39;welch&#39;, &#39;periodogram&#39;}</span>

<span class="sd">        freq_method : str</span>
<span class="sd">            {&#39;log&#39;,&#39;scale&#39;, &#39;nfft&#39;, &#39;lomb_scargle&#39;, &#39;welch&#39;}</span>

<span class="sd">        freq_kwargs : dict</span>
<span class="sd">            Arguments for frequency vector</span>

<span class="sd">        settings : dict</span>
<span class="sd">            Arguments for the specific spectral method</span>

<span class="sd">        label : str</span>
<span class="sd">            Label for the PSD object</span>

<span class="sd">        verbose : bool</span>
<span class="sd">            If True, will print warning messages if there is any</span>

<span class="sd">        mute_pbar : {True, False}</span>
<span class="sd">            Mute the progress bar. Default is False.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        psd : pyleoclim.MultiplePSD</span>
<span class="sd">            A Multiple PSD object</span>

<span class="sd">        See also</span>
<span class="sd">        --------</span>
<span class="sd">        pyleoclim.utils.spectral.mtm : Spectral analysis using the Multitaper approach</span>

<span class="sd">        pyleoclim.utils.spectral.lomb_scargle : Spectral analysis using the Lomb-Scargle method</span>

<span class="sd">        pyleoclim.utils.spectral.welch: Spectral analysis using the Welch segement approach</span>

<span class="sd">        pyleoclim.utils.spectral.periodogram: Spectral anaysis using the basic Fourier transform</span>

<span class="sd">        pyleoclim.utils.spectral.wwz_psd : Spectral analysis using the Wavelet Weighted Z transform</span>

<span class="sd">        pyleoclim.utils.wavelet.make_freq : Functions to create the frequency vector</span>

<span class="sd">        pyleoclim.utils.tsutils.detrend : Detrending function</span>

<span class="sd">        pyleoclim.core.ui.Series.spectral : Spectral analysis for a single timeseries</span>

<span class="sd">        pyleoclim.core.ui.PSD : PSD object</span>

<span class="sd">        pyleoclim.core.ui.MultiplePSD : Multiple PSD object</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">settings</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">settings</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">settings</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="n">psd_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series_list</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Performing spectral analysis on individual series&#39;</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">leave</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">disable</span><span class="o">=</span><span class="n">mute_pbar</span><span class="p">):</span>
            <span class="n">psd_tmp</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">spectral</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="n">settings</span><span class="o">=</span><span class="n">settings</span><span class="p">,</span> <span class="n">freq_method</span><span class="o">=</span><span class="n">freq_method</span><span class="p">,</span> <span class="n">freq_kwargs</span><span class="o">=</span><span class="n">freq_kwargs</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
            <span class="n">psd_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">psd_tmp</span><span class="p">)</span>

        <span class="n">psds</span> <span class="o">=</span> <span class="n">MultiplePSD</span><span class="p">(</span><span class="n">psd_list</span><span class="o">=</span><span class="n">psd_list</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">psds</span></div>

<div class="viewcode-block" id="MultipleSeries.wavelet"><a class="viewcode-back" href="../../../core/ui.html#pyleoclim.core.ui.MultipleSeries.wavelet">[docs]</a>    <span class="k">def</span> <span class="nf">wavelet</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;wwz&#39;</span><span class="p">,</span> <span class="n">settings</span><span class="o">=</span><span class="p">{},</span> <span class="n">freq_method</span><span class="o">=</span><span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="n">ntau</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">freq_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">mute_pbar</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Wavelet analysis</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        method : {wwz, cwt}</span>
<span class="sd">            Whether to use the wwz method for unevenly spaced timeseries or traditional cwt (from pywavelets)</span>

<span class="sd">        settings : dict, optional</span>
<span class="sd">            Settings for the particular method. The default is {}.</span>

<span class="sd">        freq_method : str</span>
<span class="sd">            {&#39;log&#39;, &#39;scale&#39;, &#39;nfft&#39;, &#39;lomb_scargle&#39;, &#39;welch&#39;}</span>

<span class="sd">        freq_kwargs : dict</span>
<span class="sd">            Arguments for frequency vector</span>

<span class="sd">        ntau : int</span>
<span class="sd">            The length of the time shift points that determins the temporal resolution of the result.</span>
<span class="sd">            If None, it will be either the length of the input time axis, or at most 100.</span>

<span class="sd">        settings : dict</span>
<span class="sd">            Arguments for the specific spectral method</span>

<span class="sd">        verbose : bool</span>
<span class="sd">            If True, will print warning messages if there is any</span>


<span class="sd">        mute_pbar : bool, optional</span>
<span class="sd">            Whether to mute the progress bar. The default is False.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        scals : pyleoclim.MultipleScalograms</span>

<span class="sd">        See also</span>
<span class="sd">        --------</span>
<span class="sd">        pyleoclim.utils.wavelet.wwz : wwz function</span>

<span class="sd">        pyleoclim.utils.wavelet.make_freq : Functions to create the frequency vector</span>

<span class="sd">        pyleoclim.utils.tsutils.detrend : Detrending function</span>

<span class="sd">        pyleoclim.core.ui.Series.wavelet : wavelet analysis on single object</span>

<span class="sd">        pyleoclim.core.ui.MultipleScalogram : Multiple Scalogram object</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">settings</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">settings</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">settings</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="n">scal_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series_list</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Performing wavelet analysis on individual series&#39;</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">leave</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">disable</span><span class="o">=</span><span class="n">mute_pbar</span><span class="p">):</span>
            <span class="n">scal_tmp</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">wavelet</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="n">settings</span><span class="o">=</span><span class="n">settings</span><span class="p">,</span> <span class="n">freq_method</span><span class="o">=</span><span class="n">freq_method</span><span class="p">,</span> <span class="n">freq_kwargs</span><span class="o">=</span><span class="n">freq_kwargs</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span> <span class="n">ntau</span><span class="o">=</span><span class="n">ntau</span><span class="p">)</span>
            <span class="n">scal_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scal_tmp</span><span class="p">)</span>

        <span class="n">scals</span> <span class="o">=</span> <span class="n">MultipleScalogram</span><span class="p">(</span><span class="n">scalogram_list</span><span class="o">=</span><span class="n">scal_list</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">scals</span></div>

<div class="viewcode-block" id="MultipleSeries.plot"><a class="viewcode-back" href="../../../core/ui.html#pyleoclim.core.ui.MultipleSeries.plot">[docs]</a>    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
             <span class="n">marker</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">linestyle</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;tab10&#39;</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">xlabel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">plot_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lgd_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">savefig_settings</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mute</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">invert_xaxis</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Plot multiple timeseries on the same axis</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        figsize : list, optional</span>
<span class="sd">            Size of the figure. The default is [10, 4].</span>
<span class="sd">        marker : str, optional</span>
<span class="sd">            marker type. The default is None.</span>
<span class="sd">        markersize : float, optional</span>
<span class="sd">            marker size. The default is None.</span>
<span class="sd">        colors : a list of, or one, Python supported color code (a string of hex code or a tuple of rgba values)</span>
<span class="sd">            Colors for plotting.</span>
<span class="sd">            If None, the plotting will cycle the &#39;tab10&#39; colormap;</span>
<span class="sd">            if only one color is specified, then all curves will be plotted with that single color;</span>
<span class="sd">            if a list of colors are specified, then the plotting will cycle that color list.</span>
<span class="sd">        cmap : str</span>
<span class="sd">            The colormap to use when &quot;colors&quot; is None.</span>
<span class="sd">        norm : matplotlib.colors.Normalize like</span>
<span class="sd">            The nomorlization for the colormap.</span>
<span class="sd">            If None, a linear normalization will be used.</span>
<span class="sd">        linestyle : str, optional</span>
<span class="sd">            Line style. The default is None.</span>
<span class="sd">        linewidth : float, optional</span>
<span class="sd">            The width of the line. The default is None.</span>
<span class="sd">        xlabel : str, optional</span>
<span class="sd">            x-axis label. The default is None.</span>
<span class="sd">        ylabel : str, optional</span>
<span class="sd">            y-axis label. The default is None.</span>
<span class="sd">        title : str, optional</span>
<span class="sd">            Title. The default is None.</span>
<span class="sd">        legend : bool, optional</span>
<span class="sd">            Wether the show the legend. The default is True.</span>
<span class="sd">        plot_kwargs : dict, optional</span>
<span class="sd">            Plot parameters. The default is None.</span>
<span class="sd">        lgd_kwargs : dict, optional</span>
<span class="sd">            Legend parameters. The default is None.</span>
<span class="sd">        savefig_settings : dictionary, optional</span>
<span class="sd">            the dictionary of arguments for plt.savefig(); some notes below:</span>
<span class="sd">            - &quot;path&quot; must be specified; it can be any existed or non-existed path,</span>
<span class="sd">              with or without a suffix; if the suffix is not given in &quot;path&quot;, it will follow &quot;format&quot;</span>
<span class="sd">            - &quot;format&quot; can be one of {&quot;pdf&quot;, &quot;eps&quot;, &quot;png&quot;, &quot;ps&quot;} The default is None.</span>
<span class="sd">        ax : matplotlib.ax, optional</span>
<span class="sd">            The matplotlib axis onto which to return the figure. The default is None.</span>
<span class="sd">        mute : bool, optional</span>
<span class="sd">            if True, the plot will not show;</span>
<span class="sd">            recommend to turn on when more modifications are going to be made on ax</span>
<span class="sd">        invert_xaxis : bool, optional</span>
<span class="sd">            if True, the x-axis of the plot will be inverted</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        fig, ax</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># Turn the interactive mode off.</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ioff</span><span class="p">()</span>

        <span class="n">savefig_settings</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">savefig_settings</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">savefig_settings</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">plot_kwargs</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">plot_kwargs</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">plot_kwargs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">lgd_kwargs</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">lgd_kwargs</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">lgd_kwargs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">ylabel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">consistent_ylabels</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">time_label</span><span class="p">,</span> <span class="n">value_label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">series_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">make_labels</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">series_list</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                <span class="n">time_label_tmp</span><span class="p">,</span> <span class="n">value_label_tmp</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">make_labels</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">value_label_tmp</span> <span class="o">!=</span> <span class="n">value_label</span><span class="p">:</span>
                    <span class="n">consistent_ylabels</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="k">if</span> <span class="n">consistent_ylabels</span><span class="p">:</span>
                <span class="n">ylabel</span> <span class="o">=</span> <span class="n">value_label</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ylabel</span> <span class="o">=</span> <span class="s1">&#39;value&#39;</span>

        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series_list</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">colors</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">cmap_obj</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="n">cmap</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">cmap_obj</span><span class="p">,</span> <span class="s1">&#39;colors&#39;</span><span class="p">):</span>
                    <span class="n">nc</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cmap_obj</span><span class="o">.</span><span class="n">colors</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">nc</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series_list</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">norm</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">norm</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">nc</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

                <span class="n">clr</span> <span class="o">=</span> <span class="n">cmap_obj</span><span class="p">(</span><span class="n">norm</span><span class="p">(</span><span class="n">idx</span><span class="o">%</span><span class="n">nc</span><span class="p">))</span>
            <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">colors</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
                <span class="n">clr</span> <span class="o">=</span> <span class="n">colors</span>
            <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">colors</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
                <span class="n">nc</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">colors</span><span class="p">)</span>
                <span class="n">clr</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="n">idx</span><span class="o">%</span><span class="n">nc</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;&quot;colors&quot; should be a list of, or one, Python supported color code (a string of hex code or a tuple of rgba values)&#39;</span><span class="p">)</span>

            <span class="n">ax</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                <span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="n">markersize</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">clr</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="n">linestyle</span><span class="p">,</span>
                <span class="n">linewidth</span><span class="o">=</span><span class="n">linewidth</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">s</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="n">xlabel</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="n">ylabel</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
                <span class="n">legend</span><span class="o">=</span><span class="n">legend</span><span class="p">,</span> <span class="n">lgd_kwargs</span><span class="o">=</span><span class="n">lgd_kwargs</span><span class="p">,</span> <span class="n">plot_kwargs</span><span class="o">=</span><span class="n">plot_kwargs</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">invert_xaxis</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">invert_xaxis</span><span class="p">()</span>

        <span class="k">if</span> <span class="s1">&#39;fig&#39;</span> <span class="ow">in</span> <span class="nb">locals</span><span class="p">():</span>
            <span class="k">if</span> <span class="s1">&#39;path&#39;</span> <span class="ow">in</span> <span class="n">savefig_settings</span><span class="p">:</span>
                <span class="n">plotting</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">settings</span><span class="o">=</span><span class="n">savefig_settings</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">mute</span><span class="p">:</span>
                    <span class="n">plotting</span><span class="o">.</span><span class="n">showfig</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ax</span></div>

<div class="viewcode-block" id="MultipleSeries.stackplot"><a class="viewcode-back" href="../../../core/ui.html#pyleoclim.core.ui.MultipleSeries.stackplot">[docs]</a>    <span class="k">def</span> <span class="nf">stackplot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">savefig_settings</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  <span class="n">xlim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fill_between_alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;tab10&#39;</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">spine_lw</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">grid_lw</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">font_scale</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">label_x_loc</span><span class="o">=-</span><span class="mf">0.15</span><span class="p">,</span> <span class="n">v_shift_factor</span><span class="o">=</span><span class="mi">3</span><span class="o">/</span><span class="mi">4</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Stack plot of multiple series</span>

<span class="sd">        Note that the plotting style is uniquely designed for this one and cannot be properly reset with `pyleoclim.set_style()`.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        figsize : list</span>
<span class="sd">            Size of the figure.</span>
<span class="sd">        colors : a list of, or one, Python supported color code (a string of hex code or a tuple of rgba values)</span>
<span class="sd">            Colors for plotting.</span>
<span class="sd">            If None, the plotting will cycle the &#39;tab10&#39; colormap;</span>
<span class="sd">            if only one color is specified, then all curves will be plotted with that single color;</span>
<span class="sd">            if a list of colors are specified, then the plotting will cycle that color list.</span>
<span class="sd">        cmap : str</span>
<span class="sd">            The colormap to use when &quot;colors&quot; is None.</span>
<span class="sd">        norm : matplotlib.colors.Normalize like</span>
<span class="sd">            The nomorlization for the colormap.</span>
<span class="sd">            If None, a linear normalization will be used.</span>
<span class="sd">        savefig_settings : dictionary</span>
<span class="sd">            the dictionary of arguments for plt.savefig(); some notes below:</span>
<span class="sd">            - &quot;path&quot; must be specified; it can be any existed or non-existed path,</span>
<span class="sd">              with or without a suffix; if the suffix is not given in &quot;path&quot;, it will follow &quot;format&quot;</span>
<span class="sd">            - &quot;format&quot; can be one of {&quot;pdf&quot;, &quot;eps&quot;, &quot;png&quot;, &quot;ps&quot;} The default is None.</span>
<span class="sd">        xlim : list</span>
<span class="sd">            The x-axis limit.</span>
<span class="sd">        fill_between_alpha : float</span>
<span class="sd">            The transparency for the fill_between shades.</span>
<span class="sd">        spine_lw : float</span>
<span class="sd">            The linewidth for the spines of the axes.</span>
<span class="sd">        grid_lw : float</span>
<span class="sd">            The linewidth for the gridlines.</span>
<span class="sd">        linewidth : float</span>
<span class="sd">            The linewidth for the curves.</span>
<span class="sd">        font_scale : float</span>
<span class="sd">            The scale for the font sizes. Default is 0.8.</span>
<span class="sd">        label_x_loc : float</span>
<span class="sd">            The x location for the label of each curve.</span>
<span class="sd">        v_shift_factor : float</span>
<span class="sd">            The factor for the vertical shift of each axis.</span>
<span class="sd">            The default value 3/4 means the top of the next axis will be located at 3/4 of the height of the previous one.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        fig, ax</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        .. ipython:: python</span>
<span class="sd">            :okwarning:</span>

<span class="sd">            import pyleoclim as pyleo</span>
<span class="sd">            url = &#39;http://wiki.linked.earth/wiki/index.php/Special:WTLiPD?op=export&amp;lipdid=MD982176.Stott.2004&#39;</span>
<span class="sd">            data = pyleo.Lipd(usr_path = url)</span>
<span class="sd">            tslist = data.to_LipdSeriesList()</span>
<span class="sd">            tslist = tslist[2:] # drop the first two series which only concerns age and depth</span>
<span class="sd">            ms = pyleo.MultipleSeries(tslist)</span>
<span class="sd">            @savefig mts_stackplot.png</span>
<span class="sd">            fig, ax = ms.stackplot()</span>
<span class="sd">            pyleo.closefig(fig)</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ioff</span><span class="p">()</span>
        <span class="n">current_style</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">)</span>
        <span class="n">plotting</span><span class="o">.</span><span class="n">set_style</span><span class="p">(</span><span class="s1">&#39;journal&#39;</span><span class="p">,</span> <span class="n">font_scale</span><span class="o">=</span><span class="n">font_scale</span><span class="p">)</span>
        <span class="n">savefig_settings</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">savefig_settings</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">savefig_settings</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="n">n_ts</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series_list</span><span class="p">)</span>

        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">xlim</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">time_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
            <span class="n">time_max</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
            <span class="k">for</span> <span class="n">ts</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">series_list</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">time</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">time_min</span><span class="p">:</span>
                    <span class="n">time_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">time</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">time</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">time_max</span><span class="p">:</span>
                    <span class="n">time_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">time</span><span class="p">)</span>
            <span class="n">xlim</span> <span class="o">=</span> <span class="p">[</span><span class="n">time_min</span><span class="p">,</span> <span class="n">time_max</span><span class="p">]</span>

        <span class="n">ax</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">left</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">width</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">height</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">n_ts</span>
        <span class="n">bottom</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">ts</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series_list</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">colors</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">cmap_obj</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="n">cmap</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">cmap_obj</span><span class="p">,</span> <span class="s1">&#39;colors&#39;</span><span class="p">):</span>
                    <span class="n">nc</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cmap_obj</span><span class="o">.</span><span class="n">colors</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">nc</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series_list</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">norm</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">norm</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">nc</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

                <span class="n">clr</span> <span class="o">=</span> <span class="n">cmap_obj</span><span class="p">(</span><span class="n">norm</span><span class="p">(</span><span class="n">idx</span><span class="o">%</span><span class="n">nc</span><span class="p">))</span>
            <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">colors</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
                <span class="n">clr</span> <span class="o">=</span> <span class="n">colors</span>
            <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">colors</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
                <span class="n">nc</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">colors</span><span class="p">)</span>
                <span class="n">clr</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="n">idx</span><span class="o">%</span><span class="n">nc</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;&quot;colors&quot; should be a list of, or one, Python supported color code (a string of hex code or a tuple of rgba values)&#39;</span><span class="p">)</span>

            <span class="n">bottom</span> <span class="o">-=</span> <span class="n">height</span><span class="o">*</span><span class="n">v_shift_factor</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="n">left</span><span class="p">,</span> <span class="n">bottom</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">])</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">ts</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">clr</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="n">linewidth</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">patch</span><span class="o">.</span><span class="n">set_alpha</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xlim</span><span class="p">)</span>
            <span class="n">time_label</span><span class="p">,</span> <span class="n">value_label</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">make_labels</span><span class="p">()</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">value_label</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>

            <span class="n">mu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
            <span class="n">std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
            <span class="n">ylim</span> <span class="o">=</span> <span class="p">[</span><span class="n">mu</span><span class="o">-</span><span class="mi">4</span><span class="o">*</span><span class="n">std</span><span class="p">,</span> <span class="n">mu</span><span class="o">+</span><span class="mi">4</span><span class="o">*</span><span class="n">std</span><span class="p">]</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">ts</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">y2</span><span class="o">=</span><span class="n">mu</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">fill_between_alpha</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">clr</span><span class="p">)</span>
            <span class="n">trans</span> <span class="o">=</span> <span class="n">transforms</span><span class="o">.</span><span class="n">blended_transform_factory</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">ax</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">transData</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ts</span><span class="o">.</span><span class="n">label</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">ax</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">label_x_loc</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">ts</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">trans</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">clr</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ylim</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">ylim</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">FormatStrFormatter</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%.1f</span><span class="s1">&#39;</span><span class="p">))</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">idx</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">ax</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;left&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">ax</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;left&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="n">spine_lw</span><span class="p">)</span>
                <span class="n">ax</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;left&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">clr</span><span class="p">)</span>
                <span class="n">ax</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">ax</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_label_position</span><span class="p">(</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
                <span class="n">ax</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">tick_left</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ax</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;left&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">ax</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">ax</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="n">spine_lw</span><span class="p">)</span>
                <span class="n">ax</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">clr</span><span class="p">)</span>
                <span class="n">ax</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_label_position</span><span class="p">(</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>
                <span class="n">ax</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">tick_right</span><span class="p">()</span>

            <span class="n">ax</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">clr</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">clr</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;bottom&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([])</span>
            <span class="n">xt</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">get_xticks</span><span class="p">()[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xt</span><span class="p">:</span>
                <span class="n">ax</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;lightgray&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="n">grid_lw</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">mu</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;lightgray&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="n">grid_lw</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">bottom</span> <span class="o">-=</span> <span class="n">height</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">v_shift_factor</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">n_ts</span><span class="p">]</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="n">left</span><span class="p">,</span> <span class="n">bottom</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">n_ts</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">time_label</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">n_ts</span><span class="p">]</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;left&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">n_ts</span><span class="p">]</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">n_ts</span><span class="p">]</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;bottom&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">n_ts</span><span class="p">]</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;bottom&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="n">spine_lw</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">n_ts</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">n_ts</span><span class="p">]</span><span class="o">.</span><span class="n">patch</span><span class="o">.</span><span class="n">set_alpha</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">n_ts</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xlim</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">n_ts</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">n_ts</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mf">3.5</span><span class="p">)</span>
        <span class="n">xt</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="n">n_ts</span><span class="p">]</span><span class="o">.</span><span class="n">get_xticks</span><span class="p">()[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xt</span><span class="p">:</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">n_ts</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;lightgray&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="n">grid_lw</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;path&#39;</span> <span class="ow">in</span> <span class="n">savefig_settings</span><span class="p">:</span>
            <span class="n">plotting</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">settings</span><span class="o">=</span><span class="n">savefig_settings</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plotting</span><span class="o">.</span><span class="n">showfig</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>

        <span class="c1"># reset the plotting style</span>
        <span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">current_style</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span></div></div>


<div class="viewcode-block" id="SurrogateSeries"><a class="viewcode-back" href="../../../core/ui.html#pyleoclim.core.ui.SurrogateSeries">[docs]</a><span class="k">class</span> <span class="nc">SurrogateSeries</span><span class="p">(</span><span class="n">MultipleSeries</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Object containing surrogate timeseries, usually obtained through recursive modeling (e.g., AR1)</span>

<span class="sd">    Surrogate Series is a child of MultipleSeries. All methods available for MultipleSeries are available for surrogate series.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">series_list</span><span class="p">,</span> <span class="n">surrogate_method</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">surrogate_args</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">series_list</span> <span class="o">=</span> <span class="n">series_list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">surrogate_method</span> <span class="o">=</span> <span class="n">surrogate_method</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">surrogate_args</span> <span class="o">=</span> <span class="n">surrogate_args</span></div>

<div class="viewcode-block" id="EnsembleSeries"><a class="viewcode-back" href="../../../core/ui.html#pyleoclim.core.ui.EnsembleSeries">[docs]</a><span class="k">class</span> <span class="nc">EnsembleSeries</span><span class="p">(</span><span class="n">MultipleSeries</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; EnsembleSeries object</span>

<span class="sd">    The EnsembleSeries object is a child of the MultipleSeries object, that is, a special case of MultipleSeries, aiming for ensembles of similar series.</span>
<span class="sd">    Ensembles usually arise from age modeling or Bayesian calibrations. All members of an EnsembleSeries object are assumed to share identical labels and units.</span>

<span class="sd">    All methods available for MultipleSeries are available for EnsembleSeries. Some functions were modified for the special case of ensembles.</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">series_list</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">series_list</span> <span class="o">=</span> <span class="n">series_list</span>

<div class="viewcode-block" id="EnsembleSeries.make_labels"><a class="viewcode-back" href="../../../core/ui.html#pyleoclim.core.ui.EnsembleSeries.make_labels">[docs]</a>    <span class="k">def</span> <span class="nf">make_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Initialization of labels</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        time_header : str</span>
<span class="sd">            Label for the time axis</span>
<span class="sd">        value_header : str</span>
<span class="sd">            Label for the value axis</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">ts_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">series_list</span>

        <span class="k">if</span> <span class="n">ts_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">time_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">time_name_str</span> <span class="o">=</span> <span class="n">ts_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">time_name</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">time_name_str</span> <span class="o">=</span> <span class="s1">&#39;time&#39;</span>

        <span class="k">if</span> <span class="n">ts_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">value_name_str</span> <span class="o">=</span> <span class="n">ts_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value_name</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">value_name_str</span> <span class="o">=</span> <span class="s1">&#39;value&#39;</span>

        <span class="k">if</span> <span class="n">ts_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value_unit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">value_header</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">value_name_str</span><span class="si">}</span><span class="s1"> [</span><span class="si">{</span><span class="n">ts_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value_unit</span><span class="si">}</span><span class="s1">]&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">value_header</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">value_name_str</span><span class="si">}</span><span class="s1">&#39;</span>

        <span class="k">if</span> <span class="n">ts_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">time_unit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">time_header</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">time_name_str</span><span class="si">}</span><span class="s1"> [</span><span class="si">{</span><span class="n">ts_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">time_unit</span><span class="si">}</span><span class="s1">]&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">time_header</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">time_name_str</span><span class="si">}</span><span class="s1">&#39;</span>

        <span class="k">return</span> <span class="n">time_header</span><span class="p">,</span> <span class="n">value_header</span></div>

<div class="viewcode-block" id="EnsembleSeries.quantiles"><a class="viewcode-back" href="../../../core/ui.html#pyleoclim.core.ui.EnsembleSeries.quantiles">[docs]</a>    <span class="k">def</span> <span class="nf">quantiles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qs</span><span class="o">=</span><span class="p">[</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">]):</span>
        <span class="sd">&#39;&#39;&#39;Calculate quantiles of an EnsembleSeries object</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        qs : list, optional</span>
<span class="sd">            List of quantiles to consider for the calculation. The default is [0.05, 0.5, 0.95].</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ens_qs : pyleoclim.EnsembleSeries</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">time</span><span class="p">)</span>
        <span class="n">vals</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ts</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">series_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">time</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Time axis not consistent across the ensemble!&#39;</span><span class="p">)</span>

            <span class="n">vals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

        <span class="n">vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span>
        <span class="n">ens_qs</span> <span class="o">=</span> <span class="n">mquantiles</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span> <span class="n">qs</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="n">ts_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">quant</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ens_qs</span><span class="p">):</span>
            <span class="n">ts</span> <span class="o">=</span> <span class="n">Series</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">quant</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">qs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="mi">100</span><span class="si">:</span><span class="s1">g</span><span class="si">}</span><span class="s1">%&#39;</span><span class="p">)</span>
            <span class="n">ts_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span>

        <span class="n">ens_qs</span> <span class="o">=</span> <span class="n">EnsembleSeries</span><span class="p">(</span><span class="n">series_list</span><span class="o">=</span><span class="n">ts_list</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ens_qs</span></div>

<div class="viewcode-block" id="EnsembleSeries.correlation"><a class="viewcode-back" href="../../../core/ui.html#pyleoclim.core.ui.EnsembleSeries.correlation">[docs]</a>    <span class="k">def</span> <span class="nf">correlation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">timespan</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">settings</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fdr_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">common_time_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mute_pbar</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Calculate the correlation between an EnsembleSeries object to a target.</span>

<span class="sd">        If the target is not specified, then the 1st member of the ensemble will be the target</span>
<span class="sd">        Note that the FDR approach is applied by default to determine the significance of the p-values (more information in See Also below).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        target : pyleoclim.Series or pyleoclim.EnsembleSeries, optional</span>
<span class="sd">            A pyleoclim Series object or EnsembleSeries object.</span>
<span class="sd">            When the target is also an EnsembleSeries object, then the calculation of correlation is performed in a one-to-one sense,</span>
<span class="sd">            and the ourput list of correlation values and p-values will be the size of the series_list of the self object.</span>
<span class="sd">            That is, if the self object contains n Series, and the target contains n+m Series,</span>
<span class="sd">            then only the first n Series from the object will be used for the calculation;</span>
<span class="sd">            otherwise, if the target contains only n-m Series, then the first m Series in the target will be used twice in sequence.</span>

<span class="sd">        timespan : tuple</span>
<span class="sd">            The time interval over which to perform the calculation</span>

<span class="sd">        alpha : float</span>
<span class="sd">            The significance level (0.05 by default)</span>

<span class="sd">        settings : dict</span>
<span class="sd">            Parameters for the correlation function, including:</span>

<span class="sd">            nsim : int</span>
<span class="sd">                the number of simulations (default: 1000)</span>
<span class="sd">            method : str, {&#39;ttest&#39;,&#39;isopersistent&#39;,&#39;isospectral&#39; (default)}</span>
<span class="sd">                method for significance testing</span>

<span class="sd">        fdr_kwargs : dict</span>
<span class="sd">            Parameters for the FDR function</span>

<span class="sd">        common_time_kwargs : dict</span>
<span class="sd">            Parameters for the method MultipleSeries.common_time()</span>

<span class="sd">        mute_pbar : bool</span>
<span class="sd">            If True, the progressbar will be muted. Default is False.</span>

<span class="sd">        seed : float or int</span>
<span class="sd">            random seed for isopersistent and isospectral methods</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        res : dict</span>
<span class="sd">            Containing a list of the Pearson&#39;s correlation coefficient, associated significance and p-value.</span>

<span class="sd">        See also</span>
<span class="sd">        --------</span>

<span class="sd">        pyleoclim.utils.correlation.corr_sig : Correlation function</span>
<span class="sd">        pyleoclim.utils.correlation.fdr : FDR function</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        .. ipython:: python</span>
<span class="sd">            :okwarning:</span>

<span class="sd">            import pyleoclim as pyleo</span>
<span class="sd">            from pyleoclim.utils.tsmodel import colored_noise</span>

<span class="sd">            nt = 100</span>
<span class="sd">            t0 = np.arange(nt)</span>
<span class="sd">            v0 = colored_noise(alpha=1, t=t0)</span>
<span class="sd">            noise = np.random.normal(loc=0, scale=1, size=nt)</span>

<span class="sd">            ts0 = pyleo.Series(time=t0, value=v0)</span>
<span class="sd">            ts1 = pyleo.Series(time=t0, value=v0+noise)</span>
<span class="sd">            ts2 = pyleo.Series(time=t0, value=v0+2*noise)</span>
<span class="sd">            ts3 = pyleo.Series(time=t0, value=v0+1/2*noise)</span>

<span class="sd">            ts_list1 = [ts0, ts1]</span>
<span class="sd">            ts_list2 = [ts2, ts3]</span>

<span class="sd">            ts_ens = pyleo.EnsembleSeries(ts_list1)</span>
<span class="sd">            ts_target = pyleo.EnsembleSeries(ts_list2)</span>

<span class="sd">            # set an arbitrary randome seed to fix the result</span>
<span class="sd">            corr_res = ts_ens.correlation(ts_target, seed=2333)</span>
<span class="sd">            print(corr_res)</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">target</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">series_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">r_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">p_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">signif_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">ts1</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series_list</span><span class="p">),</span> <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series_list</span><span class="p">),</span> <span class="n">disable</span><span class="o">=</span><span class="n">mute_pbar</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="s1">&#39;series_list&#39;</span><span class="p">):</span>
                <span class="n">nEns</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">series_list</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">idx</span> <span class="o">&lt;</span> <span class="n">nEns</span><span class="p">:</span>
                    <span class="n">value2</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">series_list</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
                    <span class="n">time2</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">series_list</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">time</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">value2</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">series_list</span><span class="p">[</span><span class="n">idx</span><span class="o">-</span><span class="n">nEns</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
                    <span class="n">time2</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">series_list</span><span class="p">[</span><span class="n">idx</span><span class="o">-</span><span class="n">nEns</span><span class="p">]</span><span class="o">.</span><span class="n">time</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">value2</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">value</span>
                <span class="n">time2</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">time</span>

            <span class="n">ts2</span> <span class="o">=</span> <span class="n">Series</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">time2</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">value2</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">idx</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">corr_res</span> <span class="o">=</span> <span class="n">ts1</span><span class="o">.</span><span class="n">correlation</span><span class="p">(</span><span class="n">ts2</span><span class="p">,</span> <span class="n">timespan</span><span class="o">=</span><span class="n">timespan</span><span class="p">,</span> <span class="n">settings</span><span class="o">=</span><span class="n">settings</span><span class="p">,</span> <span class="n">common_time_kwargs</span><span class="o">=</span><span class="n">common_time_kwargs</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>
            <span class="n">r_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">corr_res</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">])</span>
            <span class="n">signif_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">corr_res</span><span class="p">[</span><span class="s1">&#39;signif&#39;</span><span class="p">])</span>
            <span class="n">p_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">corr_res</span><span class="p">[</span><span class="s1">&#39;p&#39;</span><span class="p">])</span>

        <span class="n">r_lsit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">r_list</span><span class="p">)</span>
        <span class="n">p_lsit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">p_list</span><span class="p">)</span>

        <span class="n">signif_fdr_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">fdr_kwargs</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">fdr_kwargs</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">fdr_kwargs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">args</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">fdr_kwargs</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">signif_list</span><span class="p">)):</span>
            <span class="n">signif_fdr_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">fdr_res</span> <span class="o">=</span> <span class="n">corrutils</span><span class="o">.</span><span class="n">fdr</span><span class="p">(</span><span class="n">p_list</span><span class="p">,</span> <span class="o">**</span><span class="n">fdr_kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">fdr_res</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">fdr_res</span><span class="p">:</span>
                <span class="n">signif_fdr_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">corr_ens</span> <span class="o">=</span> <span class="n">CorrEns</span><span class="p">(</span><span class="n">r_list</span><span class="p">,</span> <span class="n">p_list</span><span class="p">,</span> <span class="n">signif_list</span><span class="p">,</span> <span class="n">signif_fdr_list</span><span class="p">,</span> <span class="n">alpha</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">corr_ens</span></div>

<div class="viewcode-block" id="EnsembleSeries.plot_traces"><a class="viewcode-back" href="../../../core/ui.html#pyleoclim.core.ui.EnsembleSeries.plot_traces">[docs]</a>    <span class="k">def</span> <span class="nf">plot_traces</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="n">xlabel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">num_traces</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">xlim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">savefig_settings</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">plot_legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
             <span class="n">color</span><span class="o">=</span><span class="n">sns</span><span class="o">.</span><span class="n">xkcd_rgb</span><span class="p">[</span><span class="s1">&#39;pale red&#39;</span><span class="p">],</span> <span class="n">lw</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">lgd_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mute</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
            <span class="sd">&#39;&#39;&#39;Plot EnsembleSeries as a subset of traces.</span>

<span class="sd">            Parameters</span>
<span class="sd">            ----------</span>
<span class="sd">            figsize : list, optional</span>
<span class="sd">                The figure size. The default is [10, 4].</span>
<span class="sd">            xlabel : str, optional</span>
<span class="sd">                x-axis label. The default is None.</span>
<span class="sd">            ylabel : str, optional</span>
<span class="sd">                y-axis label. The default is None.</span>
<span class="sd">            title : str, optional</span>
<span class="sd">                Plot title. The default is None.</span>
<span class="sd">            xlim : list, optional</span>
<span class="sd">                x-axis limits. The default is None.</span>
<span class="sd">            ylim : list, optional</span>
<span class="sd">                y-axis limits. The default is None.</span>
<span class="sd">            color : str, optional</span>
<span class="sd">                Color of the traces. The default is sns.xkcd_rgb[&#39;pale red&#39;].</span>
<span class="sd">            alpha : float, optional</span>
<span class="sd">                Transparency of the lines representing the multiple members. The default is 0.3.</span>
<span class="sd">            lw : float, optional</span>
<span class="sd">                Width of the lines representing the multiple members. The default is 0.5.</span>
<span class="sd">            num_traces : int, optional</span>
<span class="sd">                Number of traces to plot. The default is 10.</span>
<span class="sd">            savefig_settings : dict, optional</span>
<span class="sd">                the dictionary of arguments for plt.savefig(); some notes below:</span>
<span class="sd">                - &quot;path&quot; must be specified; it can be any existed or non-existed path,</span>
<span class="sd">                  with or without a suffix; if the suffix is not given in &quot;path&quot;, it will follow &quot;format&quot;</span>
<span class="sd">                - &quot;format&quot; can be one of {&quot;pdf&quot;, &quot;eps&quot;, &quot;png&quot;, &quot;ps&quot;} The default is None.</span>
<span class="sd">            ax : matplotlib.ax, optional</span>
<span class="sd">                Matplotlib axis on which to return the plot. The default is None.</span>
<span class="sd">            plot_legend : bool, optional</span>
<span class="sd">                Whether to plot the legend. The default is True.</span>
<span class="sd">            lgd_kwargs : dict, optional</span>
<span class="sd">                Parameters for the legend. The default is None.</span>
<span class="sd">            mute : bool, optional</span>
<span class="sd">                if True, the plot will not show;</span>
<span class="sd">                recommend to turn on when more modifications are going to be made on ax. The default is False.</span>
<span class="sd">            seed : int, optional</span>
<span class="sd">                Set the seed for the random number generator. Useful for reproducibility. The default is None.</span>

<span class="sd">            Returns</span>
<span class="sd">            -------</span>
<span class="sd">            fig, ax</span>
<span class="sd">            </span>
<span class="sd">            Examples</span>
<span class="sd">            --------</span>

<span class="sd">            .. ipython:: python</span>
<span class="sd">                :okwarning:</span>
<span class="sd">                </span>
<span class="sd">                nn = 30 # number of noise realizations</span>
<span class="sd">                nt = 500</span>
<span class="sd">                series_list = []</span>
<span class="sd">        </span>
<span class="sd">                signal = pyleo.gen_ts(model=&#39;colored_noise&#39;,nt=nt,alpha=1.0).standardize() </span>
<span class="sd">                noise = np.random.randn(nt,nn)</span>
<span class="sd">        </span>
<span class="sd">                for idx in range(nn):  # noise</span>
<span class="sd">                    ts = pyleo.Series(time=signal.time, value=signal.value+noise[:,idx])</span>
<span class="sd">                    series_list.append(ts)</span>
<span class="sd">        </span>
<span class="sd">                ts_ens = pyleo.EnsembleSeries(series_list)</span>
<span class="sd">        </span>
<span class="sd">                fig, ax = ts_ens.plot_traces(alpha=0.2,num_traces=8) </span>

<span class="sd">            &#39;&#39;&#39;</span>
            <span class="c1"># Turn the interactive mode off.</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ioff</span><span class="p">()</span>

            <span class="n">savefig_settings</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">savefig_settings</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">savefig_settings</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">lgd_kwargs</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">lgd_kwargs</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">lgd_kwargs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

            <span class="c1"># generate default axis labels</span>
            <span class="n">time_label</span><span class="p">,</span> <span class="n">value_label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_labels</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">xlabel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">xlabel</span> <span class="o">=</span> <span class="n">time_label</span>

            <span class="k">if</span> <span class="n">ylabel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">ylabel</span> <span class="o">=</span> <span class="n">value_label</span>

            <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">num_traces</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">seed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>

                <span class="n">nts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series_list</span><span class="p">)</span>
                <span class="n">random_draw_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">nts</span><span class="p">,</span> <span class="n">num_traces</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">random_draw_idx</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">series_list</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="n">xlabel</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="n">ylabel</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">99</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="n">lw</span><span class="p">,</span>
                        <span class="n">xlim</span><span class="o">=</span><span class="n">xlim</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="n">ylim</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;example members (n=</span><span class="si">{</span><span class="n">num_traces</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">plot_legend</span><span class="p">:</span>
                <span class="n">lgd_args</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;frameon&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>
                <span class="n">lgd_args</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">lgd_kwargs</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="o">**</span><span class="n">lgd_args</span><span class="p">)</span>

            <span class="k">if</span> <span class="s1">&#39;fig&#39;</span> <span class="ow">in</span> <span class="nb">locals</span><span class="p">():</span>
                <span class="k">if</span> <span class="s1">&#39;path&#39;</span> <span class="ow">in</span> <span class="n">savefig_settings</span><span class="p">:</span>
                    <span class="n">plotting</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">settings</span><span class="o">=</span><span class="n">savefig_settings</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">mute</span><span class="p">:</span>
                        <span class="n">plotting</span><span class="o">.</span><span class="n">showfig</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">ax</span></div>

<div class="viewcode-block" id="EnsembleSeries.plot_envelope"><a class="viewcode-back" href="../../../core/ui.html#pyleoclim.core.ui.EnsembleSeries.plot_envelope">[docs]</a>    <span class="k">def</span> <span class="nf">plot_envelope</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="n">qs</span><span class="o">=</span><span class="p">[</span><span class="mf">0.025</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">,</span> <span class="mf">0.975</span><span class="p">],</span>
                      <span class="n">xlabel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                      <span class="n">xlim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">savefig_settings</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">plot_legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                      <span class="n">curve_clr</span><span class="o">=</span><span class="n">sns</span><span class="o">.</span><span class="n">xkcd_rgb</span><span class="p">[</span><span class="s1">&#39;pale red&#39;</span><span class="p">],</span> <span class="n">curve_lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">shade_clr</span><span class="o">=</span><span class="n">sns</span><span class="o">.</span><span class="n">xkcd_rgb</span><span class="p">[</span><span class="s1">&#39;pale red&#39;</span><span class="p">],</span> <span class="n">shade_alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
                      <span class="n">inner_shade_label</span><span class="o">=</span><span class="s1">&#39;IQR&#39;</span><span class="p">,</span> <span class="n">outer_shade_label</span><span class="o">=</span><span class="s1">&#39;95% CI&#39;</span><span class="p">,</span> <span class="n">lgd_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mute</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Plot EnsembleSeries as an envelope.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        figsize : list, optional</span>
<span class="sd">            The figure size. The default is [10, 4].</span>
<span class="sd">        qs : list, optional</span>
<span class="sd">            The significance levels to consider. The default is [0.025, 0.25, 0.5, 0.75, 0.975] (median, interquartile range, and central 95% region)</span>
<span class="sd">        xlabel : str, optional</span>
<span class="sd">            x-axis label. The default is None.</span>
<span class="sd">        ylabel : str, optional</span>
<span class="sd">            y-axis label. The default is None.</span>
<span class="sd">        title : str, optional</span>
<span class="sd">            Plot title. The default is None.</span>
<span class="sd">        xlim : list, optional</span>
<span class="sd">            x-axis limits. The default is None.</span>
<span class="sd">        ylim : list, optional</span>
<span class="sd">            y-axis limits. The default is None.</span>
<span class="sd">        savefig_settings : dict, optional</span>
<span class="sd">            the dictionary of arguments for plt.savefig(); some notes below:</span>
<span class="sd">            - &quot;path&quot; must be specified; it can be any existed or non-existed path,</span>
<span class="sd">              with or without a suffix; if the suffix is not given in &quot;path&quot;, it will follow &quot;format&quot;</span>
<span class="sd">            - &quot;format&quot; can be one of {&quot;pdf&quot;, &quot;eps&quot;, &quot;png&quot;, &quot;ps&quot;} The default is None.</span>
<span class="sd">        ax : matplotlib.ax, optional</span>
<span class="sd">            Matplotlib axis on which to return the plot. The default is None.</span>
<span class="sd">        plot_legend : bool, optional</span>
<span class="sd">            Wether to plot the legend. The default is True.</span>
<span class="sd">        curve_clr : str, optional</span>
<span class="sd">            Color of the main line (median). The default is sns.xkcd_rgb[&#39;pale red&#39;].</span>
<span class="sd">        curve_lw : str, optional</span>
<span class="sd">            Width of the main line (median). The default is 2.</span>
<span class="sd">        shade_clr : str, optional</span>
<span class="sd">            Color of the shaded envelope. The default is sns.xkcd_rgb[&#39;pale red&#39;].</span>
<span class="sd">        shade_alpha : float, optional</span>
<span class="sd">            Transparency on the envelope. The default is 0.2.</span>
<span class="sd">        inner_shade_label : str, optional</span>
<span class="sd">            Label for the envelope. The default is &#39;IQR&#39;.</span>
<span class="sd">        outer_shade_label : str, optional</span>
<span class="sd">            Label for the envelope. The default is &#39;95\% CI&#39;.</span>
<span class="sd">        lgd_kwargs : dict, optional</span>
<span class="sd">            Parameters for the legend. The default is None.</span>
<span class="sd">        mute : bool, optional</span>
<span class="sd">            if True, the plot will not show;</span>
<span class="sd">            recommend to turn on when more modifications are going to be made on ax. The default is False.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        fig, ax</span>
<span class="sd">        </span>
<span class="sd">        Example</span>
<span class="sd">        --------</span>
<span class="sd">        .. ipython:: python</span>
<span class="sd">            :okwarning:</span>
<span class="sd">            </span>
<span class="sd">            nn = 30 # number of noise realizations</span>
<span class="sd">            nt = 500</span>
<span class="sd">            series_list = []</span>
<span class="sd">    </span>
<span class="sd">            signal = pyleo.gen_ts(model=&#39;colored_noise&#39;,nt=nt,alpha=1.0).standardize() </span>
<span class="sd">            noise = np.random.randn(nt,nn)</span>
<span class="sd">    </span>
<span class="sd">            for idx in range(nn):  # noise</span>
<span class="sd">                ts = pyleo.Series(time=signal.time, value=signal.value+noise[:,idx])</span>
<span class="sd">                series_list.append(ts)</span>
<span class="sd">    </span>
<span class="sd">            ts_ens = pyleo.EnsembleSeries(series_list)  </span>
<span class="sd">            fig, ax = ts_ens.plot_envelope(curve_lw=1.5) </span>
<span class="sd"> </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># Turn the interactive mode off.</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ioff</span><span class="p">()</span>

        <span class="n">savefig_settings</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">savefig_settings</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">savefig_settings</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">lgd_kwargs</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">lgd_kwargs</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">lgd_kwargs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="c1"># generate default axis labels</span>
        <span class="n">time_label</span><span class="p">,</span> <span class="n">value_label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_labels</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">xlabel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">xlabel</span> <span class="o">=</span> <span class="n">time_label</span>

        <span class="k">if</span> <span class="n">ylabel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ylabel</span> <span class="o">=</span> <span class="n">value_label</span>

        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>

        <span class="n">ts_qs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">quantiles</span><span class="p">(</span><span class="n">qs</span><span class="o">=</span><span class="n">qs</span><span class="p">)</span>


        <span class="k">if</span> <span class="n">inner_shade_label</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">inner_shade_label</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">ts_qs</span><span class="o">.</span><span class="n">series_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">label</span><span class="si">}</span><span class="s1">-</span><span class="si">{</span><span class="n">ts_qs</span><span class="o">.</span><span class="n">series_list</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">label</span><span class="si">}</span><span class="s1">&#39;</span>

        <span class="k">if</span> <span class="n">outer_shade_label</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">outer_shade_label</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">ts_qs</span><span class="o">.</span><span class="n">series_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">label</span><span class="si">}</span><span class="s1">-</span><span class="si">{</span><span class="n">ts_qs</span><span class="o">.</span><span class="n">series_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">label</span><span class="si">}</span><span class="s1">&#39;</span>

        <span class="n">time</span> <span class="o">=</span> <span class="n">ts_qs</span><span class="o">.</span><span class="n">series_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">time</span>
        <span class="c1"># plot outer envelope</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span>
            <span class="n">time</span><span class="p">,</span> <span class="n">ts_qs</span><span class="o">.</span><span class="n">series_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">ts_qs</span><span class="o">.</span><span class="n">series_list</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="n">shade_clr</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">shade_alpha</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="n">shade_clr</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">outer_shade_label</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="c1"># plot inner envelope on top</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span>
            <span class="n">time</span><span class="p">,</span> <span class="n">ts_qs</span><span class="o">.</span><span class="n">series_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">ts_qs</span><span class="o">.</span><span class="n">series_list</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="n">shade_clr</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">shade_alpha</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="n">shade_clr</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">inner_shade_label</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># plot the median</span>
        <span class="n">ts_qs</span><span class="o">.</span><span class="n">series_list</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="n">xlabel</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="n">ylabel</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="n">curve_lw</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">curve_clr</span><span class="p">,</span>
            <span class="n">xlim</span><span class="o">=</span><span class="n">xlim</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="n">ylim</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>  <span class="n">zorder</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;median&#39;</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">plot_legend</span><span class="p">:</span>
            <span class="n">lgd_args</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;frameon&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>
            <span class="n">lgd_args</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">lgd_kwargs</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="o">**</span><span class="n">lgd_args</span><span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;fig&#39;</span> <span class="ow">in</span> <span class="nb">locals</span><span class="p">():</span>
            <span class="k">if</span> <span class="s1">&#39;path&#39;</span> <span class="ow">in</span> <span class="n">savefig_settings</span><span class="p">:</span>
                <span class="n">plotting</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">settings</span><span class="o">=</span><span class="n">savefig_settings</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">mute</span><span class="p">:</span>
                    <span class="n">plotting</span><span class="o">.</span><span class="n">showfig</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ax</span></div>


<div class="viewcode-block" id="EnsembleSeries.stackplot"><a class="viewcode-back" href="../../../core/ui.html#pyleoclim.core.ui.EnsembleSeries.stackplot">[docs]</a>    <span class="k">def</span> <span class="nf">stackplot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">15</span><span class="p">],</span> <span class="n">savefig_settings</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  <span class="n">xlim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fill_between_alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;tab10&#39;</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">spine_lw</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">grid_lw</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">font_scale</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">label_x_loc</span><span class="o">=-</span><span class="mf">0.15</span><span class="p">,</span> <span class="n">v_shift_factor</span><span class="o">=</span><span class="mi">3</span><span class="o">/</span><span class="mi">4</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Stack plot of multiple series</span>

<span class="sd">        Note that the plotting style is uniquely designed for this one and cannot be properly reset with `pyleoclim.set_style()`.</span>
<span class="sd">                Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        figsize : list</span>
<span class="sd">            Size of the figure.</span>
<span class="sd">        colors : a list of, or one, Python supported color code (a string of hex code or a tuple of rgba values)</span>
<span class="sd">            Colors for plotting.</span>
<span class="sd">            If None, the plotting will cycle the &#39;tab10&#39; colormap;</span>
<span class="sd">            if only one color is specified, then all curves will be plotted with that single color;</span>
<span class="sd">            if a list of colors are specified, then the plotting will cycle that color list.</span>
<span class="sd">        cmap : str</span>
<span class="sd">            The colormap to use when &quot;colors&quot; is None.</span>
<span class="sd">        norm : matplotlib.colors.Normalize like</span>
<span class="sd">            The nomorlization for the colormap.</span>
<span class="sd">            If None, a linear normalization will be used.</span>
<span class="sd">        savefig_settings : dictionary</span>
<span class="sd">            the dictionary of arguments for plt.savefig(); some notes below:</span>
<span class="sd">            - &quot;path&quot; must be specified; it can be any existed or non-existed path,</span>
<span class="sd">              with or without a suffix; if the suffix is not given in &quot;path&quot;, it will follow &quot;format&quot;</span>
<span class="sd">            - &quot;format&quot; can be one of {&quot;pdf&quot;, &quot;eps&quot;, &quot;png&quot;, &quot;ps&quot;} The default is None.</span>
<span class="sd">        xlim : list</span>
<span class="sd">            The x-axis limit.</span>
<span class="sd">        fill_between_alpha : float</span>
<span class="sd">            The transparency for the fill_between shades.</span>
<span class="sd">        spine_lw : float</span>
<span class="sd">            The linewidth for the spines of the axes.</span>
<span class="sd">        grid_lw : float</span>
<span class="sd">            The linewidth for the gridlines.</span>
<span class="sd">        linewidth : float</span>
<span class="sd">            The linewidth for the curves.</span>
<span class="sd">        font_scale : float</span>
<span class="sd">            The scale for the font sizes. Default is 0.8.</span>
<span class="sd">        label_x_loc : float</span>
<span class="sd">            The x location for the label of each curve.</span>
<span class="sd">        v_shift_factor : float</span>
<span class="sd">            The factor for the vertical shift of each axis.</span>
<span class="sd">            The default value 3/4 means the top of the next axis will be located at 3/4 of the height of the previous one.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        fig, ax</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ioff</span><span class="p">()</span>
        <span class="n">current_style</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">)</span>
        <span class="n">plotting</span><span class="o">.</span><span class="n">set_style</span><span class="p">(</span><span class="s1">&#39;journal&#39;</span><span class="p">,</span> <span class="n">font_scale</span><span class="o">=</span><span class="n">font_scale</span><span class="p">)</span>
        <span class="n">savefig_settings</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">savefig_settings</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">savefig_settings</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="n">n_ts</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series_list</span><span class="p">)</span>

        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">xlim</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">time_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
            <span class="n">time_max</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
            <span class="k">for</span> <span class="n">ts</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">series_list</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">time</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">time_min</span><span class="p">:</span>
                    <span class="n">time_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">time</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">time</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">time_max</span><span class="p">:</span>
                    <span class="n">time_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">time</span><span class="p">)</span>
            <span class="n">xlim</span> <span class="o">=</span> <span class="p">[</span><span class="n">time_min</span><span class="p">,</span> <span class="n">time_max</span><span class="p">]</span>

        <span class="n">ax</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">left</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">width</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">height</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">n_ts</span>
        <span class="n">bottom</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">ts</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series_list</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">colors</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">cmap_obj</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="n">cmap</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">cmap_obj</span><span class="p">,</span> <span class="s1">&#39;colors&#39;</span><span class="p">):</span>
                    <span class="n">nc</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cmap_obj</span><span class="o">.</span><span class="n">colors</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">nc</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">series_list</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">norm</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">norm</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">nc</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

                <span class="n">clr</span> <span class="o">=</span> <span class="n">cmap_obj</span><span class="p">(</span><span class="n">norm</span><span class="p">(</span><span class="n">idx</span><span class="o">%</span><span class="n">nc</span><span class="p">))</span>
            <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">colors</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
                <span class="n">clr</span> <span class="o">=</span> <span class="n">colors</span>
            <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">colors</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
                <span class="n">nc</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">colors</span><span class="p">)</span>
                <span class="n">clr</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="n">idx</span><span class="o">%</span><span class="n">nc</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;&quot;colors&quot; should be a list of, or one, Python supported color code (a string of hex code or a tuple of rgba values)&#39;</span><span class="p">)</span>

            <span class="n">bottom</span> <span class="o">-=</span> <span class="n">height</span><span class="o">*</span><span class="n">v_shift_factor</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="n">left</span><span class="p">,</span> <span class="n">bottom</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">])</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">ts</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">clr</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="n">linewidth</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">patch</span><span class="o">.</span><span class="n">set_alpha</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xlim</span><span class="p">)</span>
            <span class="n">time_label</span><span class="p">,</span> <span class="n">value_label</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">make_labels</span><span class="p">()</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">value_label</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>

            <span class="n">mu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
            <span class="n">std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
            <span class="n">ylim</span> <span class="o">=</span> <span class="p">[</span><span class="n">mu</span><span class="o">-</span><span class="mi">4</span><span class="o">*</span><span class="n">std</span><span class="p">,</span> <span class="n">mu</span><span class="o">+</span><span class="mi">4</span><span class="o">*</span><span class="n">std</span><span class="p">]</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">ts</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">y2</span><span class="o">=</span><span class="n">mu</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">fill_between_alpha</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">clr</span><span class="p">)</span>
            <span class="n">trans</span> <span class="o">=</span> <span class="n">transforms</span><span class="o">.</span><span class="n">blended_transform_factory</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">ax</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">transData</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ts</span><span class="o">.</span><span class="n">label</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">ax</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">label_x_loc</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">ts</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">trans</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">clr</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ylim</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">ylim</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">FormatStrFormatter</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%.1f</span><span class="s1">&#39;</span><span class="p">))</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">idx</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">ax</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;left&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">ax</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;left&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="n">spine_lw</span><span class="p">)</span>
                <span class="n">ax</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;left&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">clr</span><span class="p">)</span>
                <span class="n">ax</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">ax</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_label_position</span><span class="p">(</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
                <span class="n">ax</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">tick_left</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ax</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;left&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">ax</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">ax</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="n">spine_lw</span><span class="p">)</span>
                <span class="n">ax</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">clr</span><span class="p">)</span>
                <span class="n">ax</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_label_position</span><span class="p">(</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>
                <span class="n">ax</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">tick_right</span><span class="p">()</span>

            <span class="n">ax</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">clr</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">clr</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;bottom&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([])</span>
            <span class="n">xt</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">get_xticks</span><span class="p">()[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xt</span><span class="p">:</span>
                <span class="n">ax</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;lightgray&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="n">grid_lw</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">mu</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;lightgray&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="n">grid_lw</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">bottom</span> <span class="o">-=</span> <span class="n">height</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">v_shift_factor</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">n_ts</span><span class="p">]</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="n">left</span><span class="p">,</span> <span class="n">bottom</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">n_ts</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">time_label</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">n_ts</span><span class="p">]</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;left&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">n_ts</span><span class="p">]</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">n_ts</span><span class="p">]</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;bottom&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">n_ts</span><span class="p">]</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;bottom&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="n">spine_lw</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">n_ts</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">n_ts</span><span class="p">]</span><span class="o">.</span><span class="n">patch</span><span class="o">.</span><span class="n">set_alpha</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">n_ts</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xlim</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">n_ts</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">n_ts</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mf">3.5</span><span class="p">)</span>
        <span class="n">xt</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="n">n_ts</span><span class="p">]</span><span class="o">.</span><span class="n">get_xticks</span><span class="p">()[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xt</span><span class="p">:</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">n_ts</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;lightgray&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="n">grid_lw</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;path&#39;</span> <span class="ow">in</span> <span class="n">savefig_settings</span><span class="p">:</span>
            <span class="n">plotting</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">settings</span><span class="o">=</span><span class="n">savefig_settings</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plotting</span><span class="o">.</span><span class="n">showfig</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>

        <span class="c1"># reset the plotting style</span>
        <span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">current_style</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span></div></div>

<div class="viewcode-block" id="MultiplePSD"><a class="viewcode-back" href="../../../core/ui.html#pyleoclim.core.ui.MultiplePSD">[docs]</a><span class="k">class</span> <span class="nc">MultiplePSD</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39; Object for multiple PSD.</span>

<span class="sd">    Used for significance level</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">psd_list</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">psd_list</span> <span class="o">=</span> <span class="n">psd_list</span>

<div class="viewcode-block" id="MultiplePSD.copy"><a class="viewcode-back" href="../../../core/ui.html#pyleoclim.core.ui.MultiplePSD.copy">[docs]</a>    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Copy object</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="MultiplePSD.quantiles"><a class="viewcode-back" href="../../../core/ui.html#pyleoclim.core.ui.MultiplePSD.quantiles">[docs]</a>    <span class="k">def</span> <span class="nf">quantiles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qs</span><span class="o">=</span><span class="p">[</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">],</span> <span class="n">lw</span><span class="o">=</span><span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">]):</span>
        <span class="sd">&#39;&#39;&#39;Calculate quantiles</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        qs : list, optional</span>
<span class="sd">            List of quantiles to consider for the calculation. The default is [0.05, 0.5, 0.95].</span>
<span class="sd">        lw : list, optional</span>
<span class="sd">            Linewidth to use for plotting each level. Should be the same length as qs. The default is [0.5, 1.5, 0.5].</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            Frequency axis not consistent across the PSD list!</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        psds : pyleoclim.MultiplePSD</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">psd_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">timeseries</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">period_unit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">psd_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">timeseries</span><span class="o">.</span><span class="n">time_unit</span>

        <span class="n">freq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">psd_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">frequency</span><span class="p">)</span>
        <span class="n">amps</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">psd</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">psd_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="n">psd</span><span class="o">.</span><span class="n">frequency</span><span class="p">,</span> <span class="n">freq</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Frequency axis not consistent across the PSD list!&#39;</span><span class="p">)</span>

            <span class="n">amps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">psd</span><span class="o">.</span><span class="n">amplitude</span><span class="p">)</span>

        <span class="n">amps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">amps</span><span class="p">)</span>
        <span class="n">amp_qs</span> <span class="o">=</span> <span class="n">mquantiles</span><span class="p">(</span><span class="n">amps</span><span class="p">,</span> <span class="n">qs</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="n">psd_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">amp</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">amp_qs</span><span class="p">):</span>
            <span class="n">psd_tmp</span> <span class="o">=</span> <span class="n">PSD</span><span class="p">(</span><span class="n">frequency</span><span class="o">=</span><span class="n">freq</span><span class="p">,</span> <span class="n">amplitude</span><span class="o">=</span><span class="n">amp</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">qs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="mi">100</span><span class="si">:</span><span class="s1">g</span><span class="si">}</span><span class="s1">%&#39;</span><span class="p">,</span> <span class="n">plot_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="s1">&#39;linewidth&#39;</span><span class="p">:</span> <span class="n">lw</span><span class="p">[</span><span class="n">i</span><span class="p">]},</span> <span class="n">period_unit</span><span class="o">=</span><span class="n">period_unit</span><span class="p">)</span>
            <span class="n">psd_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">psd_tmp</span><span class="p">)</span>

        <span class="n">psds</span> <span class="o">=</span> <span class="n">MultiplePSD</span><span class="p">(</span><span class="n">psd_list</span><span class="o">=</span><span class="n">psd_list</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">psds</span></div>

<div class="viewcode-block" id="MultiplePSD.beta_est"><a class="viewcode-back" href="../../../core/ui.html#pyleoclim.core.ui.MultiplePSD.beta_est">[docs]</a>    <span class="k">def</span> <span class="nf">beta_est</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fmin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fmax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">logf_binning_step</span><span class="o">=</span><span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Estimate the scaling factor beta of the each PSD from the psd_list in a log-log space</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        fmin : float</span>
<span class="sd">            the minimum frequency edge for beta estimation; the default is the minimum of the frequency vector of the PSD obj</span>

<span class="sd">        fmax : float</span>
<span class="sd">            the maximum frequency edge for beta estimation; the default is the maximum of the frequency vector of the PSD obj</span>

<span class="sd">        logf_binning_step : str, {&#39;max&#39;, &#39;first&#39;}</span>
<span class="sd">            if &#39;max&#39;, then the maximum spacing of log(f) will be used as the binning step</span>
<span class="sd">            if &#39;first&#39;, then the 1st spacing of log(f) will be used as the binning step</span>

<span class="sd">        verbose : bool</span>
<span class="sd">            If True, will print warning messages if there is any</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        res_dict : dictionary</span>
<span class="sd">            - beta: list of the scaling factors</span>
<span class="sd">            - std_err: list of one standard deviation errors of the scaling factor</span>
<span class="sd">            - f_binned: list of the binned frequency series, used as X for linear regression</span>
<span class="sd">            - psd_binned: list of the binned PSD series, used as Y for linear regression</span>
<span class="sd">            - Y_reg: list of the predicted Y from linear regression, used with f_binned for the slope curve plotting</span>

<span class="sd">        See also</span>
<span class="sd">        --------</span>

<span class="sd">        pyleoclim.core.ui.PSD.beta_est : beta estimation for on a single PSD object</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">res_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">res_dict</span><span class="p">[</span><span class="s1">&#39;beta&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">res_dict</span><span class="p">[</span><span class="s1">&#39;std_err&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">res_dict</span><span class="p">[</span><span class="s1">&#39;f_binned&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">res_dict</span><span class="p">[</span><span class="s1">&#39;psd_binned&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">res_dict</span><span class="p">[</span><span class="s1">&#39;Y_reg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">psd_obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">psd_list</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">psd_obj</span><span class="o">.</span><span class="n">beta_est</span><span class="p">(</span><span class="n">fmin</span><span class="o">=</span><span class="n">fmin</span><span class="p">,</span> <span class="n">fmax</span><span class="o">=</span><span class="n">fmax</span><span class="p">,</span> <span class="n">logf_binning_step</span><span class="o">=</span><span class="n">logf_binning_step</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">res_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">res_dict</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">res_dict</span></div>


<div class="viewcode-block" id="MultiplePSD.plot"><a class="viewcode-back" href="../../../core/ui.html#pyleoclim.core.ui.MultiplePSD.plot">[docs]</a>    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="n">in_loglog</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">in_period</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Amplitude&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">xlim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">savefig_settings</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xticks</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">yticks</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
             <span class="n">colors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">plot_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lgd_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mute</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Plot multiple PSD on the same plot</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        figsize : list, optional</span>
<span class="sd">            Figure size. The default is [10, 4].</span>
<span class="sd">        in_loglog : bool, optional</span>
<span class="sd">            Whether to plot in loglog. The default is True.</span>
<span class="sd">        in_period : bool, optional</span>
<span class="sd">            Plots against periods instead of frequencies. The default is True.</span>
<span class="sd">        xlabel : str, optional</span>
<span class="sd">            x-axis label. The default is None.</span>
<span class="sd">        ylabel : str, optional</span>
<span class="sd">            y-axis label. The default is &#39;Amplitude&#39;.</span>
<span class="sd">        title : str, optional</span>
<span class="sd">            Title for the figure. The default is None.</span>
<span class="sd">        xlim : list, optional</span>
<span class="sd">            Limits for the x-axis. The default is None.</span>
<span class="sd">        ylim : list, optional</span>
<span class="sd">            limits for the y-axis. The default is None.</span>
<span class="sd">        colors : a list of, or one, Python supported color code (a string of hex code or a tuple of rgba values)</span>
<span class="sd">            Colors for plotting.</span>
<span class="sd">            If None, the plotting will cycle the &#39;tab10&#39; colormap;</span>
<span class="sd">            if only one color is specified, then all curves will be plotted with that single color;</span>
<span class="sd">            if a list of colors are specified, then the plotting will cycle that color list.</span>
<span class="sd">        cmap : str</span>
<span class="sd">            The colormap to use when &quot;colors&quot; is None.</span>
<span class="sd">        norm : matplotlib.colors.Normalize like</span>
<span class="sd">            The nomorlization for the colormap.</span>
<span class="sd">            If None, a linear normalization will be used.</span>
<span class="sd">        savefig_settings : dict, optional</span>
<span class="sd">            the dictionary of arguments for plt.savefig(); some notes below:</span>
<span class="sd">            - &quot;path&quot; must be specified; it can be any existed or non-existed path,</span>
<span class="sd">              with or without a suffix; if the suffix is not given in &quot;path&quot;, it will follow &quot;format&quot;</span>
<span class="sd">            - &quot;format&quot; can be one of {&quot;pdf&quot;, &quot;eps&quot;, &quot;png&quot;, &quot;ps&quot;}</span>
<span class="sd">        ax : matplotlib axis, optional</span>
<span class="sd">            The matplotlib axis object on which to retrun the figure. The default is None.</span>
<span class="sd">        xticks : list, optional</span>
<span class="sd">            x-ticks label. The default is None.</span>
<span class="sd">        yticks : list, optional</span>
<span class="sd">            y-ticks label. The default is None.</span>
<span class="sd">        legend : bool, optional</span>
<span class="sd">            Whether to plot the legend. The default is True.</span>
<span class="sd">        plot_kwargs : dictionary, optional</span>
<span class="sd">            Parameters for plot function. The default is None.</span>
<span class="sd">        lgd_kwargs : dictionary, optional</span>
<span class="sd">            Parameters for legend. The default is None.</span>
<span class="sd">        mute : bool, optional</span>
<span class="sd">            if True, the plot will not show;</span>
<span class="sd">            recommend to turn on when more modifications are going to be made on ax</span>
<span class="sd">            The default is False.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        fig, ax</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># Turn the interactive mode off.</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ioff</span><span class="p">()</span>

        <span class="n">savefig_settings</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">savefig_settings</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">savefig_settings</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">plot_kwargs</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">plot_kwargs</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">plot_kwargs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">lgd_kwargs</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">lgd_kwargs</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">lgd_kwargs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">psd</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">psd_list</span><span class="p">):</span>

            <span class="n">tmp_plot_kwargs</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">if</span> <span class="n">psd</span><span class="o">.</span><span class="n">plot_kwargs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">tmp_plot_kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">psd</span><span class="o">.</span><span class="n">plot_kwargs</span><span class="p">)</span>

            <span class="n">tmp_plot_kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">plot_kwargs</span><span class="p">)</span>

            <span class="c1"># get color for each psd curve</span>
            <span class="n">use_clr</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="k">if</span> <span class="s1">&#39;color&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">tmp_plot_kwargs</span> <span class="ow">and</span> <span class="s1">&#39;c&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="s1">&#39;tmp_plot_kwargs&#39;</span><span class="p">:</span>
                <span class="n">use_clr</span> <span class="o">=</span> <span class="kc">True</span>
            
            <span class="k">if</span> <span class="s1">&#39;color&#39;</span> <span class="ow">in</span> <span class="n">tmp_plot_kwargs</span> <span class="ow">and</span> <span class="n">tmp_plot_kwargs</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">use_clr</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="k">if</span> <span class="s1">&#39;c&#39;</span> <span class="ow">in</span> <span class="n">tmp_plot_kwargs</span> <span class="ow">and</span> <span class="n">tmp_plot_kwargs</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">use_clr</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="k">if</span> <span class="n">colors</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">cmap</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">use_clr</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="k">if</span> <span class="n">use_clr</span><span class="p">:</span>
                <span class="c1"># use the color based on the argument &#39;colors&#39; or &#39;cmap&#39;</span>
                <span class="k">if</span> <span class="n">colors</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">cmap</span> <span class="o">=</span> <span class="s1">&#39;tab10&#39;</span> <span class="k">if</span> <span class="n">cmap</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">cmap</span>
                    <span class="n">cmap_obj</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="n">cmap</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">cmap_obj</span><span class="p">,</span> <span class="s1">&#39;colors&#39;</span><span class="p">):</span>
                        <span class="n">nc</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cmap_obj</span><span class="o">.</span><span class="n">colors</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">nc</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">psd_list</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">norm</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">norm</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">nc</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

                    <span class="n">clr</span> <span class="o">=</span> <span class="n">cmap_obj</span><span class="p">(</span><span class="n">norm</span><span class="p">(</span><span class="n">idx</span><span class="o">%</span><span class="n">nc</span><span class="p">))</span>
                <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">colors</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
                    <span class="n">clr</span> <span class="o">=</span> <span class="n">colors</span>
                <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">colors</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
                    <span class="n">nc</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">colors</span><span class="p">)</span>
                    <span class="n">clr</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="n">idx</span><span class="o">%</span><span class="n">nc</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;&quot;colors&quot; should be a list of, or one, Python supported color code (a string of hex code or a tuple of rgba values)&#39;</span><span class="p">)</span>

                <span class="n">tmp_plot_kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="n">clr</span><span class="p">})</span>

            <span class="n">ax</span> <span class="o">=</span> <span class="n">psd</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                <span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">,</span> <span class="n">in_loglog</span><span class="o">=</span><span class="n">in_loglog</span><span class="p">,</span> <span class="n">in_period</span><span class="o">=</span><span class="n">in_period</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="n">xlabel</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="n">ylabel</span><span class="p">,</span>
                <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="n">xlim</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="n">ylim</span><span class="p">,</span> <span class="n">savefig_settings</span><span class="o">=</span><span class="n">savefig_settings</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
                <span class="n">xticks</span><span class="o">=</span><span class="n">xticks</span><span class="p">,</span> <span class="n">yticks</span><span class="o">=</span><span class="n">yticks</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="n">legend</span><span class="p">,</span> <span class="n">plot_kwargs</span><span class="o">=</span><span class="n">tmp_plot_kwargs</span><span class="p">,</span> <span class="n">lgd_kwargs</span><span class="o">=</span><span class="n">lgd_kwargs</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;fig&#39;</span> <span class="ow">in</span> <span class="nb">locals</span><span class="p">():</span>
            <span class="k">if</span> <span class="s1">&#39;path&#39;</span> <span class="ow">in</span> <span class="n">savefig_settings</span><span class="p">:</span>
                <span class="n">plotting</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">settings</span><span class="o">=</span><span class="n">savefig_settings</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">mute</span><span class="p">:</span>
                    <span class="n">plotting</span><span class="o">.</span><span class="n">showfig</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ax</span></div>

<div class="viewcode-block" id="MultiplePSD.plot_envelope"><a class="viewcode-back" href="../../../core/ui.html#pyleoclim.core.ui.MultiplePSD.plot_envelope">[docs]</a>    <span class="k">def</span> <span class="nf">plot_envelope</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="n">qs</span><span class="o">=</span><span class="p">[</span><span class="mf">0.025</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.975</span><span class="p">],</span>
             <span class="n">in_loglog</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">in_period</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Amplitude&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">xlim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">savefig_settings</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xticks</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">yticks</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">plot_legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
             <span class="n">curve_clr</span><span class="o">=</span><span class="n">sns</span><span class="o">.</span><span class="n">xkcd_rgb</span><span class="p">[</span><span class="s1">&#39;pale red&#39;</span><span class="p">],</span> <span class="n">curve_lw</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">shade_clr</span><span class="o">=</span><span class="n">sns</span><span class="o">.</span><span class="n">xkcd_rgb</span><span class="p">[</span><span class="s1">&#39;pale red&#39;</span><span class="p">],</span> <span class="n">shade_alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">shade_label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">lgd_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mute</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">members_plot_num</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">members_alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">members_lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Plot mutiple PSD as an envelope.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        figsize : list, optional</span>
<span class="sd">            The figure size. The default is [10, 4].</span>
<span class="sd">        qs : list, optional</span>
<span class="sd">            The significance levels to consider. The default is [0.025, 0.5, 0.975].</span>
<span class="sd">        in_loglog : bool, optional</span>
<span class="sd">            Plot in log space. The default is True.</span>
<span class="sd">        in_period : bool, optional</span>
<span class="sd">            Whether to plot periodicity instead of frequency. The default is True.</span>
<span class="sd">        xlabel : str, optional</span>
<span class="sd">            x-axis label. The default is None.</span>
<span class="sd">        ylabel : str, optional</span>
<span class="sd">            y-axis label. The default is &#39;Amplitude&#39;.</span>
<span class="sd">        title : str, optional</span>
<span class="sd">            Plot title. The default is None.</span>
<span class="sd">        xlim : list, optional</span>
<span class="sd">            x-axis limits. The default is None.</span>
<span class="sd">        ylim : list, optional</span>
<span class="sd">            y-axis limits. The default is None.</span>
<span class="sd">        savefig_settings : dict, optional</span>
<span class="sd">            the dictionary of arguments for plt.savefig(); some notes below:</span>
<span class="sd">            - &quot;path&quot; must be specified; it can be any existed or non-existed path,</span>
<span class="sd">              with or without a suffix; if the suffix is not given in &quot;path&quot;, it will follow &quot;format&quot;</span>
<span class="sd">            - &quot;format&quot; can be one of {&quot;pdf&quot;, &quot;eps&quot;, &quot;png&quot;, &quot;ps&quot;} The default is None.</span>
<span class="sd">        ax : matplotlib.ax, optional</span>
<span class="sd">            Matplotlib axis on which to return the plot. The default is None.</span>
<span class="sd">        xticks : list, optional</span>
<span class="sd">            xticks label. The default is None.</span>
<span class="sd">        yticks : list, optional</span>
<span class="sd">            yticks label. The default is None.</span>
<span class="sd">        plot_legend : bool, optional</span>
<span class="sd">            Wether to plot the legend. The default is True.</span>
<span class="sd">        curve_clr : str, optional</span>
<span class="sd">            Color of the main PSD. The default is sns.xkcd_rgb[&#39;pale red&#39;].</span>
<span class="sd">        curve_lw : str, optional</span>
<span class="sd">            Width of the main PSD line. The default is 3.</span>
<span class="sd">        shade_clr : str, optional</span>
<span class="sd">            Color of the shaded envelope. The default is sns.xkcd_rgb[&#39;pale red&#39;].</span>
<span class="sd">        shade_alpha : float, optional</span>
<span class="sd">            Transparency on the envelope. The default is 0.3.</span>
<span class="sd">        shade_label : str, optional</span>
<span class="sd">            Label for the envelope. The default is None.</span>
<span class="sd">        lgd_kwargs : dict, optional</span>
<span class="sd">            Parameters for the legend. The default is None.</span>
<span class="sd">        mute : bool, optional</span>
<span class="sd">            if True, the plot will not show;</span>
<span class="sd">            recommend to turn on when more modifications are going to be made on ax. The default is False.</span>
<span class="sd">        members_plot_num : int, optional</span>
<span class="sd">            Number of individual members to plot. The default is 10.</span>
<span class="sd">        members_alpha : float, optional</span>
<span class="sd">            Transparency of the lines representing the multiple members. The default is 0.3.</span>
<span class="sd">        members_lw : float, optional</span>
<span class="sd">            With of the lines representing the multiple members. The default is 1.</span>
<span class="sd">        seed : int, optional</span>
<span class="sd">            Set the seed for random number generator. Useful for reproducibility. The default is None.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        fig, ax</span>

<span class="sd">        &#39;&#39;&#39;</span>


        <span class="c1"># Turn the interactive mode off.</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ioff</span><span class="p">()</span>



        <span class="n">savefig_settings</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">savefig_settings</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">savefig_settings</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">lgd_kwargs</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">lgd_kwargs</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">lgd_kwargs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">members_plot_num</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">seed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>

            <span class="n">npsd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">psd_list</span><span class="p">)</span>
            <span class="n">random_draw_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">npsd</span><span class="p">,</span> <span class="n">members_plot_num</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">random_draw_idx</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">psd_list</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                    <span class="n">in_loglog</span><span class="o">=</span><span class="n">in_loglog</span><span class="p">,</span> <span class="n">in_period</span><span class="o">=</span><span class="n">in_period</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="n">xlabel</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="n">ylabel</span><span class="p">,</span>
                    <span class="n">xlim</span><span class="o">=</span><span class="n">xlim</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="n">ylim</span><span class="p">,</span> <span class="n">xticks</span><span class="o">=</span><span class="n">xticks</span><span class="p">,</span> <span class="n">yticks</span><span class="o">=</span><span class="n">yticks</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">members_alpha</span><span class="p">,</span>
                    <span class="n">zorder</span><span class="o">=</span><span class="mi">99</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="n">members_lw</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;example members (n=</span><span class="si">{</span><span class="n">members_plot_num</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>

        <span class="n">psd_qs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">quantiles</span><span class="p">(</span><span class="n">qs</span><span class="o">=</span><span class="n">qs</span><span class="p">)</span>
        <span class="n">psd_qs</span><span class="o">.</span><span class="n">psd_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="n">in_loglog</span><span class="o">=</span><span class="n">in_loglog</span><span class="p">,</span> <span class="n">in_period</span><span class="o">=</span><span class="n">in_period</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="n">xlabel</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="n">ylabel</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="n">curve_lw</span><span class="p">,</span>
            <span class="n">xlim</span><span class="o">=</span><span class="n">xlim</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="n">ylim</span><span class="p">,</span> <span class="n">xticks</span><span class="o">=</span><span class="n">xticks</span><span class="p">,</span> <span class="n">yticks</span><span class="o">=</span><span class="n">yticks</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">curve_clr</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">100</span>
        <span class="p">)</span>


        <span class="k">if</span> <span class="n">in_period</span><span class="p">:</span>
            <span class="n">x_axis</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">psd_qs</span><span class="o">.</span><span class="n">psd_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">frequency</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">x_axis</span> <span class="o">=</span> <span class="n">psd_qs</span><span class="o">.</span><span class="n">psd_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">frequency</span>

        <span class="k">if</span> <span class="n">shade_label</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">shade_label</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">psd_qs</span><span class="o">.</span><span class="n">psd_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">label</span><span class="si">}</span><span class="s1">-</span><span class="si">{</span><span class="n">psd_qs</span><span class="o">.</span><span class="n">psd_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">label</span><span class="si">}</span><span class="s1">&#39;</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span>
            <span class="n">x_axis</span><span class="p">,</span> <span class="n">psd_qs</span><span class="o">.</span><span class="n">psd_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">amplitude</span><span class="p">,</span> <span class="n">psd_qs</span><span class="o">.</span><span class="n">psd_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">amplitude</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="n">shade_clr</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">shade_alpha</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="n">shade_clr</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">shade_label</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">plot_legend</span><span class="p">:</span>
            <span class="n">lgd_args</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;frameon&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>
            <span class="n">lgd_args</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">lgd_kwargs</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="o">**</span><span class="n">lgd_args</span><span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;fig&#39;</span> <span class="ow">in</span> <span class="nb">locals</span><span class="p">():</span>
            <span class="k">if</span> <span class="s1">&#39;path&#39;</span> <span class="ow">in</span> <span class="n">savefig_settings</span><span class="p">:</span>
                <span class="n">plotting</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">settings</span><span class="o">=</span><span class="n">savefig_settings</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">mute</span><span class="p">:</span>
                    <span class="n">plotting</span><span class="o">.</span><span class="n">showfig</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ax</span></div></div>


<div class="viewcode-block" id="MultipleScalogram"><a class="viewcode-back" href="../../../core/ui.html#pyleoclim.core.ui.MultipleScalogram">[docs]</a><span class="k">class</span> <span class="nc">MultipleScalogram</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39; Multiple Scalogram objects</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scalogram_list</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scalogram_list</span> <span class="o">=</span> <span class="n">scalogram_list</span>

<div class="viewcode-block" id="MultipleScalogram.copy"><a class="viewcode-back" href="../../../core/ui.html#pyleoclim.core.ui.MultipleScalogram.copy">[docs]</a>    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Copy the object</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="MultipleScalogram.quantiles"><a class="viewcode-back" href="../../../core/ui.html#pyleoclim.core.ui.MultipleScalogram.quantiles">[docs]</a>    <span class="k">def</span> <span class="nf">quantiles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qs</span><span class="o">=</span><span class="p">[</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">]):</span>
        <span class="sd">&#39;&#39;&#39;Calculate quantiles</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        qs : list, optional</span>
<span class="sd">            List of quantiles to consider for the calculation. The default is [0.05, 0.5, 0.95].</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            Frequency axis not consistent across the PSD list!</span>

<span class="sd">        Value Error</span>
<span class="sd">            Time axis not consistent across the scalogram list!</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        scals : pyleoclim.MultipleScalogram</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">freq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scalogram_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">frequency</span><span class="p">)</span>
        <span class="n">time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scalogram_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">time</span><span class="p">)</span>
        <span class="n">coi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scalogram_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">coi</span><span class="p">)</span>
        <span class="n">amps</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">scal</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">scalogram_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="n">scal</span><span class="o">.</span><span class="n">frequency</span><span class="p">,</span> <span class="n">freq</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Frequency axis not consistent across the scalogram list!&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="n">scal</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">time</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Time axis not consistent across the scalogram list!&#39;</span><span class="p">)</span>

            <span class="n">amps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scal</span><span class="o">.</span><span class="n">amplitude</span><span class="p">)</span>

        <span class="n">amps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">amps</span><span class="p">)</span>
        <span class="n">ne</span><span class="p">,</span> <span class="n">nf</span><span class="p">,</span> <span class="n">nt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">amps</span><span class="p">)</span>
        <span class="n">amp_qs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">qs</span><span class="p">),</span> <span class="n">nf</span><span class="p">,</span> <span class="n">nt</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nf</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nt</span><span class="p">):</span>
                <span class="n">amp_qs</span><span class="p">[:,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">mquantiles</span><span class="p">(</span><span class="n">amps</span><span class="p">[:,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">],</span> <span class="n">qs</span><span class="p">)</span>

        <span class="n">scal_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">amp</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">amp_qs</span><span class="p">):</span>
            <span class="n">scal_tmp</span> <span class="o">=</span> <span class="n">Scalogram</span><span class="p">(</span><span class="n">frequency</span><span class="o">=</span><span class="n">freq</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">,</span> <span class="n">amplitude</span><span class="o">=</span><span class="n">amp</span><span class="p">,</span> <span class="n">coi</span><span class="o">=</span><span class="n">coi</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">qs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="mi">100</span><span class="si">:</span><span class="s1">g</span><span class="si">}</span><span class="s1">%&#39;</span><span class="p">)</span>
            <span class="n">scal_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scal_tmp</span><span class="p">)</span>

        <span class="n">scals</span> <span class="o">=</span> <span class="n">MultipleScalogram</span><span class="p">(</span><span class="n">scalogram_list</span><span class="o">=</span><span class="n">scal_list</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">scals</span></div></div>



<div class="viewcode-block" id="CorrEns"><a class="viewcode-back" href="../../../core/ui.html#pyleoclim.core.ui.CorrEns">[docs]</a><span class="k">class</span> <span class="nc">CorrEns</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39; Correlation Ensemble</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    r: list</span>
<span class="sd">        the list of correlation coefficients</span>

<span class="sd">    p: list</span>
<span class="sd">        the list of p-values</span>

<span class="sd">    signif: list</span>
<span class="sd">        the list of significance without FDR</span>

<span class="sd">    signif_fdr: list</span>
<span class="sd">        the list of significance with FDR</span>

<span class="sd">    signif_fdr: list</span>
<span class="sd">        the list of significance with FDR</span>

<span class="sd">    alpha : float</span>
<span class="sd">        The significance level (0.05 by default)</span>

<span class="sd">    See also</span>
<span class="sd">    --------</span>

<span class="sd">    pyleoclim.utils.correlation.corr_sig : Correlation function</span>
<span class="sd">    pyleoclim.utils.correlation.fdr : FDR function</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">signif</span><span class="p">,</span> <span class="n">signif_fdr</span><span class="p">,</span> <span class="n">alpha</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r</span> <span class="o">=</span> <span class="n">r</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">=</span> <span class="n">p</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">signif</span> <span class="o">=</span> <span class="n">signif</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">signif_fdr</span> <span class="o">=</span> <span class="n">signif_fdr</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="n">alpha</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Prints out the correlation results</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">table</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;correlation&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="p">,</span>
            <span class="s1">&#39;p-value&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">,</span>
            <span class="sa">f</span><span class="s1">&#39;signif. w/o FDR (: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">signif</span><span class="p">,</span>
            <span class="sa">f</span><span class="s1">&#39;signif. w/ FDR (: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">signif_fdr</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">msg</span> <span class="o">=</span> <span class="nb">print</span><span class="p">(</span><span class="n">tabulate</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="s1">&#39;keys&#39;</span><span class="p">))</span>

        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;Ensemble size: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span>


<div class="viewcode-block" id="CorrEns.plot"><a class="viewcode-back" href="../../../core/ui.html#pyleoclim.core.ui.CorrEns.plot">[docs]</a>    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">savefig_settings</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">hist_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">title_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">clr_insignif</span><span class="o">=</span><span class="n">sns</span><span class="o">.</span><span class="n">xkcd_rgb</span><span class="p">[</span><span class="s1">&#39;grey&#39;</span><span class="p">],</span> <span class="n">clr_signif</span><span class="o">=</span><span class="n">sns</span><span class="o">.</span><span class="n">xkcd_rgb</span><span class="p">[</span><span class="s1">&#39;teal&#39;</span><span class="p">],</span> <span class="n">clr_signif_fdr</span><span class="o">=</span><span class="n">sns</span><span class="o">.</span><span class="n">xkcd_rgb</span><span class="p">[</span><span class="s1">&#39;pale orange&#39;</span><span class="p">],</span>
             <span class="n">clr_percentile</span><span class="o">=</span><span class="n">sns</span><span class="o">.</span><span class="n">xkcd_rgb</span><span class="p">[</span><span class="s1">&#39;salmon&#39;</span><span class="p">],</span> <span class="n">rwidth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vrange</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mute</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Plot the correlation ensembles</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        figsize : list, optional</span>
<span class="sd">            The figure size. The default is [4, 4].</span>

<span class="sd">        title : str, optional</span>
<span class="sd">            Plot title. The default is None.</span>

<span class="sd">        savefig_settings : dict</span>
<span class="sd">            the dictionary of arguments for plt.savefig(); some notes below:</span>
<span class="sd">            - &quot;path&quot; must be specified; it can be any existed or non-existed path,</span>
<span class="sd">              with or without a suffix; if the suffix is not given in &quot;path&quot;, it will follow &quot;format&quot;</span>
<span class="sd">            - &quot;format&quot; can be one of {&quot;pdf&quot;, &quot;eps&quot;, &quot;png&quot;, &quot;ps&quot;}</span>

<span class="sd">        hist_kwargs : dict</span>
<span class="sd">            the keyword arguments for ax.hist()</span>

<span class="sd">        title_kwargs : dict</span>
<span class="sd">            the keyword arguments for ax.set_title()</span>

<span class="sd">        ax : matplotlib.axis, optional</span>
<span class="sd">            the axis object from matplotlib</span>
<span class="sd">            See [matplotlib.axes](https://matplotlib.org/api/axes_api.html) for details.</span>

<span class="sd">        mute : {True,False}</span>
<span class="sd">            if True, the plot will not show;</span>
<span class="sd">            recommend to turn on when more modifications are going to be made on ax</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>

<span class="sd">        matplotlib.pyplot.hist: https://matplotlib.org/3.3.3/api/_as_gen/matplotlib.pyplot.hist.html</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># Turn the interactive mode off.</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ioff</span><span class="p">()</span>

        <span class="n">savefig_settings</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">savefig_settings</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">savefig_settings</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">hist_kwargs</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">hist_kwargs</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">hist_kwargs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">vrange</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">vrange</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="p">)]</span>

        <span class="n">clr_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">clr_insignif</span><span class="p">,</span> <span class="n">clr_signif</span><span class="p">,</span> <span class="n">clr_signif_fdr</span><span class="p">]</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;rwidth&#39;</span><span class="p">:</span> <span class="n">rwidth</span><span class="p">,</span> <span class="s1">&#39;bins&#39;</span><span class="p">:</span> <span class="n">bins</span><span class="p">,</span> <span class="s1">&#39;range&#39;</span><span class="p">:</span> <span class="n">vrange</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="n">clr_list</span><span class="p">}</span>
        <span class="n">args</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">hist_kwargs</span><span class="p">)</span>
        <span class="c1"># insignif_args.update(hist_kwargs)</span>

        <span class="n">r_insignif</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="p">)[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">signif</span><span class="p">)]</span>
        <span class="n">r_signif</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="p">)[</span><span class="bp">self</span><span class="o">.</span><span class="n">signif</span><span class="p">]</span>
        <span class="n">r_signif_fdr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="p">)[</span><span class="bp">self</span><span class="o">.</span><span class="n">signif_fdr</span><span class="p">]</span>
        <span class="n">r_stack</span> <span class="o">=</span> <span class="p">[</span><span class="n">r_insignif</span><span class="p">,</span> <span class="n">r_signif</span><span class="p">,</span> <span class="n">r_signif_fdr</span><span class="p">]</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">r_stack</span><span class="p">,</span> <span class="n">stacked</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="sa">f</span><span class="s1">&#39;p  </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;p &lt; </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="si">}</span><span class="s1"> (w/o FDR)&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;p &lt; </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="si">}</span><span class="s1"> (w/ FDR)&#39;</span><span class="p">],</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">frac_signif</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">r_signif</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="p">)</span>
        <span class="n">frac_signif_fdr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">r_signif_fdr</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mf">1.1</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Fraction significant: </span><span class="si">{</span><span class="n">frac_signif</span><span class="o">*</span><span class="mi">100</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">%&#39;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">clr_signif</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mf">1.1</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Fraction significant: </span><span class="si">{</span><span class="n">frac_signif_fdr</span><span class="o">*</span><span class="mi">100</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">%&#39;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">clr_signif_fdr</span><span class="p">)</span>

        <span class="n">r_pcts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="p">,</span> <span class="p">[</span><span class="mf">2.5</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="mf">97.5</span><span class="p">])</span>
        <span class="n">trans</span> <span class="o">=</span> <span class="n">transforms</span><span class="o">.</span><span class="n">blended_transform_factory</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">transData</span><span class="p">,</span> <span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">r_pct</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span> <span class="n">ls</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">r_pcts</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">2.5</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="mf">97.5</span><span class="p">])</span><span class="o">/</span><span class="mi">100</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="s1">&#39;:&#39;</span><span class="p">]):</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">r_pct</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="n">ls</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">clr_percentile</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">r_pct</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.02</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="n">pt</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">clr_percentile</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">trans</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$r$&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Count&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MaxNLocator</span><span class="p">(</span><span class="n">integer</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>


        <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">title_kwargs</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">title_kwargs</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">title_kwargs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">t_args</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="mf">1.1</span><span class="p">,</span> <span class="s1">&#39;weight&#39;</span><span class="p">:</span> <span class="s1">&#39;bold&#39;</span><span class="p">}</span>
            <span class="n">t_args</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">title_kwargs</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="o">**</span><span class="n">t_args</span><span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;path&#39;</span> <span class="ow">in</span> <span class="n">savefig_settings</span><span class="p">:</span>
            <span class="n">plotting</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">settings</span><span class="o">=</span><span class="n">savefig_settings</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">mute</span><span class="p">:</span>
                <span class="n">plotting</span><span class="o">.</span><span class="n">showfig</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span></div></div>

<div class="viewcode-block" id="Lipd"><a class="viewcode-back" href="../../../core/ui.html#pyleoclim.core.ui.Lipd">[docs]</a><span class="k">class</span> <span class="nc">Lipd</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;Create a Lipd object from Lipd Files</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    usr_path : str</span>
<span class="sd">        path to the Lipd file(s). Can be URL (LiPD utilities only support loading one file at a time from a URL)</span>
<span class="sd">        If it&#39;s a URL, it must start with &quot;http&quot;, &quot;https&quot;, or &quot;ftp&quot;.</span>

<span class="sd">    lidp_dict : dict</span>
<span class="sd">        LiPD files already loaded into Python through the LiPD utilities</span>

<span class="sd">    validate : bool</span>
<span class="sd">        Validate the LiPD files upon loading. Note that for a large library this can take up to half an hour.</span>

<span class="sd">    remove : bool</span>
<span class="sd">        If validate is True and remove is True, ignores non-valid Lipd files. Note that loading unvalidated Lipd files may result in errors for some functionalities but not all.</span>

<span class="sd">    TODO</span>
<span class="sd">    ----</span>

<span class="sd">    Support querying the LinkedEarth platform</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>

<span class="sd">    .. ipython:: python</span>
<span class="sd">        :okwarning:</span>

<span class="sd">        import pyleoclim as pyleo</span>
<span class="sd">        url=&#39;http://wiki.linked.earth/wiki/index.php/Special:WTLiPD?op=export&amp;lipdid=MD982176.Stott.2004&#39;</span>
<span class="sd">        d=pyleo.Lipd(usr_path=url)</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">usr_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lipd_dict</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">remove</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_default</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;ice-other&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;#FFD600&#39;</span><span class="p">,</span><span class="s1">&#39;h&#39;</span><span class="p">],</span>
                <span class="s1">&#39;ice/rock&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;#FFD600&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">],</span>
                <span class="s1">&#39;coral&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;#FF8B00&#39;</span><span class="p">,</span><span class="s1">&#39;o&#39;</span><span class="p">],</span>
                <span class="s1">&#39;documents&#39;</span><span class="p">:[</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="s1">&#39;p&#39;</span><span class="p">],</span>
                <span class="s1">&#39;glacierice&#39;</span><span class="p">:[</span><span class="s1">&#39;#86CDFA&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">],</span>
                <span class="s1">&#39;hybrid&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;#00BEFF&#39;</span><span class="p">,</span><span class="s1">&#39;*&#39;</span><span class="p">],</span>
                <span class="s1">&#39;lakesediment&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;#4169E0&#39;</span><span class="p">,</span><span class="s1">&#39;s&#39;</span><span class="p">],</span>
                <span class="s1">&#39;marinesediment&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;#8A4513&#39;</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">],</span>
                <span class="s1">&#39;sclerosponge&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="s1">&#39;o&#39;</span><span class="p">],</span>
                <span class="s1">&#39;speleothem&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="s1">&#39;#FF1492&#39;</span><span class="p">,</span><span class="s1">&#39;d&#39;</span><span class="p">],</span>
                <span class="s1">&#39;wood&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="s1">&#39;#32CC32&#39;</span><span class="p">,</span><span class="s1">&#39;^&#39;</span><span class="p">],</span>
                <span class="s1">&#39;molluskshells&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="s1">&#39;#FFD600&#39;</span><span class="p">,</span><span class="s1">&#39;h&#39;</span><span class="p">],</span>
                <span class="s1">&#39;peat&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="s1">&#39;#2F4F4F&#39;</span><span class="p">,</span><span class="s1">&#39;*&#39;</span><span class="p">],</span>
                <span class="s1">&#39;midden&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="s1">&#39;#824E2B&#39;</span><span class="p">,</span><span class="s1">&#39;o&#39;</span><span class="p">],</span>
                <span class="s1">&#39;other&#39;</span><span class="p">:[</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="s1">&#39;o&#39;</span><span class="p">]}</span>

        <span class="k">if</span> <span class="n">validate</span><span class="o">==</span><span class="kc">False</span> <span class="ow">and</span> <span class="n">remove</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Removal of unvalidated LiPD files require validation&#39;</span><span class="p">)</span>
            <span class="n">validate</span><span class="o">=</span><span class="kc">True</span>

        <span class="c1">#prepare the dictionaries for all possible scenarios</span>
        <span class="k">if</span> <span class="n">usr_path</span><span class="o">!=</span><span class="kc">None</span><span class="p">:</span>
            <span class="c1"># since readLipd() takes only absolute path and it will change the current working directory (CWD) without turning back,</span>
            <span class="c1"># we need to record CWD manually and turn back after the data loading is finished</span>
            <span class="n">cwd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">usr_path</span><span class="p">[:</span><span class="mi">4</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;http&#39;</span> <span class="ow">or</span> <span class="n">usr_path</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;ftp&#39;</span><span class="p">:</span>
                <span class="c1"># URL</span>
                <span class="n">D_path</span> <span class="o">=</span> <span class="n">lpd</span><span class="o">.</span><span class="n">readLipd</span><span class="p">(</span><span class="n">usr_path</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># local path</span>
                <span class="n">abs_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">usr_path</span><span class="p">)</span>
                <span class="n">D_path</span> <span class="o">=</span> <span class="n">lpd</span><span class="o">.</span><span class="n">readLipd</span><span class="p">(</span><span class="n">abs_path</span><span class="p">)</span>

            <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">cwd</span><span class="p">)</span>

            <span class="c1">#make sure that it&#39;s more than one</span>
            <span class="k">if</span> <span class="s1">&#39;archiveType&#39;</span> <span class="ow">in</span> <span class="n">D_path</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">D_path</span><span class="o">=</span><span class="p">{</span><span class="n">D_path</span><span class="p">[</span><span class="s1">&#39;dataSetName&#39;</span><span class="p">]:</span><span class="n">D_path</span><span class="p">}</span>
            <span class="k">if</span> <span class="n">validate</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>
                <span class="n">cwd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
                <span class="n">res</span><span class="o">=</span><span class="n">lpd</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">D_path</span><span class="p">,</span><span class="n">detailed</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">cwd</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">remove</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">res</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;FAIL&#39;</span><span class="p">:</span>
                           <span class="n">c</span><span class="o">=</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;feedback&#39;</span><span class="p">][</span><span class="s1">&#39;errMsgs&#39;</span><span class="p">]</span>
                           <span class="n">check</span> <span class="o">=</span> <span class="p">[]</span>
                           <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">c</span><span class="p">:</span>
                               <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;Mismatched columns&#39;</span><span class="p">):</span>
                                   <span class="n">check</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                               <span class="k">else</span><span class="p">:</span> <span class="n">check</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                           <span class="k">if</span> <span class="mi">0</span> <span class="ow">in</span> <span class="n">check</span><span class="p">:</span>
                               <span class="k">del</span> <span class="n">D_path</span><span class="p">[</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;filename&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;.lpd&#39;</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">D_path</span><span class="o">=</span><span class="p">{}</span>
        <span class="k">if</span> <span class="n">lipd_dict</span><span class="o">!=</span><span class="kc">None</span><span class="p">:</span>
            <span class="n">D_dict</span><span class="o">=</span><span class="n">lipd_dict</span>
            <span class="k">if</span> <span class="s1">&#39;archiveType&#39;</span> <span class="ow">in</span> <span class="n">D_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">D_dict</span><span class="o">=</span><span class="p">{</span><span class="n">D_dict</span><span class="p">[</span><span class="s1">&#39;dataSetName&#39;</span><span class="p">]:</span><span class="n">D_dict</span><span class="p">}</span>
            <span class="k">if</span> <span class="n">validate</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>
                <span class="n">cwd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
                <span class="n">res</span><span class="o">=</span><span class="n">lpd</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">D_dict</span><span class="p">,</span><span class="n">detailed</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">cwd</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">remove</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">res</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;FAIL&#39;</span><span class="p">:</span>
                           <span class="n">c</span><span class="o">=</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;feedback&#39;</span><span class="p">][</span><span class="s1">&#39;errMsgs&#39;</span><span class="p">]</span>
                           <span class="n">check</span> <span class="o">=</span> <span class="p">[]</span>
                           <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">c</span><span class="p">:</span>
                               <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;Mismatched columns&#39;</span><span class="p">):</span>
                                   <span class="n">check</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                               <span class="k">else</span><span class="p">:</span> <span class="n">check</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                           <span class="k">if</span> <span class="mi">0</span> <span class="ow">in</span> <span class="n">check</span><span class="p">:</span>
                               <span class="k">del</span> <span class="n">D_dict</span><span class="p">[</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;filename&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;.lpd&#39;</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">D_dict</span><span class="o">=</span><span class="p">{}</span>

        <span class="c1"># raise an error if empty</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">bool</span><span class="p">(</span><span class="n">D_dict</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">bool</span><span class="p">(</span><span class="n">D_path</span><span class="p">)</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;No valid files; try without validation.&#39;</span><span class="p">)</span>
        <span class="c1">#assemble</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lipd</span><span class="o">=</span><span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lipd</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">D_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lipd</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">D_dict</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">)</span>

<div class="viewcode-block" id="Lipd.copy"><a class="viewcode-back" href="../../../core/ui.html#pyleoclim.core.ui.Lipd.copy">[docs]</a>    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Copy the object</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="Lipd.to_tso"><a class="viewcode-back" href="../../../core/ui.html#pyleoclim.core.ui.Lipd.to_tso">[docs]</a>    <span class="k">def</span> <span class="nf">to_tso</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Extracts all the timeseries objects to a list of LiPD tso</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ts_list : list</span>
<span class="sd">            List of Lipd timeseries objects as defined by LiPD utilities</span>

<span class="sd">        See also</span>
<span class="sd">        --------</span>

<span class="sd">        pyleoclim.ui.LipdSeries : LiPD Series object.</span>


<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">cwd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
        <span class="n">ts_list</span><span class="o">=</span><span class="n">lpd</span><span class="o">.</span><span class="n">extractTs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s1">&#39;lipd&#39;</span><span class="p">])</span>
        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">cwd</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ts_list</span></div>

<div class="viewcode-block" id="Lipd.extract"><a class="viewcode-back" href="../../../core/ui.html#pyleoclim.core.ui.Lipd.extract">[docs]</a>    <span class="k">def</span> <span class="nf">extract</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">dataSetName</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        dataSetName : str</span>
<span class="sd">            Extract a particular dataset</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        new : pyleoclim.Lipd</span>
<span class="sd">            A new object corresponding to a particular dataset</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">new</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">dict_out</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s1">&#39;lipd&#39;</span><span class="p">][</span><span class="n">dataSetName</span><span class="p">]</span>
            <span class="n">new</span><span class="o">.</span><span class="n">lipd</span><span class="o">=</span><span class="n">dict_out</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="k">return</span> <span class="n">new</span></div>

<div class="viewcode-block" id="Lipd.to_LipdSeriesList"><a class="viewcode-back" href="../../../core/ui.html#pyleoclim.core.ui.Lipd.to_LipdSeriesList">[docs]</a>    <span class="k">def</span> <span class="nf">to_LipdSeriesList</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;paleo&#39;</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Extracts all LiPD timeseries objects to a list of LipdSeries objects</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        mode : {&#39;paleo&#39;,&#39;chron&#39;}</span>
<span class="sd">            Whether to extract the timeseries information from the paleo tables or chron tables</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        res : list</span>
<span class="sd">            A list of LiPDSeries objects</span>

<span class="sd">        See also</span>
<span class="sd">        --------</span>
<span class="sd">        pyleoclim.ui.LipdSeries : LipdSeries object</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">cwd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
        <span class="n">ts_list</span><span class="o">=</span><span class="n">lpd</span><span class="o">.</span><span class="n">extractTs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s1">&#39;lipd&#39;</span><span class="p">],</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">cwd</span><span class="p">)</span>

        <span class="n">res</span><span class="o">=</span><span class="p">[]</span>

        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ts_list</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">LipdSeries</span><span class="p">(</span><span class="n">item</span><span class="p">))</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;paleo&#39;</span><span class="p">:</span>
                    <span class="n">txt</span> <span class="o">=</span> <span class="s1">&#39;The timeseries from &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;: &#39;</span> <span class="o">+</span>\
                            <span class="n">item</span><span class="p">[</span><span class="s1">&#39;dataSetName&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;: &#39;</span> <span class="o">+</span> \
                            <span class="n">item</span><span class="p">[</span><span class="s1">&#39;paleoData_variableName&#39;</span><span class="p">]</span> <span class="o">+</span> \
                            <span class="s1">&#39; could not be coerced into a LipdSeries object, passing&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">txt</span> <span class="o">=</span> <span class="s1">&#39;The timeseries from &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;: &#39;</span> <span class="o">+</span>\
                            <span class="n">item</span><span class="p">[</span><span class="s1">&#39;dataSetName&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;: &#39;</span> <span class="o">+</span> \
                            <span class="n">item</span><span class="p">[</span><span class="s1">&#39;chronData_variableName&#39;</span><span class="p">]</span> <span class="o">+</span> \
                            <span class="s1">&#39; could not be coerced into a LipdSeries object, passing&#39;</span>  
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span>
                <span class="k">pass</span>

        <span class="k">return</span> <span class="n">res</span></div>

<div class="viewcode-block" id="Lipd.to_LipdSeries"><a class="viewcode-back" href="../../../core/ui.html#pyleoclim.core.ui.Lipd.to_LipdSeries">[docs]</a>    <span class="k">def</span> <span class="nf">to_LipdSeries</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">number</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;paleo&#39;</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Extracts one timeseries from the Lipd object</span>

<span class="sd">        Note that this function may require user interaction.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        number : int</span>
<span class="sd">            the number of the timeseries object</span>

<span class="sd">        mode : {&#39;paleo&#39;,&#39;chron&#39;}</span>
<span class="sd">            whether to extract the paleo or chron series.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ts : pyleoclim.LipdSeries</span>
<span class="sd">            A LipdSeries object</span>

<span class="sd">        See also</span>
<span class="sd">        --------</span>
<span class="sd">        pyleoclim.ui.LipdSeries : LipdSeries object</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">cwd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
        <span class="n">ts_list</span> <span class="o">=</span> <span class="n">lpd</span><span class="o">.</span><span class="n">extractTs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s1">&#39;lipd&#39;</span><span class="p">],</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">cwd</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">number</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ts</span> <span class="o">=</span> <span class="n">LipdSeries</span><span class="p">(</span><span class="n">ts_list</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">number</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">number</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Number needs to be an integer or should be coerced into an integer.&#39;</span><span class="p">)</span>
            <span class="n">ts</span> <span class="o">=</span> <span class="n">LipdSeries</span><span class="p">(</span><span class="n">ts_list</span><span class="p">[</span><span class="n">number</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">ts</span></div>



<div class="viewcode-block" id="Lipd.mapAllArchive"><a class="viewcode-back" href="../../../core/ui.html#pyleoclim.core.ui.Lipd.mapAllArchive">[docs]</a>    <span class="k">def</span> <span class="nf">mapAllArchive</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">projection</span> <span class="o">=</span> <span class="s1">&#39;Robinson&#39;</span><span class="p">,</span> <span class="n">proj_default</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
           <span class="n">background</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span><span class="n">borders</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">rivers</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">lakes</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
           <span class="n">figsize</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
           <span class="n">markersize</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">scatter_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
           <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">lgd_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">savefig_settings</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mute</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Map the records contained in LiPD files by archive type</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        projection : str, optional</span>
<span class="sd">            The projection to use. The default is &#39;Robinson&#39;.</span>
<span class="sd">        proj_default : bool, optional</span>
<span class="sd">            Wether to use the Pyleoclim defaults for each projection type. The default is True.</span>
<span class="sd">        background : bool, optional</span>
<span class="sd">            Wether to use a backgound. The default is True.</span>
<span class="sd">        borders : bool, optional</span>
<span class="sd">            Draw borders. The default is False.</span>
<span class="sd">        rivers : bool, optional</span>
<span class="sd">            Draw rivers. The default is False.</span>
<span class="sd">        lakes : bool, optional</span>
<span class="sd">            Draw lakes. The default is False.</span>
<span class="sd">        figsize : list, optional</span>
<span class="sd">            The size of the figure. The default is None.</span>
<span class="sd">        ax : matplotlib.ax, optional</span>
<span class="sd">            The matplotlib axis onto which to return the map. The default is None.</span>
<span class="sd">        marker : str, optional</span>
<span class="sd">            The marker type for each archive. The default is None. Uses plot_default</span>
<span class="sd">        color : str, optional</span>
<span class="sd">            Color for each acrhive. The default is None. Uses plot_default</span>
<span class="sd">        markersize : float, optional</span>
<span class="sd">            Size of the marker. The default is None.</span>
<span class="sd">        scatter_kwargs : dict, optional</span>
<span class="sd">            Parameters for the scatter plot. The default is None.</span>
<span class="sd">        legend : bool, optional</span>
<span class="sd">            Whether to plot the legend. The default is True.</span>
<span class="sd">        lgd_kwargs : dict, optional</span>
<span class="sd">            Arguments for the legend. The default is None.</span>
<span class="sd">        savefig_settings : dictionary, optional</span>
<span class="sd">            the dictionary of arguments for plt.savefig(); some notes below:</span>
<span class="sd">            - &quot;path&quot; must be specified; it can be any existed or non-existed path,</span>
<span class="sd">              with or without a suffix; if the suffix is not given in &quot;path&quot;, it will follow &quot;format&quot;</span>
<span class="sd">            - &quot;format&quot; can be one of {&quot;pdf&quot;, &quot;eps&quot;, &quot;png&quot;, &quot;ps&quot;}. The default is None.</span>
<span class="sd">        mute : bool, optional</span>
<span class="sd">            if True, the plot will not show;</span>
<span class="sd">            recommend to turn on when more modifications are going to be made on ax. The default is False.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        res : figure</span>
<span class="sd">            The figure</span>

<span class="sd">        See also</span>
<span class="sd">        --------</span>

<span class="sd">        pyleoclim.utils.mapping.map_all : Underlying mapping function for Pyleoclim</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        For speed, we are only using one LiPD file. But these functions can load and map multiple.</span>

<span class="sd">        .. ipython:: python</span>
<span class="sd">            :okwarning:</span>

<span class="sd">            import pyleoclim as pyleo</span>
<span class="sd">            url = &#39;http://wiki.linked.earth/wiki/index.php/Special:WTLiPD?op=export&amp;lipdid=MD982176.Stott.2004&#39;</span>
<span class="sd">            data = pyleo.Lipd(usr_path = url)</span>
<span class="sd">            @savefig mapallarchive.png</span>
<span class="sd">            fig, ax = data.mapAllArchive()</span>
<span class="sd">            pyleo.closefig(fig)</span>

<span class="sd">        Change the markersize</span>

<span class="sd">        .. ipython:: python</span>
<span class="sd">            :okwarning:</span>

<span class="sd">            import pyleoclim as pyleo</span>
<span class="sd">            url = &#39;http://wiki.linked.earth/wiki/index.php/Special:WTLiPD?op=export&amp;lipdid=MD982176.Stott.2004&#39;</span>
<span class="sd">            data = pyleo.Lipd(usr_path = url)</span>
<span class="sd">            @savefig mapallarchive_marker.png</span>
<span class="sd">            fig, ax = data.mapAllArchive(markersize=100)</span>
<span class="sd">            pyleo.closefig(fig)</span>


<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">scatter_kwargs</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">scatter_kwargs</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">scatter_kwargs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>


        <span class="c1">#get the information from the LiPD dict</span>
        <span class="n">lat</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">lon</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">archiveType</span><span class="o">=</span><span class="p">[]</span>

        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lipd</span><span class="p">):</span>
            <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lipd</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="n">lat</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;geo&#39;</span><span class="p">][</span><span class="s1">&#39;geometry&#39;</span><span class="p">][</span><span class="s1">&#39;coordinates&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">lon</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;geo&#39;</span><span class="p">][</span><span class="s1">&#39;geometry&#39;</span><span class="p">][</span><span class="s1">&#39;coordinates&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">if</span> <span class="s1">&#39;archiveType&#39;</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">archiveType</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lipdutils</span><span class="o">.</span><span class="n">LipdToOntology</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;archiveType&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">archiveType</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;other&#39;</span><span class="p">)</span>

        <span class="c1"># make sure criteria is in the plot_default list</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span><span class="n">val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">archiveType</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">val</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_default</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">archiveType</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;other&#39;</span>

        <span class="k">if</span> <span class="n">markersize</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">scatter_kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;s&#39;</span><span class="p">:</span> <span class="n">markersize</span><span class="p">})</span>

        <span class="k">if</span> <span class="n">marker</span><span class="o">==</span><span class="kc">None</span><span class="p">:</span>
            <span class="n">marker</span><span class="o">=</span><span class="p">[]</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">archiveType</span><span class="p">:</span>
                <span class="n">marker</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_default</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">color</span><span class="o">==</span><span class="kc">None</span><span class="p">:</span>
            <span class="n">color</span><span class="o">=</span><span class="p">[]</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">archiveType</span><span class="p">:</span>
                <span class="n">color</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_default</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>

        <span class="n">res</span> <span class="o">=</span> <span class="n">mapping</span><span class="o">.</span><span class="n">map_all</span><span class="p">(</span><span class="n">lat</span><span class="o">=</span><span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="o">=</span><span class="n">lon</span><span class="p">,</span> <span class="n">criteria</span><span class="o">=</span><span class="n">archiveType</span><span class="p">,</span>
                              <span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span><span class="n">color</span><span class="p">,</span>
                              <span class="n">projection</span> <span class="o">=</span> <span class="n">projection</span><span class="p">,</span> <span class="n">proj_default</span> <span class="o">=</span> <span class="n">proj_default</span><span class="p">,</span>
                              <span class="n">background</span> <span class="o">=</span> <span class="n">background</span><span class="p">,</span><span class="n">borders</span> <span class="o">=</span> <span class="n">borders</span><span class="p">,</span>
                              <span class="n">rivers</span> <span class="o">=</span> <span class="n">rivers</span><span class="p">,</span> <span class="n">lakes</span> <span class="o">=</span> <span class="n">lakes</span><span class="p">,</span>
                              <span class="n">figsize</span> <span class="o">=</span> <span class="n">figsize</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="p">,</span>
                              <span class="n">scatter_kwargs</span><span class="o">=</span><span class="n">scatter_kwargs</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="n">legend</span><span class="p">,</span>
                              <span class="n">lgd_kwargs</span><span class="o">=</span><span class="n">lgd_kwargs</span><span class="p">,</span><span class="n">savefig_settings</span><span class="o">=</span><span class="n">savefig_settings</span><span class="p">,</span>
                              <span class="n">mute</span><span class="o">=</span><span class="n">mute</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">res</span></div></div>

    <span class="c1">#def mapNearRecord():</span>

        <span class="c1">#res={}</span>

        <span class="c1">#return res</span>

<div class="viewcode-block" id="LipdSeries"><a class="viewcode-back" href="../../../core/ui.html#pyleoclim.core.ui.LipdSeries">[docs]</a><span class="k">class</span> <span class="nc">LipdSeries</span><span class="p">(</span><span class="n">Series</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Lipd time series object</span>


<span class="sd">    These objects can be obtained from a LiPD either through Pyleoclim or the LiPD utilities.</span>
<span class="sd">    If multiple objects (i.e., list) is given, then the user will be prompted to choose one timeseries.</span>

<span class="sd">    LipdSeries is a child of Series, therefore all the methods available for Series apply to LipdSeries in addition to some specific methods.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>

<span class="sd">    In this example, we will import a LiPD file and explore the various options to create a series object.</span>

<span class="sd">    First, let&#39;s look at the Lipd.to_tso option. This method is attractive because the object is a list of dictionaries that are easily explored in Python.</span>

<span class="sd">    .. ipython:: python</span>
<span class="sd">        :okwarning:</span>

<span class="sd">        import pyleoclim as pyleo</span>
<span class="sd">        url = &#39;http://wiki.linked.earth/wiki/index.php/Special:WTLiPD?op=export&amp;lipdid=MD982176.Stott.2004&#39;</span>
<span class="sd">        data = pyleo.Lipd(usr_path = url)</span>
<span class="sd">        ts_list = data.to_tso()</span>
<span class="sd">        # Print out the dataset name and the variable name</span>
<span class="sd">        for item in ts_list:</span>
<span class="sd">            print(item[&#39;dataSetName&#39;]+&#39;: &#39;+item[&#39;paleoData_variableName&#39;])</span>
<span class="sd">        # Load the sst data into a LipdSeries. Since Python indexing starts at zero, sst has index 5.</span>
<span class="sd">        ts = pyleo.LipdSeries(ts_list[5])</span>

<span class="sd">    If you attempt to pass the full list of series, Pyleoclim will prompt you to choose a series by printing out something similar as above.</span>
<span class="sd">    If you already now the number of the timeseries object you&#39;re interested in, then you should use the following:</span>

<span class="sd">    .. ipython:: python</span>
<span class="sd">        :okwarning:</span>

<span class="sd">        ts1 = data.to_LipdSeries(number=5)</span>

<span class="sd">    If number is not specified, Pyleoclim will prompt you for the number automatically.</span>

<span class="sd">    Sometimes, one may want to create a MultipleSeries object from a collection of LiPD files. In this case, we recommend using the following:</span>

<span class="sd">    .. ipython:: python</span>
<span class="sd">        :okwarning:</span>

<span class="sd">        ts_list = data.to_LipdSeriesList()</span>
<span class="sd">        # only keep the Mg/Ca and SST</span>
<span class="sd">        ts_list=ts_list[4:]</span>
<span class="sd">        #create a MultipleSeries object</span>
<span class="sd">        ms=pyleo.MultipleSeries(ts_list)</span>


<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tso</span><span class="p">,</span> <span class="n">clean_ts</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">tso</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lipd_ts</span><span class="o">=</span><span class="n">lipdutils</span><span class="o">.</span><span class="n">getTs</span><span class="p">(</span><span class="n">tso</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lipd_ts</span><span class="o">=</span><span class="n">tso</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">plot_default</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;ice-other&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;#FFD600&#39;</span><span class="p">,</span><span class="s1">&#39;h&#39;</span><span class="p">],</span>
                <span class="s1">&#39;ice/rock&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;#FFD600&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">],</span>
                <span class="s1">&#39;coral&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;#FF8B00&#39;</span><span class="p">,</span><span class="s1">&#39;o&#39;</span><span class="p">],</span>
                <span class="s1">&#39;documents&#39;</span><span class="p">:[</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="s1">&#39;p&#39;</span><span class="p">],</span>
                <span class="s1">&#39;glacierice&#39;</span><span class="p">:[</span><span class="s1">&#39;#86CDFA&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">],</span>
                <span class="s1">&#39;hybrid&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;#00BEFF&#39;</span><span class="p">,</span><span class="s1">&#39;*&#39;</span><span class="p">],</span>
                <span class="s1">&#39;lakesediment&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;#4169E0&#39;</span><span class="p">,</span><span class="s1">&#39;s&#39;</span><span class="p">],</span>
                <span class="s1">&#39;marinesediment&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;#8A4513&#39;</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">],</span>
                <span class="s1">&#39;sclerosponge&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="s1">&#39;o&#39;</span><span class="p">],</span>
                <span class="s1">&#39;speleothem&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="s1">&#39;#FF1492&#39;</span><span class="p">,</span><span class="s1">&#39;d&#39;</span><span class="p">],</span>
                <span class="s1">&#39;wood&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="s1">&#39;#32CC32&#39;</span><span class="p">,</span><span class="s1">&#39;^&#39;</span><span class="p">],</span>
                <span class="s1">&#39;molluskshells&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="s1">&#39;#FFD600&#39;</span><span class="p">,</span><span class="s1">&#39;h&#39;</span><span class="p">],</span>
                <span class="s1">&#39;peat&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="s1">&#39;#2F4F4F&#39;</span><span class="p">,</span><span class="s1">&#39;*&#39;</span><span class="p">],</span>
                <span class="s1">&#39;midden&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="s1">&#39;#824E2B&#39;</span><span class="p">,</span><span class="s1">&#39;o&#39;</span><span class="p">],</span>
                <span class="s1">&#39;other&#39;</span><span class="p">:[</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="s1">&#39;o&#39;</span><span class="p">]}</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">time</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span> <span class="n">lipdutils</span><span class="o">.</span><span class="n">checkTimeAxis</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lipd_ts</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">label</span><span class="o">==</span><span class="s1">&#39;age&#39;</span><span class="p">:</span>
                <span class="n">time_name</span><span class="o">=</span><span class="s1">&#39;Age&#39;</span>
                <span class="k">if</span> <span class="s1">&#39;ageUnits&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lipd_ts</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">time_unit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lipd_ts</span><span class="p">[</span><span class="s1">&#39;ageUnits&#39;</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">time_unit</span><span class="o">=</span><span class="kc">None</span>
            <span class="k">elif</span> <span class="n">label</span><span class="o">==</span><span class="s1">&#39;year&#39;</span><span class="p">:</span>
                <span class="n">time_name</span><span class="o">=</span><span class="s1">&#39;Year&#39;</span>
                <span class="k">if</span> <span class="s1">&#39;yearUnits&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lipd_ts</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">time_unit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lipd_ts</span><span class="p">[</span><span class="s1">&#39;yearUnits&#39;</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">time_unit</span><span class="o">=</span><span class="kc">None</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lipd_ts</span><span class="p">[</span><span class="s1">&#39;mode&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;paleoData&#39;</span><span class="p">:</span>
                    <span class="n">value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lipd_ts</span><span class="p">[</span><span class="s1">&#39;paleoData_values&#39;</span><span class="p">],</span><span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float64&#39;</span><span class="p">)</span>
                    <span class="c1">#Remove NaNs</span>
                    <span class="c1">#ys_tmp=np.copy(value)</span>
                    <span class="c1">#value=value[~np.isnan(ys_tmp)]</span>
                    <span class="c1">#time=time[~np.isnan(ys_tmp)]</span>
                    <span class="n">value_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lipd_ts</span><span class="p">[</span><span class="s1">&#39;paleoData_variableName&#39;</span><span class="p">]</span>
                    <span class="k">if</span> <span class="s1">&#39;paleoData_units&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lipd_ts</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="n">value_unit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lipd_ts</span><span class="p">[</span><span class="s1">&#39;paleoData_units&#39;</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">value_unit</span><span class="o">=</span><span class="kc">None</span>
                    <span class="n">label</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lipd_ts</span><span class="p">[</span><span class="s1">&#39;dataSetName&#39;</span><span class="p">]</span>
                    <span class="nb">super</span><span class="p">(</span><span class="n">LipdSeries</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">,</span><span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">,</span><span class="n">time_name</span><span class="o">=</span><span class="n">time_name</span><span class="p">,</span>
                         <span class="n">time_unit</span><span class="o">=</span><span class="n">time_unit</span><span class="p">,</span><span class="n">value_name</span><span class="o">=</span><span class="n">value_name</span><span class="p">,</span><span class="n">value_unit</span><span class="o">=</span><span class="n">value_unit</span><span class="p">,</span>
                         <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span><span class="n">clean_ts</span><span class="o">=</span><span class="n">clean_ts</span><span class="p">)</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">lipd_ts</span><span class="p">[</span><span class="s1">&#39;mode&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;chronData&#39;</span><span class="p">:</span>
                    <span class="n">value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lipd_ts</span><span class="p">[</span><span class="s1">&#39;chronData_values&#39;</span><span class="p">],</span><span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float64&#39;</span><span class="p">)</span>
                    <span class="c1">#Remove NaNs</span>
                    <span class="c1">#ys_tmp=np.copy(value)</span>
                    <span class="c1">#value=value[~np.isnan(ys_tmp)]</span>
                    <span class="c1">#time=time[~np.isnan(ys_tmp)]</span>
                    <span class="n">value_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lipd_ts</span><span class="p">[</span><span class="s1">&#39;chronData_variableName&#39;</span><span class="p">]</span>
                    <span class="k">if</span> <span class="s1">&#39;paleoData_units&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lipd_ts</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="n">value_unit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lipd_ts</span><span class="p">[</span><span class="s1">&#39;chronData_units&#39;</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">value_unit</span><span class="o">=</span><span class="kc">None</span>
                    <span class="n">label</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lipd_ts</span><span class="p">[</span><span class="s1">&#39;dataSetName&#39;</span><span class="p">]</span>
                    <span class="nb">super</span><span class="p">(</span><span class="n">LipdSeries</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">,</span><span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">,</span><span class="n">time_name</span><span class="o">=</span><span class="n">time_name</span><span class="p">,</span>
                         <span class="n">time_unit</span><span class="o">=</span><span class="n">time_unit</span><span class="p">,</span><span class="n">value_name</span><span class="o">=</span><span class="n">value_name</span><span class="p">,</span><span class="n">value_unit</span><span class="o">=</span><span class="n">value_unit</span><span class="p">,</span>
                         <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span><span class="n">clean_ts</span><span class="o">=</span><span class="n">clean_ts</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;paleoData_values should contain floats&quot;</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">&quot;No time information present&quot;</span><span class="p">)</span>


<div class="viewcode-block" id="LipdSeries.copy"><a class="viewcode-back" href="../../../core/ui.html#pyleoclim.core.ui.LipdSeries.copy">[docs]</a>    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Copy the object</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="LipdSeries.chronEnsembleToPaleo"><a class="viewcode-back" href="../../../core/ui.html#pyleoclim.core.ui.LipdSeries.chronEnsembleToPaleo">[docs]</a>    <span class="k">def</span> <span class="nf">chronEnsembleToPaleo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">D</span><span class="p">,</span><span class="n">modelNumber</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">tableNumber</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Fetch chron ensembles from a lipd object and return the ensemble as MultipleSeries</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        D : a LiPD object</span>
<span class="sd">        modelNumber : int, optional</span>
<span class="sd">            Age model number. The default is None.</span>
<span class="sd">        tableNumber : int, optional</span>
<span class="sd">            Table Number. The default is None.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            DESCRIPTION.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ms : pyleoclim.EnsembleSeries</span>
<span class="sd">            An EnsembleSeries object with each series representing a possible realization of the age model</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1">#get the corresponding LiPD</span>
        <span class="n">dataSetName</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lipd_ts</span><span class="p">[</span><span class="s1">&#39;dataSetName&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">D</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">dict</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">lipd</span><span class="o">=</span><span class="n">D</span><span class="p">[</span><span class="n">dataSetName</span><span class="p">]</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">lipd</span><span class="o">=</span><span class="n">D</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">a</span><span class="o">=</span><span class="n">D</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="n">dataSetName</span><span class="p">)</span>
            <span class="n">lipd</span><span class="o">=</span><span class="n">a</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s1">&#39;lipd&#39;</span><span class="p">]</span>
        <span class="c1">#Look for the ensemble and get values</span>
        <span class="n">cwd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
        <span class="n">csv_dict</span><span class="o">=</span><span class="n">lpd</span><span class="o">.</span><span class="n">getCsv</span><span class="p">(</span><span class="n">lipd</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">cwd</span><span class="p">)</span>
        <span class="n">chron</span><span class="p">,</span><span class="n">paleo</span> <span class="o">=</span> <span class="n">lipdutils</span><span class="o">.</span><span class="n">isEnsemble</span><span class="p">(</span><span class="n">csv_dict</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">chron</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No ChronMeasurementTables available&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">chron</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">modelNumber</span><span class="o">==</span><span class="kc">None</span> <span class="ow">or</span> <span class="n">tableNumber</span><span class="o">==</span><span class="kc">None</span><span class="p">:</span>
                <span class="n">csvName</span><span class="o">=</span><span class="n">lipdutils</span><span class="o">.</span><span class="n">whichEnsemble</span><span class="p">(</span><span class="n">chron</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">str1</span><span class="o">=</span><span class="s1">&#39;model&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">modelNumber</span><span class="p">)</span>
                <span class="n">str2</span><span class="o">=</span><span class="s1">&#39;ensemble&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">tableNumber</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">chron</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">str1</span> <span class="ow">in</span> <span class="n">item</span> <span class="ow">and</span> <span class="n">str2</span> <span class="ow">in</span> <span class="n">item</span><span class="p">:</span>
                        <span class="n">csvName</span><span class="o">=</span><span class="n">item</span>
            <span class="n">depth</span><span class="p">,</span> <span class="n">ensembleValues</span> <span class="o">=</span><span class="n">lipdutils</span><span class="o">.</span><span class="n">getEnsemble</span><span class="p">(</span><span class="n">csv_dict</span><span class="p">,</span><span class="n">csvName</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">depth</span><span class="p">,</span> <span class="n">ensembleValues</span> <span class="o">=</span><span class="n">lipdutils</span><span class="o">.</span><span class="n">getEnsemble</span><span class="p">(</span><span class="n">csv_dict</span><span class="p">,</span><span class="n">chron</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="c1">#make sure it&#39;s sorted</span>
        <span class="n">sort_ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">depth</span><span class="p">)</span>
        <span class="n">depth</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">depth</span><span class="p">)[</span><span class="n">sort_ind</span><span class="p">])</span>
        <span class="n">ensembleValues</span><span class="o">=</span><span class="n">ensembleValues</span><span class="p">[</span><span class="n">sort_ind</span><span class="p">,:]</span>
        <span class="c1">#Map to paleovalues</span>
        <span class="n">key</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lipd_ts</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="s1">&#39;depth&#39;</span> <span class="ow">in</span> <span class="n">item</span> <span class="ow">and</span> <span class="s1">&#39;Units&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">item</span><span class="p">:</span>
                <span class="n">key</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">ds</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lipd_ts</span><span class="p">[</span><span class="n">key</span><span class="p">],</span><span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float64&#39;</span><span class="p">)</span>
        <span class="n">ys</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lipd_ts</span><span class="p">[</span><span class="s1">&#39;paleoData_values&#39;</span><span class="p">],</span><span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float64&#39;</span><span class="p">)</span>
        <span class="c1">#Remove NaNs</span>
        <span class="n">ys_tmp</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">ys</span><span class="p">)</span>
        <span class="n">ds</span><span class="o">=</span><span class="n">ds</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">ys_tmp</span><span class="p">)]</span>
        <span class="n">sort_ind2</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span>
        <span class="n">ds</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ds</span><span class="p">[</span><span class="n">sort_ind2</span><span class="p">])</span>
        <span class="n">ys</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ys</span><span class="p">[</span><span class="n">sort_ind2</span><span class="p">])</span>
        <span class="n">ensembleValuestoPaleo</span><span class="o">=</span><span class="n">lipdutils</span><span class="o">.</span><span class="n">mapAgeEnsembleToPaleoData</span><span class="p">(</span><span class="n">ensembleValues</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">ds</span><span class="p">)</span>
        <span class="c1">#create multipleseries</span>
        <span class="n">s_list</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ensembleValuestoPaleo</span><span class="o">.</span><span class="n">T</span><span class="p">):</span>
            <span class="n">s_tmp</span> <span class="o">=</span> <span class="n">Series</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">s</span><span class="p">,</span><span class="n">value</span><span class="o">=</span><span class="n">ys</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">i</span><span class="o">==</span><span class="mi">0</span><span class="p">,</span> <span class="n">clean_ts</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">s_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s_tmp</span><span class="p">)</span>

        <span class="n">ens</span> <span class="o">=</span> <span class="n">EnsembleSeries</span><span class="p">(</span><span class="n">series_list</span><span class="o">=</span><span class="n">s_list</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ens</span></div>

<div class="viewcode-block" id="LipdSeries.map"><a class="viewcode-back" href="../../../core/ui.html#pyleoclim.core.ui.LipdSeries.map">[docs]</a>    <span class="k">def</span> <span class="nf">map</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">projection</span> <span class="o">=</span> <span class="s1">&#39;Orthographic&#39;</span><span class="p">,</span> <span class="n">proj_default</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
           <span class="n">background</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span><span class="n">borders</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">rivers</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">lakes</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
           <span class="n">figsize</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
           <span class="n">markersize</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">scatter_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
           <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">lgd_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">savefig_settings</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mute</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Map the location of the record</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        projection : str, optional</span>
<span class="sd">            The projection to use. The default is &#39;Robinson&#39;.</span>
<span class="sd">        proj_default : bool, optional</span>
<span class="sd">            Wether to use the Pyleoclim defaults for each projection type. The default is True.</span>
<span class="sd">        background : bool, optional</span>
<span class="sd">            Wether to use a backgound. The default is True.</span>
<span class="sd">        borders : bool, optional</span>
<span class="sd">            Draw borders. The default is False.</span>
<span class="sd">        rivers : bool, optional</span>
<span class="sd">            Draw rivers. The default is False.</span>
<span class="sd">        lakes : bool, optional</span>
<span class="sd">            Draw lakes. The default is False.</span>
<span class="sd">        figsize : list, optional</span>
<span class="sd">            The size of the figure. The default is None.</span>
<span class="sd">        ax : matplotlib.ax, optional</span>
<span class="sd">            The matplotlib axis onto which to return the map. The default is None.</span>
<span class="sd">        marker : str, optional</span>
<span class="sd">            The marker type for each archive. The default is None. Uses plot_default</span>
<span class="sd">        color : str, optional</span>
<span class="sd">            Color for each acrhive. The default is None. Uses plot_default</span>
<span class="sd">        markersize : float, optional</span>
<span class="sd">            Size of the marker. The default is None.</span>
<span class="sd">        scatter_kwargs : dict, optional</span>
<span class="sd">            Parameters for the scatter plot. The default is None.</span>
<span class="sd">        legend : bool, optional</span>
<span class="sd">            Whether to plot the legend. The default is True.</span>
<span class="sd">        lgd_kwargs : dict, optional</span>
<span class="sd">            Arguments for the legend. The default is None.</span>
<span class="sd">        savefig_settings : dictionary, optional</span>
<span class="sd">            the dictionary of arguments for plt.savefig(); some notes below:</span>
<span class="sd">            - &quot;path&quot; must be specified; it can be any existed or non-existed path,</span>
<span class="sd">              with or without a suffix; if the suffix is not given in &quot;path&quot;, it will follow &quot;format&quot;</span>
<span class="sd">            - &quot;format&quot; can be one of {&quot;pdf&quot;, &quot;eps&quot;, &quot;png&quot;, &quot;ps&quot;}. The default is None.</span>
<span class="sd">        mute : bool, optional</span>
<span class="sd">            if True, the plot will not show;</span>
<span class="sd">            recommend to turn on when more modifications are going to be made on ax. The default is False.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        res : fig</span>

<span class="sd">        See also</span>
<span class="sd">        --------</span>

<span class="sd">        pyleoclim.utils.mapping.map_all : Underlying mapping function for Pyleoclim</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        .. ipython:: python</span>
<span class="sd">            :okwarning:</span>

<span class="sd">            import pyleoclim as pyleo</span>
<span class="sd">            url = &#39;http://wiki.linked.earth/wiki/index.php/Special:WTLiPD?op=export&amp;lipdid=MD982176.Stott.2004&#39;</span>
<span class="sd">            data = pyleo.Lipd(usr_path = url)</span>
<span class="sd">            ts = data.to_LipdSeries(number=5)</span>
<span class="sd">            @savefig mapone.png</span>
<span class="sd">            fig, ax = ts.map()</span>
<span class="sd">            pyleo.closefig(fig)</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">scatter_kwargs</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">scatter_kwargs</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">scatter_kwargs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="c1">#get the information from the timeseries</span>
        <span class="n">lat</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">lipd_ts</span><span class="p">[</span><span class="s1">&#39;geo_meanLat&#39;</span><span class="p">]]</span>
        <span class="n">lon</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">lipd_ts</span><span class="p">[</span><span class="s1">&#39;geo_meanLon&#39;</span><span class="p">]]</span>
        <span class="n">lon</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">lipd_ts</span><span class="p">[</span><span class="s1">&#39;geo_meanLon&#39;</span><span class="p">]]</span>
        <span class="k">if</span> <span class="s1">&#39;archiveType&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lipd_ts</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">archiveType</span><span class="o">=</span><span class="n">lipdutils</span><span class="o">.</span><span class="n">LipdToOntology</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lipd_ts</span><span class="p">[</span><span class="s1">&#39;archiveType&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">archiveType</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;other&#39;</span><span class="p">)</span>

        <span class="c1"># make sure criteria is in the plot_default list</span>
        <span class="k">if</span> <span class="n">archiveType</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_default</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">archiveType</span> <span class="o">=</span> <span class="s1">&#39;other&#39;</span>

        <span class="k">if</span> <span class="n">markersize</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">scatter_kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;s&#39;</span><span class="p">:</span> <span class="n">markersize</span><span class="p">})</span>

        <span class="k">if</span> <span class="n">marker</span><span class="o">==</span><span class="kc">None</span><span class="p">:</span>
            <span class="n">marker</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_default</span><span class="p">[</span><span class="n">archiveType</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">color</span><span class="o">==</span><span class="kc">None</span><span class="p">:</span>
            <span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_default</span><span class="p">[</span><span class="n">archiveType</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">proj_default</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>
            <span class="n">proj1</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;central_latitude&#39;</span><span class="p">:</span><span class="n">lat</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                   <span class="s1">&#39;central_longitude&#39;</span><span class="p">:</span><span class="n">lon</span><span class="p">[</span><span class="mi">0</span><span class="p">]}</span>
            <span class="n">proj2</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;central_latitude&#39;</span><span class="p">:</span><span class="n">lat</span><span class="p">[</span><span class="mi">0</span><span class="p">]}</span>
            <span class="n">proj3</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;central_longitude&#39;</span><span class="p">:</span><span class="n">lon</span><span class="p">[</span><span class="mi">0</span><span class="p">]}</span>

        <span class="n">archiveType</span><span class="o">=</span><span class="p">[</span><span class="n">archiveType</span><span class="p">]</span> <span class="c1">#list so it will work with map_all</span>
        <span class="n">marker</span><span class="o">=</span><span class="p">[</span><span class="n">marker</span><span class="p">]</span>
        <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="n">color</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">proj_default</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">res</span> <span class="o">=</span> <span class="n">mapping</span><span class="o">.</span><span class="n">map_all</span><span class="p">(</span><span class="n">lat</span><span class="o">=</span><span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="o">=</span><span class="n">lon</span><span class="p">,</span> <span class="n">criteria</span><span class="o">=</span><span class="n">archiveType</span><span class="p">,</span>
                              <span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span><span class="n">color</span><span class="p">,</span>
                              <span class="n">projection</span> <span class="o">=</span> <span class="n">projection</span><span class="p">,</span> <span class="n">proj_default</span> <span class="o">=</span> <span class="n">proj1</span><span class="p">,</span>
                              <span class="n">background</span> <span class="o">=</span> <span class="n">background</span><span class="p">,</span><span class="n">borders</span> <span class="o">=</span> <span class="n">borders</span><span class="p">,</span>
                              <span class="n">rivers</span> <span class="o">=</span> <span class="n">rivers</span><span class="p">,</span> <span class="n">lakes</span> <span class="o">=</span> <span class="n">lakes</span><span class="p">,</span>
                              <span class="n">figsize</span> <span class="o">=</span> <span class="n">figsize</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="p">,</span>
                              <span class="n">scatter_kwargs</span><span class="o">=</span><span class="n">scatter_kwargs</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="n">legend</span><span class="p">,</span>
                              <span class="n">lgd_kwargs</span><span class="o">=</span><span class="n">lgd_kwargs</span><span class="p">,</span><span class="n">savefig_settings</span><span class="o">=</span><span class="n">savefig_settings</span><span class="p">,</span>
                              <span class="n">mute</span><span class="o">=</span><span class="n">mute</span><span class="p">)</span>

            <span class="k">except</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">res</span> <span class="o">=</span> <span class="n">mapping</span><span class="o">.</span><span class="n">map_all</span><span class="p">(</span><span class="n">lat</span><span class="o">=</span><span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="o">=</span><span class="n">lon</span><span class="p">,</span> <span class="n">criteria</span><span class="o">=</span><span class="n">archiveType</span><span class="p">,</span>
                              <span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span><span class="n">color</span><span class="p">,</span>
                              <span class="n">projection</span> <span class="o">=</span> <span class="n">projection</span><span class="p">,</span> <span class="n">proj_default</span> <span class="o">=</span> <span class="n">proj3</span><span class="p">,</span>
                              <span class="n">background</span> <span class="o">=</span> <span class="n">background</span><span class="p">,</span><span class="n">borders</span> <span class="o">=</span> <span class="n">borders</span><span class="p">,</span>
                              <span class="n">rivers</span> <span class="o">=</span> <span class="n">rivers</span><span class="p">,</span> <span class="n">lakes</span> <span class="o">=</span> <span class="n">lakes</span><span class="p">,</span>
                              <span class="n">figsize</span> <span class="o">=</span> <span class="n">figsize</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="p">,</span>
                              <span class="n">scatter_kwargs</span><span class="o">=</span><span class="n">scatter_kwargs</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="n">legend</span><span class="p">,</span>
                              <span class="n">lgd_kwargs</span><span class="o">=</span><span class="n">lgd_kwargs</span><span class="p">,</span><span class="n">savefig_settings</span><span class="o">=</span><span class="n">savefig_settings</span><span class="p">,</span>
                              <span class="n">mute</span><span class="o">=</span><span class="n">mute</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">res</span> <span class="o">=</span> <span class="n">mapping</span><span class="o">.</span><span class="n">map_all</span><span class="p">(</span><span class="n">lat</span><span class="o">=</span><span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="o">=</span><span class="n">lon</span><span class="p">,</span> <span class="n">criteria</span><span class="o">=</span><span class="n">archiveType</span><span class="p">,</span>
                              <span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span><span class="n">color</span><span class="p">,</span>
                              <span class="n">projection</span> <span class="o">=</span> <span class="n">projection</span><span class="p">,</span> <span class="n">proj_default</span> <span class="o">=</span> <span class="n">proj2</span><span class="p">,</span>
                              <span class="n">background</span> <span class="o">=</span> <span class="n">background</span><span class="p">,</span><span class="n">borders</span> <span class="o">=</span> <span class="n">borders</span><span class="p">,</span>
                              <span class="n">rivers</span> <span class="o">=</span> <span class="n">rivers</span><span class="p">,</span> <span class="n">lakes</span> <span class="o">=</span> <span class="n">lakes</span><span class="p">,</span>
                              <span class="n">figsize</span> <span class="o">=</span> <span class="n">figsize</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="p">,</span>
                              <span class="n">scatter_kwargs</span><span class="o">=</span><span class="n">scatter_kwargs</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="n">legend</span><span class="p">,</span>
                              <span class="n">lgd_kwargs</span><span class="o">=</span><span class="n">lgd_kwargs</span><span class="p">,</span><span class="n">savefig_settings</span><span class="o">=</span><span class="n">savefig_settings</span><span class="p">,</span>
                              <span class="n">mute</span><span class="o">=</span><span class="n">mute</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">mapping</span><span class="o">.</span><span class="n">map_all</span><span class="p">(</span><span class="n">lat</span><span class="o">=</span><span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="o">=</span><span class="n">lon</span><span class="p">,</span> <span class="n">criteria</span><span class="o">=</span><span class="n">archiveType</span><span class="p">,</span>
                              <span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span><span class="n">color</span><span class="p">,</span>
                              <span class="n">projection</span> <span class="o">=</span> <span class="n">projection</span><span class="p">,</span> <span class="n">proj_default</span> <span class="o">=</span> <span class="n">proj_default</span><span class="p">,</span>
                              <span class="n">background</span> <span class="o">=</span> <span class="n">background</span><span class="p">,</span><span class="n">borders</span> <span class="o">=</span> <span class="n">borders</span><span class="p">,</span>
                              <span class="n">rivers</span> <span class="o">=</span> <span class="n">rivers</span><span class="p">,</span> <span class="n">lakes</span> <span class="o">=</span> <span class="n">lakes</span><span class="p">,</span>
                              <span class="n">figsize</span> <span class="o">=</span> <span class="n">figsize</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="p">,</span>
                              <span class="n">scatter_kwargs</span><span class="o">=</span><span class="n">scatter_kwargs</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="n">legend</span><span class="p">,</span>
                              <span class="n">lgd_kwargs</span><span class="o">=</span><span class="n">lgd_kwargs</span><span class="p">,</span><span class="n">savefig_settings</span><span class="o">=</span><span class="n">savefig_settings</span><span class="p">,</span>
                              <span class="n">mute</span><span class="o">=</span><span class="n">mute</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">res</span></div>

<div class="viewcode-block" id="LipdSeries.getMetadata"><a class="viewcode-back" href="../../../core/ui.html#pyleoclim.core.ui.LipdSeries.getMetadata">[docs]</a>    <span class="k">def</span> <span class="nf">getMetadata</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot; Get the necessary metadata for the ensemble plots</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        timeseries : object</span>
<span class="sd">                    a specific timeseries object.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        res : dict</span>
<span class="sd">                  A dictionary containing the following metadata:</span>
<span class="sd">                    archiveType</span>
<span class="sd">                    Authors (if more than 2, replace by et al)</span>
<span class="sd">                    PublicationYear</span>
<span class="sd">                    Publication DOI</span>
<span class="sd">                    Variable Name</span>
<span class="sd">                    Units</span>
<span class="sd">                    Climate Interpretation</span>
<span class="sd">                    Calibration Equation</span>
<span class="sd">                    Calibration References</span>
<span class="sd">                    Calibration Notes</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Get all the necessary information</span>
        <span class="c1"># Top level information</span>
        <span class="k">if</span> <span class="s2">&quot;archiveType&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lipd_ts</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">archiveType</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lipd_ts</span><span class="p">[</span><span class="s2">&quot;archiveType&quot;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">archiveType</span> <span class="o">=</span> <span class="s2">&quot;NA&quot;</span>

        <span class="k">if</span> <span class="s2">&quot;pub1_author&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lipd_ts</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">authors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lipd_ts</span><span class="p">[</span><span class="s2">&quot;pub1_author&quot;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">authors</span> <span class="o">=</span> <span class="s2">&quot;NA&quot;</span>

        <span class="c1">#Truncate if more than two authors</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="p">[</span><span class="n">pos</span> <span class="k">for</span> <span class="n">pos</span><span class="p">,</span> <span class="n">char</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">authors</span><span class="p">)</span> <span class="k">if</span> <span class="n">char</span> <span class="o">==</span> <span class="s2">&quot;;&quot;</span><span class="p">]</span>
        <span class="k">if</span>  <span class="nb">len</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">2</span><span class="p">:</span>
            <span class="n">authors</span> <span class="o">=</span> <span class="n">authors</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">idx</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;et al.&quot;</span>

        <span class="k">if</span> <span class="s2">&quot;pub1_year&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lipd_ts</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">Year</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lipd_ts</span><span class="p">[</span><span class="s2">&quot;pub1_year&quot;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Year</span> <span class="o">=</span> <span class="s2">&quot;NA&quot;</span>

        <span class="k">if</span> <span class="s2">&quot;pub1_doi&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lipd_ts</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">DOI</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lipd_ts</span><span class="p">[</span><span class="s2">&quot;pub1_doi&quot;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">DOI</span> <span class="o">=</span> <span class="s2">&quot;NA&quot;</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lipd_ts</span><span class="p">[</span><span class="s1">&#39;mode&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;paleoData&#39;</span><span class="p">:</span>
            <span class="n">prefix</span> <span class="o">=</span> <span class="s1">&#39;paleo&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">prefix</span> <span class="o">=</span> <span class="s1">&#39;chron&#39;</span>

        <span class="k">if</span> <span class="n">prefix</span><span class="o">+</span><span class="s2">&quot;Data_InferredVariableType&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lipd_ts</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lipd_ts</span><span class="p">[</span><span class="n">prefix</span><span class="o">+</span><span class="s2">&quot;Data_InferredVariableType&quot;</span><span class="p">])</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
                <span class="n">Variable</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lipd_ts</span><span class="p">[</span><span class="n">prefix</span><span class="o">+</span><span class="s2">&quot;Data_InferredVariableType&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">Variable</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lipd_ts</span><span class="p">[</span><span class="n">prefix</span><span class="o">+</span><span class="s2">&quot;Data_InferredVariableType&quot;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">prefix</span><span class="o">+</span><span class="s2">&quot;Data_ProxyObservationType&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lipd_ts</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lipd_ts</span><span class="p">[</span><span class="n">prefix</span><span class="o">+</span><span class="s2">&quot;Data_ProxyObservationType&quot;</span><span class="p">])</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
                <span class="n">Variable</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lipd_ts</span><span class="p">[</span><span class="n">prefix</span><span class="o">+</span><span class="s2">&quot;Data_ProxyObservationType&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">Variable</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lipd_ts</span><span class="p">[</span><span class="n">prefix</span><span class="o">+</span><span class="s2">&quot;Data_ProxyObservationType&quot;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Variable</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lipd_ts</span><span class="p">[</span><span class="n">prefix</span><span class="o">+</span><span class="s2">&quot;Data_variableName&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">prefix</span><span class="o">+</span><span class="s2">&quot;Data_units&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lipd_ts</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">units</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lipd_ts</span><span class="p">[</span><span class="n">prefix</span><span class="o">+</span><span class="s2">&quot;Data_units&quot;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">units</span> <span class="o">=</span> <span class="s2">&quot;NA&quot;</span>

        <span class="c1">#Climate interpretation information</span>
        <span class="k">if</span> <span class="n">prefix</span><span class="o">+</span><span class="s2">&quot;Data_interpretation&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lipd_ts</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">interpretation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lipd_ts</span><span class="p">[</span><span class="n">prefix</span><span class="o">+</span><span class="s2">&quot;Data_interpretation&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="s2">&quot;name&quot;</span> <span class="ow">in</span> <span class="n">interpretation</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">ClimateVar</span> <span class="o">=</span> <span class="n">interpretation</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
            <span class="k">elif</span> <span class="s2">&quot;variable&quot;</span> <span class="ow">in</span> <span class="n">interpretation</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">ClimateVar</span> <span class="o">=</span> <span class="n">interpretation</span><span class="p">[</span><span class="s2">&quot;variable&quot;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ClimateVar</span> <span class="o">=</span> <span class="s2">&quot;NA&quot;</span>
            <span class="k">if</span> <span class="s2">&quot;detail&quot;</span> <span class="ow">in</span> <span class="n">interpretation</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">Detail</span> <span class="o">=</span> <span class="n">interpretation</span><span class="p">[</span><span class="s2">&quot;detail&quot;</span><span class="p">]</span>
            <span class="k">elif</span> <span class="s2">&quot;variableDetail&quot;</span> <span class="ow">in</span> <span class="n">interpretation</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">Detail</span> <span class="o">=</span> <span class="n">interpretation</span><span class="p">[</span><span class="s1">&#39;variableDetail&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">Detail</span> <span class="o">=</span> <span class="s2">&quot;NA&quot;</span>
            <span class="k">if</span> <span class="s2">&quot;scope&quot;</span> <span class="ow">in</span> <span class="n">interpretation</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">Scope</span> <span class="o">=</span> <span class="n">interpretation</span><span class="p">[</span><span class="s1">&#39;scope&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">Scope</span> <span class="o">=</span> <span class="s2">&quot;NA&quot;</span>
            <span class="k">if</span> <span class="s2">&quot;seasonality&quot;</span> <span class="ow">in</span> <span class="n">interpretation</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">Seasonality</span> <span class="o">=</span> <span class="n">interpretation</span><span class="p">[</span><span class="s2">&quot;seasonality&quot;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">Seasonality</span> <span class="o">=</span> <span class="s2">&quot;NA&quot;</span>
            <span class="k">if</span> <span class="s2">&quot;interpdirection&quot;</span> <span class="ow">in</span> <span class="n">interpretation</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">Direction</span> <span class="o">=</span> <span class="n">interpretation</span><span class="p">[</span><span class="s2">&quot;interpdirection&quot;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">Direction</span> <span class="o">=</span> <span class="s2">&quot;NA&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ClimateVar</span> <span class="o">=</span> <span class="s2">&quot;NA&quot;</span>
            <span class="n">Detail</span> <span class="o">=</span> <span class="s2">&quot;NA&quot;</span>
            <span class="n">Scope</span> <span class="o">=</span> <span class="s2">&quot;NA&quot;</span>
            <span class="n">Seasonality</span> <span class="o">=</span> <span class="s2">&quot;NA&quot;</span>
            <span class="n">Direction</span> <span class="o">=</span> <span class="s2">&quot;NA&quot;</span>

        <span class="c1"># Calibration information</span>
        <span class="k">if</span> <span class="n">prefix</span><span class="o">+</span><span class="s2">&quot;Data_calibration&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lipd_ts</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">calibration</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lipd_ts</span><span class="p">[</span><span class="n">prefix</span><span class="o">+</span><span class="s1">&#39;Data_calibration&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="s2">&quot;equation&quot;</span> <span class="ow">in</span> <span class="n">calibration</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">Calibration_equation</span> <span class="o">=</span> <span class="n">calibration</span><span class="p">[</span><span class="s2">&quot;equation&quot;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">Calibration_equation</span> <span class="o">=</span> <span class="s2">&quot;NA&quot;</span>
            <span class="k">if</span>  <span class="s2">&quot;calibrationReferences&quot;</span> <span class="ow">in</span> <span class="n">calibration</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">ref</span> <span class="o">=</span> <span class="n">calibration</span><span class="p">[</span><span class="s2">&quot;calibrationReferences&quot;</span><span class="p">]</span>
                <span class="k">if</span> <span class="s2">&quot;author&quot;</span> <span class="ow">in</span> <span class="n">ref</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">ref_author</span> <span class="o">=</span> <span class="n">ref</span><span class="p">[</span><span class="s2">&quot;author&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># get the first author</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ref_author</span> <span class="o">=</span> <span class="s2">&quot;NA&quot;</span>
                <span class="k">if</span>  <span class="s2">&quot;publicationYear&quot;</span> <span class="ow">in</span> <span class="n">ref</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">ref_year</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">ref</span><span class="p">[</span><span class="s2">&quot;publicationYear&quot;</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span> <span class="n">ref_year</span><span class="o">=</span><span class="s2">&quot;NA&quot;</span>
                <span class="n">Calibration_notes</span> <span class="o">=</span> <span class="n">ref_author</span> <span class="o">+</span><span class="s2">&quot;.&quot;</span><span class="o">+</span><span class="n">ref_year</span>
            <span class="k">elif</span> <span class="s2">&quot;notes&quot;</span> <span class="ow">in</span> <span class="n">calibration</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">Calibration_notes</span> <span class="o">=</span> <span class="n">calibration</span><span class="p">[</span><span class="s2">&quot;notes&quot;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span> <span class="n">Calibration_notes</span> <span class="o">=</span> <span class="s2">&quot;NA&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Calibration_equation</span> <span class="o">=</span> <span class="s2">&quot;NA&quot;</span>
            <span class="n">Calibration_notes</span> <span class="o">=</span> <span class="s2">&quot;NA&quot;</span>

        <span class="c1">#Truncate the notes if too long</span>
        <span class="n">charlim</span> <span class="o">=</span> <span class="mi">30</span><span class="p">;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Calibration_notes</span><span class="p">)</span><span class="o">&gt;</span><span class="n">charlim</span><span class="p">:</span>
            <span class="n">Calibration_notes</span> <span class="o">=</span> <span class="n">Calibration_notes</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">charlim</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot; ...&quot;</span>

        <span class="n">res</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;archiveType&quot;</span> <span class="p">:</span> <span class="n">archiveType</span><span class="p">,</span>
                    <span class="s2">&quot;authors&quot;</span> <span class="p">:</span> <span class="n">authors</span><span class="p">,</span>
                    <span class="s2">&quot;Year&quot;</span><span class="p">:</span> <span class="n">Year</span><span class="p">,</span>
                    <span class="s2">&quot;DOI&quot;</span><span class="p">:</span> <span class="n">DOI</span><span class="p">,</span>
                    <span class="s2">&quot;Variable&quot;</span><span class="p">:</span> <span class="n">Variable</span><span class="p">,</span>
                    <span class="s2">&quot;units&quot;</span><span class="p">:</span> <span class="n">units</span><span class="p">,</span>
                    <span class="s2">&quot;Climate_Variable&quot;</span> <span class="p">:</span> <span class="n">ClimateVar</span><span class="p">,</span>
                    <span class="s2">&quot;Detail&quot;</span> <span class="p">:</span> <span class="n">Detail</span><span class="p">,</span>
                    <span class="s2">&quot;Scope&quot;</span><span class="p">:</span><span class="n">Scope</span><span class="p">,</span>
                    <span class="s2">&quot;Seasonality&quot;</span> <span class="p">:</span> <span class="n">Seasonality</span><span class="p">,</span>
                    <span class="s2">&quot;Interpretation_Direction&quot;</span> <span class="p">:</span> <span class="n">Direction</span><span class="p">,</span>
                    <span class="s2">&quot;Calibration_equation&quot;</span> <span class="p">:</span> <span class="n">Calibration_equation</span><span class="p">,</span>
                    <span class="s2">&quot;Calibration_notes&quot;</span> <span class="p">:</span> <span class="n">Calibration_notes</span><span class="p">}</span>

        <span class="k">return</span> <span class="n">res</span></div>

<div class="viewcode-block" id="LipdSeries.dashboard"><a class="viewcode-back" href="../../../core/ui.html#pyleoclim.core.ui.LipdSeries.dashboard">[docs]</a>    <span class="k">def</span> <span class="nf">dashboard</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">[</span><span class="mi">11</span><span class="p">,</span><span class="mi">8</span><span class="p">],</span> <span class="n">plt_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">distplt_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">spectral_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">spectralsignif_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">spectralfig_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">map_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">metadata</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                  <span class="n">savefig_settings</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mute</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>


<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        figsize : list, optional</span>
<span class="sd">            Figure size. The default is [11,8].</span>
<span class="sd">        plt_kwargs : dict, optional</span>
<span class="sd">            Optional arguments for the timeseries plot. See Series.plot(). The default is None.</span>
<span class="sd">        distplt_kwargs : dict, optional</span>
<span class="sd">            Optional arguments for the distribution plot. See Series.distplot(). The default is None.</span>
<span class="sd">        spectral_kwargs : dict, optional</span>
<span class="sd">            Optional arguments for the spectral method. Default is to use Lomb-Scargle method. See Series.spectral(). The default is None.</span>
<span class="sd">        spectralsignif_kwargs : dict, optional</span>
<span class="sd">            Optional arguments to estimate the significance of the power spectrum. See PSD.signif_test. Note that the default number of simulations has been changed to 1000. The default is None.</span>
<span class="sd">        spectralfig_kwargs : dict, optional</span>
<span class="sd">            Optional arguments for the power spectrum figure. See PSD.plot(). The default is None.</span>
<span class="sd">        map_kwargs : dict, optional</span>
<span class="sd">            Optional arguments for the map. See LipdSeries.map(). The default is None.</span>
<span class="sd">        metadata : {True,False}, optional</span>
<span class="sd">            Whether or not to produce a dashboard with printed metadata. The default is True.</span>
<span class="sd">        savefig_settings : dict, optional</span>
<span class="sd">            the dictionary of arguments for plt.savefig(); some notes below:</span>
<span class="sd">            - &quot;path&quot; must be specified; it can be any existed or non-existed path,</span>
<span class="sd">              with or without a suffix; if the suffix is not given in &quot;path&quot;, it will follow &quot;format&quot;</span>
<span class="sd">            - &quot;format&quot; can be one of {&quot;pdf&quot;, &quot;eps&quot;, &quot;png&quot;, &quot;ps&quot;}.</span>
<span class="sd">            The default is None.</span>
<span class="sd">        mute : {True,False}, optional</span>
<span class="sd">            if True, the plot will not show;</span>
<span class="sd">            recommend to turn on when more modifications are going to be made on ax. The default is False.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        fig : matplotlib.figure</span>
<span class="sd">            The figure</span>
<span class="sd">        ax : matplolib.axis</span>
<span class="sd">            The axis.</span>

<span class="sd">        See also</span>
<span class="sd">        --------</span>

<span class="sd">        pyleoclim.Series.plot : plot a timeseries</span>

<span class="sd">        pyleoclim.Series.distplot : plot a distribution of the timeseries</span>

<span class="sd">        pyleoclim.Series.spectral : spectral analysis method.</span>

<span class="sd">        pyleoclim.PSD.signif_test : significance test for timeseries analysis</span>

<span class="sd">        pyleoclim.PSD.plot : plot power spectrum</span>

<span class="sd">        pyleoclim.LipdSeries.map : map location of dataset</span>

<span class="sd">        pyleolim.LipdSeries.getMetadata : get relevant metadata from the timeseries object</span>

<span class="sd">        pyleoclim.utils.mapping.map_all : Underlying mapping function for Pyleoclim</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        .. ipython:: python</span>
<span class="sd">            :okwarning:</span>

<span class="sd">            import pyleoclim as pyleo</span>
<span class="sd">            url = &#39;http://wiki.linked.earth/wiki/index.php/Special:WTLiPD?op=export&amp;lipdid=MD982176.Stott.2004&#39;</span>
<span class="sd">            data = pyleo.Lipd(usr_path = url)</span>
<span class="sd">            ts = data.to_LipdSeries(number=5)</span>
<span class="sd">            @savefig ts_dashboard.png</span>
<span class="sd">            fig, ax = ts.dashboard()</span>
<span class="sd">            pyleo.closefig(fig)</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">savefig_settings</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">savefig_settings</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">savefig_settings</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">res</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">getMetadata</span><span class="p">()</span>
        <span class="c1"># start plotting</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
        <span class="n">gs</span> <span class="o">=</span> <span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">gs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">right</span><span class="o">=</span><span class="mf">1.1</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">=</span><span class="p">{}</span>
       <span class="c1"># Plot the timeseries</span>
        <span class="n">plt_kwargs</span><span class="o">=</span><span class="p">{}</span> <span class="k">if</span> <span class="n">plt_kwargs</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">plt_kwargs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">ax</span><span class="p">[</span><span class="s1">&#39;ts&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">,:</span><span class="o">-</span><span class="mi">3</span><span class="p">])</span>
        <span class="n">plt_kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;ax&#39;</span><span class="p">:</span><span class="n">ax</span><span class="p">[</span><span class="s1">&#39;ts&#39;</span><span class="p">]})</span>
        <span class="c1"># use the defaults if color/markers not specified</span>
        <span class="k">if</span> <span class="s1">&#39;marker&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">plt_kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">archiveType</span> <span class="o">=</span> <span class="n">lipdutils</span><span class="o">.</span><span class="n">LipdToOntology</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="s1">&#39;archiveType&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="n">plt_kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;marker&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_default</span><span class="p">[</span><span class="n">archiveType</span><span class="p">][</span><span class="mi">1</span><span class="p">]})</span>
        <span class="k">if</span> <span class="s1">&#39;color&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">plt_kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">archiveType</span> <span class="o">=</span> <span class="n">lipdutils</span><span class="o">.</span><span class="n">LipdToOntology</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="s1">&#39;archiveType&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="n">plt_kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;color&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_default</span><span class="p">[</span><span class="n">archiveType</span><span class="p">][</span><span class="mi">0</span><span class="p">]})</span>
        <span class="n">ax</span><span class="p">[</span><span class="s1">&#39;ts&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">**</span><span class="n">plt_kwargs</span><span class="p">)</span>
        <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="s1">&#39;ts&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>

        <span class="c1">#plot the distplot</span>
        <span class="n">distplt_kwargs</span><span class="o">=</span><span class="p">{}</span> <span class="k">if</span> <span class="n">distplt_kwargs</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">distplt_kwargs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">ax</span><span class="p">[</span><span class="s1">&#39;dts&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">distplt_kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;ax&#39;</span><span class="p">:</span><span class="n">ax</span><span class="p">[</span><span class="s1">&#39;dts&#39;</span><span class="p">]})</span>
        <span class="n">distplt_kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;ylabel&#39;</span><span class="p">:</span><span class="s1">&#39;PDF&#39;</span><span class="p">})</span>
        <span class="n">distplt_kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;vertical&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">})</span>
        <span class="k">if</span> <span class="s1">&#39;color&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">distplt_kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">archiveType</span> <span class="o">=</span> <span class="n">lipdutils</span><span class="o">.</span><span class="n">LipdToOntology</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="s1">&#39;archiveType&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="n">distplt_kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;color&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_default</span><span class="p">[</span><span class="n">archiveType</span><span class="p">][</span><span class="mi">0</span><span class="p">]})</span>
        <span class="n">ax</span><span class="p">[</span><span class="s1">&#39;dts&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span><span class="o">**</span><span class="n">distplt_kwargs</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="s1">&#39;dts&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="n">ymin</span><span class="p">,</span><span class="n">ymax</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="s1">&#39;dts&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([])</span>
        <span class="n">ax</span><span class="p">[</span><span class="s1">&#39;dts&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="s1">&#39;dts&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>

        <span class="c1">#make the map - brute force since projection is not being returned properly</span>
        <span class="n">lat</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">lipd_ts</span><span class="p">[</span><span class="s1">&#39;geo_meanLat&#39;</span><span class="p">]]</span>
        <span class="n">lon</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">lipd_ts</span><span class="p">[</span><span class="s1">&#39;geo_meanLon&#39;</span><span class="p">]]</span>

        <span class="n">map_kwargs</span><span class="o">=</span><span class="p">{}</span> <span class="k">if</span> <span class="n">map_kwargs</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">map_kwargs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">if</span> <span class="s1">&#39;projection&#39;</span> <span class="ow">in</span> <span class="n">map_kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">projection</span><span class="o">=</span><span class="n">map_kwargs</span><span class="p">[</span><span class="s1">&#39;projection&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">projection</span><span class="o">=</span><span class="s1">&#39;Orthographic&#39;</span>
        <span class="k">if</span> <span class="s1">&#39;proj_default&#39;</span> <span class="ow">in</span> <span class="n">map_kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">proj_default</span><span class="o">=</span><span class="n">map_kwargs</span><span class="p">[</span><span class="s1">&#39;proj_default&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">proj_default</span><span class="o">=</span><span class="kc">True</span>
        <span class="k">if</span> <span class="n">proj_default</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>
            <span class="n">proj1</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;central_latitude&#39;</span><span class="p">:</span><span class="n">lat</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                   <span class="s1">&#39;central_longitude&#39;</span><span class="p">:</span><span class="n">lon</span><span class="p">[</span><span class="mi">0</span><span class="p">]}</span>
            <span class="n">proj2</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;central_latitude&#39;</span><span class="p">:</span><span class="n">lat</span><span class="p">[</span><span class="mi">0</span><span class="p">]}</span>
            <span class="n">proj3</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;central_longitude&#39;</span><span class="p">:</span><span class="n">lon</span><span class="p">[</span><span class="mi">0</span><span class="p">]}</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">proj</span> <span class="o">=</span> <span class="n">mapping</span><span class="o">.</span><span class="n">set_proj</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="n">projection</span><span class="p">,</span> <span class="n">proj_default</span><span class="o">=</span><span class="n">proj1</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">proj</span> <span class="o">=</span> <span class="n">mapping</span><span class="o">.</span><span class="n">set_proj</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="n">projection</span><span class="p">,</span> <span class="n">proj_default</span><span class="o">=</span><span class="n">proj3</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">proj</span> <span class="o">=</span> <span class="n">mapping</span><span class="o">.</span><span class="n">set_proj</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="n">projection</span><span class="p">,</span> <span class="n">proj_default</span><span class="o">=</span><span class="n">proj2</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;marker&#39;</span> <span class="ow">in</span> <span class="n">map_kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">marker</span> <span class="o">=</span> <span class="n">map_kwargs</span><span class="p">[</span><span class="s1">&#39;marker&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">marker</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_default</span><span class="p">[</span><span class="n">archiveType</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;color&#39;</span> <span class="ow">in</span> <span class="n">map_kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">color</span> <span class="o">=</span> <span class="n">map_kwargs</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_default</span><span class="p">[</span><span class="n">archiveType</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;background&#39;</span> <span class="ow">in</span> <span class="n">map_kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">background</span> <span class="o">=</span> <span class="n">map_kwargs</span><span class="p">[</span><span class="s1">&#39;background&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">background</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="s1">&#39;borders&#39;</span> <span class="ow">in</span> <span class="n">map_kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">borders</span><span class="o">=</span> <span class="n">map_kwargs</span><span class="p">[</span><span class="s1">&#39;borders&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">borders</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="s1">&#39;rivers&#39;</span> <span class="ow">in</span> <span class="n">map_kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">rivers</span><span class="o">=</span> <span class="n">map_kwargs</span><span class="p">[</span><span class="s1">&#39;rivers&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rivers</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="s1">&#39;lakes&#39;</span> <span class="ow">in</span> <span class="n">map_kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">lakes</span> <span class="o">=</span> <span class="n">map_kwargs</span><span class="p">[</span><span class="s1">&#39;lakes&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lakes</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="s1">&#39;scatter_kwargs&#39;</span> <span class="ow">in</span> <span class="n">map_kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">scatter_kwargs</span> <span class="o">=</span> <span class="n">map_kwargs</span><span class="p">[</span><span class="s1">&#39;scatter_kwargs&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">scatter_kwargs</span><span class="o">=</span><span class="p">{}</span>
        <span class="k">if</span> <span class="s1">&#39;markersize&#39;</span> <span class="ow">in</span> <span class="n">map_kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">scatter_kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;s&#39;</span><span class="p">:</span> <span class="n">map_kwargs</span><span class="p">[</span><span class="s1">&#39;markersize&#39;</span><span class="p">]})</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">if</span> <span class="s1">&#39;lgd_kwargs&#39;</span> <span class="ow">in</span> <span class="n">map_kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">lgd_kwargs</span> <span class="o">=</span> <span class="n">map_kwargs</span><span class="p">[</span><span class="s1">&#39;lgd_kwargs&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lgd_kwargs</span> <span class="o">=</span><span class="p">{}</span>
        <span class="k">if</span> <span class="s1">&#39;legend&#39;</span> <span class="ow">in</span> <span class="n">map_kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">legend</span> <span class="o">=</span> <span class="n">map_kwargs</span><span class="p">[</span><span class="s1">&#39;legend&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">legend</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1">#make the plot map</span>

        <span class="n">data_crs</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">()</span>
        <span class="n">ax</span><span class="p">[</span><span class="s1">&#39;map&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="n">projection</span><span class="o">=</span><span class="n">proj</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="s1">&#39;map&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">coastlines</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">background</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">ax</span><span class="p">[</span><span class="s1">&#39;map&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">stock_img</span><span class="p">()</span>
        <span class="c1">#Other extra information</span>
        <span class="k">if</span> <span class="n">borders</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">ax</span><span class="p">[</span><span class="s1">&#39;map&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cfeature</span><span class="o">.</span><span class="n">BORDERS</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">lakes</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">ax</span><span class="p">[</span><span class="s1">&#39;map&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cfeature</span><span class="o">.</span><span class="n">LAKES</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">rivers</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">ax</span><span class="p">[</span><span class="s1">&#39;map&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cfeature</span><span class="o">.</span><span class="n">RIVERS</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="s1">&#39;map&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span><span class="n">lat</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">marker</span><span class="p">,</span><span class="n">facecolor</span><span class="o">=</span><span class="n">color</span><span class="p">,</span><span class="n">transform</span><span class="o">=</span><span class="n">data_crs</span><span class="p">,</span> <span class="o">**</span><span class="n">scatter_kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">legend</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="o">**</span><span class="n">lgd_kwargs</span><span class="p">)</span>

        <span class="c1">#spectral analysis</span>
        <span class="n">spectral_kwargs</span><span class="o">=</span><span class="p">{}</span> <span class="k">if</span> <span class="n">spectral_kwargs</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">spectral_kwargs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">if</span> <span class="s1">&#39;method&#39;</span> <span class="ow">in</span> <span class="n">spectral_kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">spectral_kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;method&#39;</span><span class="p">:</span><span class="s1">&#39;lomb_scargle&#39;</span><span class="p">})</span>
        <span class="k">if</span> <span class="s1">&#39;freq_method&#39;</span> <span class="ow">in</span> <span class="n">spectral_kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">spectral_kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;freq_method&#39;</span><span class="p">:</span><span class="s1">&#39;lomb_scargle&#39;</span><span class="p">})</span>
        <span class="n">ts_preprocess</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">detrend</span><span class="p">()</span><span class="o">.</span><span class="n">standardize</span><span class="p">()</span>
        <span class="n">psd</span><span class="o">=</span><span class="n">ts_preprocess</span><span class="o">.</span><span class="n">spectral</span><span class="p">(</span><span class="o">**</span><span class="n">spectral_kwargs</span><span class="p">)</span>

        <span class="c1">#Significance test</span>
        <span class="n">spectralsignif_kwargs</span><span class="o">=</span><span class="p">{}</span> <span class="k">if</span> <span class="n">spectralsignif_kwargs</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">spectralsignif_kwargs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>


        <span class="n">psd_signif</span> <span class="o">=</span> <span class="n">psd</span><span class="o">.</span><span class="n">signif_test</span><span class="p">(</span><span class="o">**</span><span class="n">spectralsignif_kwargs</span><span class="p">)</span>

        <span class="c1">#Make the plot</span>
        <span class="n">spectralfig_kwargs</span><span class="o">=</span><span class="p">{}</span> <span class="k">if</span> <span class="n">spectralfig_kwargs</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">spectralfig_kwargs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">if</span> <span class="s1">&#39;color&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">spectralfig_kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">archiveType</span> <span class="o">=</span> <span class="n">lipdutils</span><span class="o">.</span><span class="n">LipdToOntology</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="s1">&#39;archiveType&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="n">spectralfig_kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;color&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_default</span><span class="p">[</span><span class="n">archiveType</span><span class="p">][</span><span class="mi">0</span><span class="p">]})</span>
        <span class="k">if</span> <span class="s1">&#39;signif_clr&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">spectralfig_kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">spectralfig_kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;signif_clr&#39;</span><span class="p">:</span><span class="s1">&#39;grey&#39;</span><span class="p">})</span>
        <span class="n">ax</span><span class="p">[</span><span class="s1">&#39;spec&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">])</span>
        <span class="n">spectralfig_kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;ax&#39;</span><span class="p">:</span><span class="n">ax</span><span class="p">[</span><span class="s1">&#39;spec&#39;</span><span class="p">]})</span>
        <span class="n">ax</span><span class="p">[</span><span class="s1">&#39;spec&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">psd_signif</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">**</span><span class="n">spectralfig_kwargs</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">metadata</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="c1"># get metadata</span>
            <span class="n">textstr</span> <span class="o">=</span> <span class="s2">&quot;archiveType: &quot;</span> <span class="o">+</span> <span class="n">res</span><span class="p">[</span><span class="s2">&quot;archiveType&quot;</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">+</span>\
              <span class="s2">&quot;Authors: &quot;</span> <span class="o">+</span> <span class="n">res</span><span class="p">[</span><span class="s2">&quot;authors&quot;</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">+</span>\
              <span class="s2">&quot;Year: &quot;</span> <span class="o">+</span> <span class="n">res</span><span class="p">[</span><span class="s2">&quot;Year&quot;</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">+</span>\
              <span class="s2">&quot;DOI: &quot;</span> <span class="o">+</span> <span class="n">res</span><span class="p">[</span><span class="s2">&quot;DOI&quot;</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">+</span>\
              <span class="s2">&quot;Variable: &quot;</span> <span class="o">+</span> <span class="n">res</span><span class="p">[</span><span class="s2">&quot;Variable&quot;</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">+</span>\
              <span class="s2">&quot;units: &quot;</span> <span class="o">+</span> <span class="n">res</span><span class="p">[</span><span class="s2">&quot;units&quot;</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">+</span>\
              <span class="s2">&quot;Climate Interpretation: &quot;</span> <span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">+</span>\
              <span class="s2">&quot;    Climate Variable: &quot;</span> <span class="o">+</span> <span class="n">res</span><span class="p">[</span><span class="s2">&quot;Climate_Variable&quot;</span><span class="p">]</span> <span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">+</span>\
              <span class="s2">&quot;    Detail: &quot;</span> <span class="o">+</span> <span class="n">res</span><span class="p">[</span><span class="s2">&quot;Detail&quot;</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">+</span>\
              <span class="s2">&quot;    Seasonality: &quot;</span> <span class="o">+</span> <span class="n">res</span><span class="p">[</span><span class="s2">&quot;Seasonality&quot;</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">+</span>\
              <span class="s2">&quot;    Direction: &quot;</span> <span class="o">+</span> <span class="n">res</span><span class="p">[</span><span class="s2">&quot;Interpretation_Direction&quot;</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">+</span>\
              <span class="s2">&quot;Calibration: </span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> \
              <span class="s2">&quot;    Equation: &quot;</span> <span class="o">+</span> <span class="n">res</span><span class="p">[</span><span class="s2">&quot;Calibration_equation&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span>\
              <span class="s2">&quot;    Notes: &quot;</span> <span class="o">+</span> <span class="n">res</span><span class="p">[</span><span class="s2">&quot;Calibration_notes&quot;</span><span class="p">]</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">figtext</span><span class="p">(</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="n">textstr</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;path&#39;</span> <span class="ow">in</span> <span class="n">savefig_settings</span><span class="p">:</span>
            <span class="n">plotting</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">settings</span><span class="o">=</span><span class="n">savefig_settings</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">mute</span><span class="p">:</span>
                <span class="n">plotting</span><span class="o">.</span><span class="n">showfig</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span></div></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2017-2021, Deborah Khider, Feng Zhu, Julien Emile-Geay, Alexander James

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>